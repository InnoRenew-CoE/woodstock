import{a as c,t as m,c as R,e as ot}from"../chunks/disclose-version.Bwmcgxqz.js";import{k as Ge,G as it,j as nt,aK as lt,Q as ct,l as vt,W as dt,m as ut,v as ft,X as gt,p as qe,c as s,b as u,r as a,t as j,g as e,a as ze,d as x,R as Z,ad as N,s as de,y as Te,e as D}from"../chunks/runtime.DJIhzSjh.js";import{s as q}from"../chunks/render.BYfnFhVg.js";import{p as B,i as z,s as Ue,a as we,m as Ke,b as Pe}from"../chunks/props.BzTOUg1r.js";import{e as ke,i as Se,t as Ce,s as He,f as pt}from"../chunks/index.BW4TCKLq.js";import{d as De,p as I,e as _t}from"../chunks/events.QTIgbNMG.js";import{r as mt,s as Y,b as bt,M as W}from"../chunks/MaskedIcon.ttFZrQXw.js";import{b as ht}from"../chunks/window.CCB9gYTc.js";import"../chunks/legacy.DvYoTohi.js";import{P as Ve}from"../chunks/public.BxSvzgoa.js";import{w as Re}from"../chunks/index.DMOy1tU5.js";import{p as yt}from"../chunks/notifications.C0MpDPTZ.js";import{b as xt,a as wt}from"../chunks/input.DvxLu5oO.js";import{o as kt}from"../chunks/index-client.Ci-P54Dt.js";function St(o,t,n){Ge&&it();var f=o,r=gt,i,b=nt()?lt:ct;vt(()=>{b(r,r=t())&&(i&&dt(i),i=ut(()=>n(f)))}),Ge&&(f=ft)}var qt=m('<div class="flex-1"></div>');function zt(o){var t=qt();c(o,t)}var xe=(o=>(o[o.Text=0]="Text",o[o.Select=1]="Select",o[o.MultiSelect=2]="MultiSelect",o[o.Tags=3]="Tags",o))(xe||{});const ue=Re(),Xe=Re([]),Ye=Re([]);async function At(){const o=await fetch(`${Ve}/api/questions`),{questions:t,available_tags:n}=await o.json();Xe.set(t.toSorted((f,r)=>f.id-r.id)),Ye.set(n)}async function $t(o,t){for(let n of Array.from(o)){const f=t.find(i=>i.file===n.name);if(!f){console.error(`Unable to find answers for file ${n.name}`);continue}const r=new FormData;r.append("answers",JSON.stringify(f.answers)),r.append("file",n,n.name),await fetch(`${Ve}/api/answers`,{method:"POST",body:r})}yt({title:"Success",body:"Submission successful."})}var Mt=(o,t)=>t(o),Nt=m('<label><input class="hidden" type="checkbox"> </label>');function It(o,t){qe(t,!0);let n=B(t,"group",31,()=>I([]));B(t,"class",3,"");let f=B(t,"multiple",3,!0);const r=()=>typeof t.value=="number"?+t.value:t.value;let i=x(()=>n().includes(r()));function b(G){const A=r();e(i)?n(n().filter(F=>F!==A)):n().includes(A)||(f()?n([...n(),A]):n([A]))}var g=Nt(),p=s(g);mt(p),p.__change=[Mt,b];var l=u(p);a(g),j(()=>{Y(g,`select-none cursor-pointer px-4 py-2 rounded border ${(e(i)?"text-accent bg-accent/5 border-accent":"border-gray-200 bg-gray-100 opacity-70 hover:opacity-100")??""} `),bt(p,t.value),q(l,` ${t.label??""}`)}),c(o,g),ze()}De(["change"]);var jt=m(' <input class="border rounded-lg px-2 py-1 w-full" placeholder="Please type here...">',1);function Ft(o,t){Z();var n=jt(),f=N(n);j(()=>q(f,`${JSON.stringify(t.options)??""} `)),Z(),c(o,n)}var Ct=m('<textarea placeholder="Answer here..." class="p-5 min-h-[100px] resize-none w-full rounded border"></textarea>'),Pt=m('<div><div class="text-lg font-semibold"> </div> <div> </div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Tt(o,t){qe(t,!0);const[n,f]=Ue(),r=()=>we(Ye,"$tagsStore",n);let i=B(t,"answer",15),b=B(t,"proceed",15,!1),g=de(I(i().selection)),p=de(I(i().text));Te(()=>{var d;i(i().selection=e(g),!0),i(i().text=e(p),!0),b(e(g).length>0||(((d=e(p))==null?void 0:d.length)??0)>0)});var l=R(),G=N(l);{var A=d=>{var w=Pt(),H=s(w),K=s(H,!0);a(H);var V=u(H,2),v=s(V,!0);a(V);var k=u(V,2),C=s(k);{var P=$=>{var M=Ct();_t(M),xt(M,()=>e(p),te=>D(p,te)),c($,M)},Q=$=>{var M=R(),te=N(M);{var Ae=L=>{Ft(L,{get options(){return r()}})},fe=L=>{var re=R(),Be=N(re);ke(Be,17,()=>t.question.possible_answers,Se,(ae,ge)=>{var $e=x(()=>t.question.question_type===xe.MultiSelect);It(ae,{get label(){return e(ge).value},get value(){return e(ge).id},get multiple(){return e($e)},get group(){return e(g)},set group(pe){D(g,I(pe))}})}),c(L,re)};z(te,L=>{t.question.question_type===xe.Tags?L(Ae):L(fe,!1)},!0)}c($,M)};z(C,$=>{t.question.question_type===xe.Text?$(P):$(Q,!1)})}a(k),a(w),j(()=>{q(K,t.question.title),q(v,t.question.text)}),c(d,w)},F=d=>{var w=ot();j(()=>q(w,b(!0))),c(d,w)};z(G,d=>{i()?d(A):d(F,!1)})}c(o,l),ze(),f()}var Ut=m('<div class="flex items-center justify-center p-5"><label for="file-upload" class="flex items-center rounded border border-secondary overflow-hidden group bg-secondary/10 hover:bg-secondary cursor-pointer hover:text-white"><div class="bg-secondary p-2 group-hover:bg-white"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Dt(o,t){let n=B(t,"files",15);var f=Ut(),r=s(f),i=s(r),b=s(i);W(b,{src:"../sticker-circle.svg",class:"size-4 bg-white group-hover:bg-secondary"}),a(i),Z(2),a(r);var g=u(r,2);a(f),wt(g,n),c(o,f)}var Rt=m('<li class="flex items-center gap-3"><!> </li>'),Bt=m('<div class="font-light pb-2 text-secondary"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Lt=m('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Ot=m(`<div class="select-none"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div> <div><div><!></div> <!></div></div>`);function Et(o,t){qe(t,!0);const[n,f]=Ue(),r=()=>we(ue,"$filesStore",n);let i=B(t,"proceed",15);Te(()=>{var d;i((((d=r())==null?void 0:d.length)??0)>0)});var b=Ot(),g=u(s(b),6),p=s(g),l=s(p);Dt(l,{get files(){return Ke(),r()},set files(d){Pe(ue,I(d))}}),a(p);var G=u(p,2);{var A=d=>{var w=Bt();const H=x(()=>Array.from(r()??[]).map(k=>k.name));var K=N(w),V=s(K);a(K);var v=u(K,2);ke(v,21,()=>e(H),Se,(k,C)=>{var P=Rt(),Q=s(P);W(Q,{src:"../checkmark-circle.svg",class:"opacity-50 size-2.5 bg-primary"});var $=u(Q);a(P),j(()=>q($,` ${e(C)??""}`)),c(k,P)}),a(v),j(()=>{var k;return q(V,`Selected files (${((k=r())==null?void 0:k.length)??0??""}):`)}),c(d,w)},F=d=>{var w=Lt();c(d,w)};z(G,d=>{var w;(((w=r())==null?void 0:w.length)??0)>0?d(A):d(F,!1)})}a(g),a(b),c(o,b),ze(),f()}function Jt(o,t,n){t(0),n(void 0)}var Wt=m('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-secondary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Gt(o,t){let n=B(t,"step",15),f=B(t,"files",15);var r=Wt(),i=s(r),b=u(s(i),6);b.__click=[Jt,n,f];var g=s(b);W(g,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),Z(3),a(b),a(i),a(r),c(o,r)}De(["click"]);var Ht=m('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Kt=m("<div><li><div><!> </div></li></div>"),Vt=m('<div><div><!> <div class="z-10 absolute top-0 left-0 bg-gray-50 rounded p-5 border shadow shadow-secondary border-secondary group-hover:block right-0 hidden cursor-pointer"> </div></div> <!></div>'),Xt=m('<div><div class="text-center"><div class="font-bold"> </div> <div><span class="text-accent"> </span> | <span class="opacity-30"> </span></div></div> <!></div>'),Yt=(o,t)=>t(!1),Zt=m('<button class="py-1 px-3 rounded bg-primary text-white opacity-70 hover:opacity-100">Back</button>'),Qt=(o,t)=>t(!0),er=m('<button class="py-1 px-3 rounded bg-primary text-white opacity-70 hover:opacity-100 disabled:bg-gray-400">Next</button>'),tr=m('<span class="text-secondary font-nunito flex items-center gap-2"><!> Required</span>'),rr=m('<div class="grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none bg-dark-background border p-3 rounded-lg"><p class="text-xs opacity-40 uppercase pb-2"> </p> <ul class="p-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="bg-dark-background border rounded-lg p-5 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),ar=m('<p class="text-accent text-center">Contribution is not supported on mobile devices due to poor user experience.</p>');function br(o,t){qe(t,!0);const[n,f]=Ue(),r=()=>we(Xe,"$questionsStore",n),i=()=>we(ue,"$filesStore",n);kt(async()=>{await At()});let b=de(0),g=de(!1),p=x(()=>{var v;return 1+r().length*(((v=i())==null?void 0:v.length)??1)}),l=de(0),G=x(()=>Array.from(i()??[]).flatMap(v=>{const k=r().map(C=>({question_id:C.id,selection:[]}));return{file:v.name,answers:k}})),A=x(()=>e(G)[Math.floor((e(l)-1)/r().length)]),F=x(()=>{var v;return(v=e(A))==null?void 0:v.answers[(e(l)-1)%r().length]});function d(v){i()&&(D(l,I(Math.min(Math.max(e(l)+(v?1:-1),0),1+r().length*i().length))),D(g,!1))}Te(()=>{if(e(l)===e(p)){const v=i();v&&v.length>0&&$t(v,e(G)),setTimeout(()=>{Pe(ue,void 0),D(l,0)},15e3)}});var w=R(),H=N(w);{var K=v=>{var k=rr(),C=s(k),P=s(C),Q=s(P);a(P);var $=u(P,2),M=s($),te=s(M),Ae=x(()=>`../${(e(l)>=1?"checkmark.svg":"circle.svg")??""}`);W(te,{get src(){return e(Ae)},class:"size-2.5 bg-secondary"}),Z(),a(M);var fe=u(M,2);{var L=_=>{var y=Ht();c(_,y)};z(fe,_=>{var y;(((y=i())==null?void 0:y.length)??0)>0&&_(L)})}var re=u(fe,2);ke(re,1,()=>Array.from(i()??[]),Se,(_,y,T)=>{var O=Vt();const X=x(()=>e(l)>=T*r().length+1&&e(l)<(T+1)*r().length+1),h=x(()=>e(l)>=(T+1)*r().length+1),S=x(()=>e(h)?"bg-lime-400":"bg-secondary");var E=s(O),_e=s(E),se=x(()=>`../${(e(X)?"chevron-down.svg":e(h)?"checkmark.svg":"circle.svg")??""}`),me=x(()=>`${(e(h)||e(X)?"size-3":"size-2")??""} ${e(S)??""}`);W(_e,{get src(){return e(se)},get class(){return e(me)}});var be=u(_e);j(()=>q(be,` ... ${e(y).name.slice(-15)??""} `));var he=u(be),oe=s(he,!0);a(he),a(E);var U=u(E,2);ke(U,1,r,Se,(ie,Me,ne)=>{var ee=R();const le=x(()=>e(l)==1+ne+T*r().length),ce=x(()=>e(l)>1+ne+T*r().length);var Ne=N(ee);{var Ie=J=>{var ve=Kt(),je=s(ve),Fe=s(je),We=s(Fe),at=x(()=>`../${(e(ce)?"checkmark.svg":e(le)?"chevron-right.svg":"circle.svg")??""}`);W(We,{get src(){return e(at)},class:"w-3 h-3 bg-secondary"});var st=u(We);a(Fe),a(je),a(ve),j(()=>{Y(je,`pl-5 ${(e(ce)||e(le)?"":"opacity-30")??""}`),Y(Fe,`flex gap-3 items-center ${(e(le)?"font-bold":"")??""}`),q(st,` ${e(Me).title??""}`)}),Ce(1,ve,()=>He),Ce(2,ve,()=>He),c(J,ve)};z(Ne,J=>{e(X)&&J(Ie)})}c(ie,ee)}),a(O),j(()=>{Y(O,`group relative px-3 py-1 shadow-sm bg-secondary/5 border rounded-lg ${(e(h)?"border-lime-400 bg-lime-400/10":"border-secondary/30")??""}`),Y(E,`flex items-center gap-2 ${(e(h)?"text-lime-500":"")??""} `),q(oe,e(y).name)}),c(_,O)});var ae=u(re,2),ge=s(ae),$e=x(()=>`../${(e(l)===e(p)?"checkmark.svg":"circle.svg")??""}`);W(ge,{get src(){return e($e)},class:"size-2.5 bg-secondary"}),Z(),a(ae),a($),a(C);var pe=u(C,2),Le=s(pe);{var Ze=_=>{Et(_,{get proceed(){return e(g)},set proceed(y){D(g,I(y))}})},Qe=_=>{var y=R(),T=N(y);{var O=h=>{Gt(h,{get step(){return e(l)},set step(S){D(l,I(S))},get files(){return Ke(),i()},set files(S){Pe(ue,I(S))}})},X=h=>{var S=R(),E=N(S);{var _e=se=>{var me=R();const be=x(()=>r().filter(oe=>{var U;return oe.id===((U=e(F))==null?void 0:U.question_id)})[0]);var he=N(me);St(he,()=>e(l),oe=>{var U=Xt(),ye=s(U),ie=s(ye),Me=s(ie,!0);a(ie);var ne=u(ie,2),ee=s(ne),le=s(ee,!0);a(ee);var ce=u(ee,2),Ne=s(ce,!0);a(ce),a(ne),a(ye);var Ie=u(ye,2);Tt(Ie,{get question(){return e(be)},get answer(){return e(F)},get proceed(){return e(g)},set proceed(J){D(g,I(J))}}),a(U),j(()=>{var J;q(Me,(J=e(A))==null?void 0:J.file),q(le,(e(l)-1)%r().length+1),q(Ne,r().length)}),Ce(1,U,()=>pt),c(oe,U)}),c(se,me)};z(E,se=>{e(F)&&se(_e)},!0)}c(h,S)};z(T,h=>{e(l)===e(p)?h(O):h(X,!1)},!0)}c(_,y)};z(Le,_=>{e(l)===0?_(Ze):_(Qe,!1)})}var Oe=u(Le,2),Ee=s(Oe);{var et=_=>{var y=Zt();y.__click=[Yt,d],c(_,y)};z(Ee,_=>{e(l)>=1&&e(l)!==e(p)&&_(et)})}var Je=u(Ee,2);zt(Je);var tt=u(Je,2);{var rt=_=>{var y=R(),T=N(y);{var O=h=>{var S=er();S.__click=[Qt,d],c(h,S)},X=h=>{var S=tr(),E=s(S);W(E,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),Z(),a(S),c(h,S)};z(T,h=>{e(g)?h(O):h(X,!1)})}c(_,y)};z(tt,_=>{e(l)<e(p)&&_(rt)})}a(Oe),a(pe),a(k),j(()=>{q(Q,`Step ${e(l)??""} / ${e(p)??""}`),Y(M,`flex items-center gap-3 ${(e(l)===0?"font-semibold":"")??""}`),Y(ae,`flex items-center gap-3 ${(e(l)===e(p)?"font-bold":"opacity-45")??""}`)}),c(v,k)},V=v=>{var k=ar();c(v,k)};z(H,v=>{e(b)>640?v(K):v(V,!1)})}ht("innerWidth",v=>D(b,I(v))),c(o,w),ze(),f()}De(["click"]);export{br as component};

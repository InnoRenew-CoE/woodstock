import{a as n,t as _,c as H,e as He}from"../chunks/disclose-version.B8FhMCHa.js";import{l as Ge,o as nt,Y as ct,aK as vt,ah as dt,k as ut,A as ft,z as gt,x as pt,ao as _t,p as Ae,c as r,s as d,r as a,t as U,g as e,a as Te,d as b,b as te,a1 as Ke,ap as O,e as F,n as Se}from"../chunks/runtime.Twxei6D9.js";import{s as I,i as M}from"../chunks/if.D8Ga6OrE.js";import{e as qe,i as ze}from"../chunks/each.D4Yknd68.js";import{d as Pe,p as k,r as mt}from"../chunks/events.cLB7s__O.js";import{r as Qe,a as ie,b as et,M as K}from"../chunks/MaskedIcon.Bv3Qvdar.js";import{t as $e,s as Xe,a as ht}from"../chunks/index.DWwqrxLx.js";import{b as xt}from"../chunks/window.DDrw6ikS.js";import{p as V,s as Be,a as De,m as tt,b as Ve}from"../chunks/props.DW8d2wJc.js";import"../chunks/legacy.CuZUSs6W.js";import{P as at}from"../chunks/public.CD978DOo.js";import{w as We}from"../chunks/index.tARBV8wy.js";import{p as bt}from"../chunks/notifications.CpKWVnYM.js";import{b as yt,c as wt}from"../chunks/input.zAG3t_j5.js";import{S as kt}from"../chunks/SuggestiveInput.Bm1zWyn5.js";import{o as st}from"../chunks/index-client.W6R2iQDr.js";function St(o,t,v){Ge&&nt();var m=o,s=_t,i,y=ct()?vt:dt;ut(()=>{y(s,s=t())&&(i&&ft(i),i=gt(()=>v(m)))}),Ge&&(m=pt)}var ge=(o=>(o[o.Text=0]="Text",o[o.Select=1]="Select",o[o.MultiSelect=2]="MultiSelect",o[o.Tags=3]="Tags",o[o.MultiText=4]="MultiText",o))(ge||{});const Me=We(),rt=We([]),it=We([]);async function qt(){const o=await fetch(`${at}/api/questions`),{questions:t,available_tags:v}=await o.json();rt.set(t.toSorted((m,s)=>m.id-s.id)),it.set(v)}async function zt(o,t){for(let v of Array.from(o)){const m=t.find(i=>i.file===v.name);if(!m){console.error(`Unable to find answers for file ${v.name}`);continue}const s=new FormData;s.append("answers",JSON.stringify(m.answers)),s.append("file",v,v.name),await fetch(`${at}/api/answers`,{method:"POST",body:s})}bt({title:"Success",body:"Submission successful."})}var Mt=_('<div class="flex-1"></div>');function At(o){var t=Mt();n(o,t)}var Tt=(o,t)=>t(o),Nt=_('<label><input class="hidden" type="checkbox"> </label>');function jt(o,t){Ae(t,!0);let v=V(t,"group",31,()=>k([]));V(t,"class",3,"");let m=V(t,"multiple",3,!0);const s=()=>typeof t.value=="number"?+t.value:t.value;let i=b(()=>v().includes(s()));function y(g){const A=s();e(i)?v(v().filter(R=>R!==A)):v().includes(A)||(m()?v([...v(),A]):v([A]))}var u=Nt(),f=r(u);Qe(f),f.__change=[Tt,y];var l=d(f);a(u),U(()=>{ie(u,`transition-all select-none glass px-5 py-3 ${(e(i)?"bg-secondary/10 text-secondary border-secondary hover:bg-red-100 hover:text-red-400 hover:border-red-400 ":"hover:bg-secondary/10 hover:border-secondary hover:text-accent")??""}`),et(f,t.value),I(l,` ${t.label??""}`)}),n(o,u),Te()}Pe(["change"]);var It=_('<textarea placeholder="Answer here..." class="glass p-5 min-h-[100px] resize-none w-full"></textarea>'),Ft=_('<div class="flex items-center gap-3"><input placeholder="Type here..." class="glass p-5 py-2 resize-none w-full"> <div class="glass p-2 hover:bg-red-50 cursor-pointer"><!></div></div>'),Ct=_('<div class="grid w-full gap-3 py-5"></div>'),Ut=_('<div class="grid sm:flex gap-3 w-full items-stretch flex-wrap"></div>'),Dt=_('<div><div class="glass p-8"><div class="text-lg font-semibold"> </div> <div> </div></div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Pt(o,t){Ae(t,!0);const[v,m]=Be(),s=()=>De(it,"$tagsStore",v);let i=V(t,"answer",15),y=V(t,"proceed",15,!1),u=te(k(i().selection)),f=te(k(i().text)),l=te(k(i().tags)),g=te(k([""]));Ke(()=>{var x;if(i(i().selection=e(u),!0),i(i().text=e(f),!0),i(i().tags=e(l),!0),t.question.question_type===ge.MultiText){const T=e(g).filter(D=>D.trim().length!==0);T.length>0&&i(i().text=JSON.stringify(T),!0)}y(i().selection.length>0||(((x=i().text)==null?void 0:x.length)??0)>0||i().tags.length>0)});var A=H(),R=O(A);{var oe=x=>{var T=Dt(),D=r(T),c=r(D),C=r(c,!0);a(c);var q=d(c,2),le=r(q,!0);a(q),a(D);var P=d(D,2),ne=r(P);{var pe=W=>{var E=It();mt(E),yt(E,()=>e(f),je=>F(f,je)),n(W,E)},Ne=W=>{var E=H(),je=O(E);{var _e=Z=>{var J=Ct();qe(J,21,()=>e(g),ze,(ce,Ie,ae)=>{var N=Ft(),j=r(N);Qe(j),j.__keyup=me=>{const ve=me.currentTarget.value??"";e(g)[ae]=ve,ve.trim().length>0&&e(g).find(p=>p.length===0)===void 0&&F(g,k([...e(g),""]))};var se=d(j,2);se.__click=()=>{F(g,k(e(g).toSpliced(ae,1))),F(g,k([...e(g)]))};var re=r(se);K(re,{src:"/x-close.svg",class:"size-4 bg-red-600"}),a(se),a(N),U(()=>et(j,e(g)[ae])),n(ce,N)}),a(J),n(Z,J)},Le=Z=>{var J=H(),ce=O(J);{var Ie=N=>{kt(N,{get options(){return s()},get selected(){return e(l)},set selected(j){F(l,k(j))}})},ae=N=>{var j=Ut();qe(j,21,()=>t.question.possible_answers.toSorted(),ze,(se,re)=>{var me=b(()=>t.question.question_type===ge.MultiSelect);jt(se,{get label(){return e(re).value},get value(){return e(re).id},get multiple(){return e(me)},get group(){return e(u)},set group(ve){F(u,k(ve))}})}),a(j),n(N,j)};M(ce,N=>{t.question.question_type===ge.Tags?N(Ie):N(ae,!1)},!0)}n(Z,J)};M(je,Z=>{t.question.question_type===ge.MultiText?Z(_e):Z(Le,!1)},!0)}n(W,E)};M(ne,W=>{t.question.question_type===ge.Text?W(pe):W(Ne,!1)})}a(P),a(T),U(()=>{I(C,t.question.title),I(le,t.question.text)}),n(x,T)},S=x=>{var T=He();U(()=>I(T,y(!0))),n(x,T)};M(R,x=>{i()?x(oe):x(S,!1)})}n(o,A),Te(),m()}Pe(["keyup","click"]);var Bt=_('<div class="flex items-center justify-center p-5"><label for="file-upload" class="text-secondary glass bg-secondary/10 border-secondary/50 flex gap-3 p-2 py-1 items-center justify-center hover:brightness-[99%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/70"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Lt(o,t){let v=V(t,"files",15);var m=Bt(),s=r(m),i=r(s),y=r(i);K(y,{src:"../sticker-circle.svg",class:"size-4 bg-secondary"}),a(i),Se(2),a(s);var u=d(s,2);a(m),wt(u,v),n(o,m)}var Ot=_('<li class="flex items-center gap-3"><!> </li>'),Rt=_('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Et=_('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Jt=_(`<div class="select-none flex flex-col gap-5"><div class="glass p-10"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div></div> <div class="glass p-5"><div><!></div> <div class="glass p-10"><!></div></div></div>`);function Yt(o,t){Ae(t,!0);const[v,m]=Be(),s=()=>De(Me,"$filesStore",v);let i=V(t,"proceed",15);Ke(()=>{var S;i((((S=s())==null?void 0:S.length)??0)>0)});var y=Jt(),u=d(r(y),2),f=r(u),l=r(f);Lt(l,{get files(){return tt(),s()},set files(S){Ve(Me,k(S))}}),a(f);var g=d(f,2),A=r(g);{var R=S=>{var x=Rt();const T=b(()=>Array.from(s()??[]).map(q=>q.name));var D=O(x),c=r(D);a(D);var C=d(D,2);qe(C,21,()=>e(T),ze,(q,le)=>{var P=Ot(),ne=r(P);K(ne,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var pe=d(ne);a(P),U(()=>I(pe,` ${e(le)??""}`)),n(q,P)}),a(C),U(()=>{var q;return I(c,`Selected files (${((q=s())==null?void 0:q.length)??0??""}):`)}),n(S,x)},oe=S=>{var x=Et();n(S,x)};M(A,S=>{var x;(((x=s())==null?void 0:x.length)??0)>0?S(R):S(oe,!1)})}a(g),a(u),a(y),n(o,y),Te(),m()}var $t=_('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-primary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Ht(o,t){Ae(t,!0);const[v,m]=Be();let s=V(t,"step",15),i=V(t,"files",15),y=te(0);function u(){s(0),i(void 0),clearTimeout(e(y))}st(()=>{F(y,k(setTimeout(()=>{Ve(Me,void 0),s(0),u()},15e3)))});var f=$t(),l=r(f),g=d(r(l),6);g.__click=u;var A=r(g);K(A,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),Se(3),a(g),a(l),a(f),n(o,f),Te(),m()}Pe(["click"]);var Kt=_('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Vt=_("<div><li><div><!> </div></li></div>"),Wt=_('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),Zt=_('<div class="flex flex-col gap-4"><div class="flex gap-5 m-auto text-center whitespace-nowrap"><div class="glass w-min p-5 py-2 rounded-full"> </div> <div class="glass w-min p-5 py-2 rounded-full"><span class="text-secondary"> </span> | <span class="opacity-30"> </span></div></div> <div class="flex-1"><!></div></div>'),Gt=(o,t)=>t(!1),Xt=_('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),Qt=(o,t)=>t(!0),ea=_('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),ta=_('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),aa=_('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="px-2 py-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),sa=_('<div class="flex items-center justify-center h-full"><div class="glass text-primary p-10 shadow-lg w-[90%] max-w-[500px]">Contribution is not supported on mobile devices due to poor user experience.</div></div>');function ba(o,t){Ae(t,!0);const[v,m]=Be(),s=()=>De(rt,"$questionsStore",v),i=()=>De(Me,"$filesStore",v);st(async()=>{await qt()});let y=te(0),u=te(!1),f=b(()=>{var c;return 1+s().length*(((c=i())==null?void 0:c.length)??1)}),l=te(0),g=b(()=>Array.from(i()??[]).flatMap(c=>{const C=s().map(q=>({question_id:q.id,tags:[],selection:[]}));return{file:c.name,answers:C}})),A=b(()=>e(g)[Math.floor((e(l)-1)/s().length)]),R=b(()=>{var c;return(c=e(A))==null?void 0:c.answers[(e(l)-1)%s().length]});function oe(c){i()&&(F(l,k(Math.min(Math.max(e(l)+(c?1:-1),0),1+s().length*i().length))),F(u,!1))}Ke(()=>{if(e(l)===e(f)){const c=i();c&&c.length>0&&zt(c,e(g))}});var S=H(),x=O(S);{var T=c=>{var C=aa(),q=r(C),le=r(q),P=r(le),ne=r(P),pe=b(()=>`../${(e(l)>=1?"checkmark.svg":"circle.svg")??""}`);K(ne,{get src(){return e(pe)},class:"size-3 bg-secondary"}),Se(),a(P);var Ne=d(P,2);{var W=p=>{var h=Kt();n(p,h)};M(Ne,p=>{var h;(((h=i())==null?void 0:h.length)??0)>0&&p(W)})}var E=d(Ne,2);qe(E,1,()=>Array.from(i()??[]),ze,(p,h,Y)=>{var G=Wt();const de=b(()=>e(l)>=Y*s().length+1&&e(l)<(Y+1)*s().length+1),w=b(()=>e(l)>=(Y+1)*s().length+1),z=b(()=>e(w)?"bg-lime-400":"bg-primary");var X=r(G),he=r(X),xe=r(he,!0);a(he);var be=d(he,2),Oe=b(()=>`../${(e(de)?"chevron-down.svg":e(w)?"checkmark.svg":"circle.svg")??""}`);K(be,{get src(){return e(Oe)},get class(){return`size-3 ${e(z)??""}`}});var Re=d(be,2);{var ye=B=>{var L=He();const Q=b(()=>e(h).name.slice(0,3)??""),ue=b(()=>e(h).name.slice(-5)??"");U(()=>I(L,`${e(Q)} ... ${e(ue)}`)),n(B,L)},$=B=>{var L=He();U(()=>I(L,e(h).name)),n(B,L)};M(Re,B=>{e(h).name.length>10?B(ye):B($,!1)})}a(X);var we=d(X,2);qe(we,1,s,ze,(B,L,Q)=>{var ue=H();const fe=b(()=>e(l)==1+Q+Y*s().length),Ce=b(()=>e(l)>1+Q+Y*s().length);var Ue=O(ue);{var Ee=ee=>{var ke=Vt(),Je=r(ke),Ye=r(Je),Ze=r(Ye),ot=b(()=>`../${(e(Ce)?"checkmark.svg":e(fe)?"chevron-right.svg":"circle.svg")??""}`);K(Ze,{get src(){return e(ot)},class:"w-3 h-3 bg-secondary"});var lt=d(Ze);a(Ye),a(Je),a(ke),U(()=>{ie(Je,`pt-2 pl-5 ${(e(Ce)||e(fe)?"":"opacity-30")??""}`),ie(Ye,`flex gap-3 items-center ${(e(fe)?"text-secondary":"")??""}`),I(lt,` ${e(L).title??""}`)}),$e(1,ke,()=>Xe),$e(2,ke,()=>Xe),n(ee,ke)};M(Ue,ee=>{e(de)&&ee(Ee)})}n(B,ue)}),a(G),U(()=>{ie(G,`glass group relative px-3 py-1 shadow-sm border ${(e(w)?"border-lime-400 bg-lime-400/10":"")??""}`),ie(X,`flex items-center gap-2 ${(e(w)?"text-lime-500":"")??""} `),I(xe,e(h).name)}),n(p,G)});var _e=d(E,2),Le=r(_e),Z=b(()=>`../${(e(l)===e(f)?"checkmark.svg":"circle.svg")??""}`);K(Le,{get src(){return e(Z)},class:"z-0 size-3 bg-secondary"}),Se(),a(_e),a(le),a(q);var J=d(q,2),ce=r(J);{var Ie=p=>{Yt(p,{get proceed(){return e(u)},set proceed(h){F(u,k(h))}})},ae=p=>{var h=H(),Y=O(h);{var G=w=>{Ht(w,{get step(){return e(l)},set step(z){F(l,k(z))},get files(){return tt(),i()},set files(z){Ve(Me,k(z))}})},de=w=>{var z=H(),X=O(z);{var he=xe=>{var be=H();const Oe=b(()=>s().filter(ye=>{var $;return ye.id===(($=e(R))==null?void 0:$.question_id)})[0]);var Re=O(be);St(Re,()=>e(l),ye=>{var $=Zt(),we=r($),Fe=r(we),B=r(Fe,!0);a(Fe);var L=d(Fe,2),Q=r(L),ue=r(Q,!0);a(Q);var fe=d(Q,2),Ce=r(fe,!0);a(fe),a(L),a(we);var Ue=d(we,2),Ee=r(Ue);Pt(Ee,{get question(){return e(Oe)},get answer(){return e(R)},get proceed(){return e(u)},set proceed(ee){F(u,k(ee))}}),a(Ue),a($),U(()=>{var ee;I(B,(ee=e(A))==null?void 0:ee.file),I(ue,(e(l)-1)%s().length+1),I(Ce,s().length)}),$e(1,$,()=>ht),n(ye,$)}),n(xe,be)};M(X,xe=>{e(R)&&xe(he)},!0)}n(w,z)};M(Y,w=>{e(l)===e(f)?w(G):w(de,!1)},!0)}n(p,h)};M(ce,p=>{e(l)===0?p(Ie):p(ae,!1)})}var N=d(ce,2),j=r(N);{var se=p=>{var h=Xt();h.__click=[Gt,oe],n(p,h)};M(j,p=>{e(l)>=1&&e(l)!==e(f)&&p(se)})}var re=d(j,2);At(re);var me=d(re,2);{var ve=p=>{var h=H(),Y=O(h);{var G=w=>{var z=ea();z.__click=[Qt,oe],n(w,z)},de=w=>{var z=ta(),X=r(z);K(X,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),Se(),a(z),n(w,z)};M(Y,w=>{e(u)?w(G):w(de,!1)})}n(p,h)};M(me,p=>{e(l)<e(f)&&p(ve)})}a(N),a(J),a(C),U(()=>{ie(P,`glass px-3 py-2 flex items-center gap-3 ${(e(l)===0?"bg-secondary/5 shadow-secondary/30 border-secondary text-secondary":"")??""}`),ie(_e,`glass px-3 py-2 flex items-center gap-3 ${(e(l)===e(f)?"font-bold":"")??""}`)}),n(c,C)},D=c=>{var C=sa();n(c,C)};M(x,c=>{e(y)>1e3?c(T):c(D,!1)})}xt("innerWidth",c=>F(y,k(c))),n(o,S),Te(),m()}Pe(["click"]);export{ba as component};

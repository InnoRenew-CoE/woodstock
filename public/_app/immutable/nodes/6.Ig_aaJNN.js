import{a as c,t as m,c as B,e as ot}from"../chunks/disclose-version.DhCj0zca.js";import{l as Ke,n as it,X as nt,aK as lt,a1 as ct,k as vt,z as dt,y as ut,w as ft,aa as gt,p as qe,c as s,b as u,r as a,t as F,g as e,a as ze,d as x,a3 as G,a2 as N,s as de,a0 as Te,e as D}from"../chunks/runtime.BNiZENzE.js";import{p as L,a as q,i as z,s as Ue,b as we,d as We,e as Pe}from"../chunks/props.ubv3QNbn.js";import{e as ke,i as Se}from"../chunks/each.BpeMN_eK.js";import{d as De,p as I,e as pt}from"../chunks/events.CG0BT_pH.js";import{r as _t,s as Z,c as mt,M as H,t as Ce,b as Ve,f as bt}from"../chunks/index.5w0jbpJt.js";import{b as ht}from"../chunks/window.W74ZS_dW.js";import"../chunks/legacy.C5_a2vTT.js";import{P as Xe}from"../chunks/public.BxSvzgoa.js";import{w as Be}from"../chunks/index.COyhmTID.js";import{p as yt}from"../chunks/notifications.Ce6HBQ0q.js";import{a as xt,c as wt}from"../chunks/input.CQpqvlZf.js";import{o as kt}from"../chunks/index-client.CO5LStFK.js";function St(o,t,n){Ke&&it();var f=o,r=gt,i,b=nt()?lt:ct;vt(()=>{b(r,r=t())&&(i&&dt(i),i=ut(()=>n(f)))}),Ke&&(f=ft)}var xe=(o=>(o[o.Text=0]="Text",o[o.Select=1]="Select",o[o.MultiSelect=2]="MultiSelect",o[o.Tags=3]="Tags",o))(xe||{});const ue=Be(),Ye=Be([]),Ze=Be([]);async function qt(){const o=await fetch(`${Xe}/api/questions`),{questions:t,available_tags:n}=await o.json();Ye.set(t.toSorted((f,r)=>f.id-r.id)),Ze.set(n)}async function zt(o,t){for(let n of Array.from(o)){const f=t.find(i=>i.file===n.name);if(!f){console.error(`Unable to find answers for file ${n.name}`);continue}const r=new FormData;r.append("answers",JSON.stringify(f.answers)),r.append("file",n,n.name),await fetch(`${Xe}/api/answers`,{method:"POST",body:r})}yt({title:"Success",body:"Submission successful."})}var At=m('<div class="flex-1"></div>');function $t(o){var t=At();c(o,t)}var Mt=(o,t)=>t(o),Nt=m('<label><input class="hidden" type="checkbox"> </label>');function It(o,t){qe(t,!0);let n=L(t,"group",31,()=>I([]));L(t,"class",3,"");let f=L(t,"multiple",3,!0);const r=()=>typeof t.value=="number"?+t.value:t.value;let i=x(()=>n().includes(r()));function b(K){const A=r();e(i)?n(n().filter(j=>j!==A)):n().includes(A)||(f()?n([...n(),A]):n([A]))}var g=Nt(),p=s(g);_t(p),p.__change=[Mt,b];var l=u(p);a(g),F(()=>{Z(g,`select-none cursor-pointer px-4 py-2 rounded border ${(e(i)?"text-accent bg-accent/5 border-accent":"border-gray-200 bg-gray-100 opacity-70 hover:opacity-100")??""} `),mt(p,t.value),q(l,` ${t.label??""}`)}),c(o,g),ze()}De(["change"]);var Ft=m(' <input class="border rounded-lg px-2 py-1 w-full" placeholder="Please type here...">',1);function jt(o,t){G();var n=Ft(),f=N(n);F(()=>q(f,`${JSON.stringify(t.options)??""} `)),G(),c(o,n)}var Ct=m('<textarea placeholder="Answer here..." class="p-5 min-h-[100px] resize-none w-full rounded border"></textarea>'),Pt=m('<div><div class="text-lg font-semibold"> </div> <div> </div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Tt(o,t){qe(t,!0);const[n,f]=Ue(),r=()=>we(Ze,"$tagsStore",n);let i=L(t,"answer",15),b=L(t,"proceed",15,!1),g=de(I(i().selection)),p=de(I(i().text));Te(()=>{var d;i(i().selection=e(g),!0),i(i().text=e(p),!0),b(e(g).length>0||(((d=e(p))==null?void 0:d.length)??0)>0)});var l=B(),K=N(l);{var A=d=>{var w=Pt(),V=s(w),W=s(V,!0);a(V);var X=u(V,2),v=s(X,!0);a(X);var k=u(X,2),C=s(k);{var P=$=>{var M=Ct();pt(M),xt(M,()=>e(p),te=>D(p,te)),c($,M)},Q=$=>{var M=B(),te=N(M);{var Ae=O=>{jt(O,{get options(){return r()}})},fe=O=>{var re=B(),Le=N(re);ke(Le,17,()=>t.question.possible_answers,Se,(ae,ge)=>{var $e=x(()=>t.question.question_type===xe.MultiSelect);It(ae,{get label(){return e(ge).value},get value(){return e(ge).id},get multiple(){return e($e)},get group(){return e(g)},set group(pe){D(g,I(pe))}})}),c(O,re)};z(te,O=>{t.question.question_type===xe.Tags?O(Ae):O(fe,!1)},!0)}c($,M)};z(C,$=>{t.question.question_type===xe.Text?$(P):$(Q,!1)})}a(k),a(w),F(()=>{q(W,t.question.title),q(v,t.question.text)}),c(d,w)},j=d=>{var w=ot();F(()=>q(w,b(!0))),c(d,w)};z(K,d=>{i()?d(A):d(j,!1)})}c(o,l),ze(),f()}var Ut=m('<div class="flex items-center justify-center p-5"><label for="file-upload" class="flex items-center rounded border border-secondary overflow-hidden group bg-secondary/10 hover:bg-secondary cursor-pointer hover:text-white"><div class="bg-secondary p-2 group-hover:bg-white"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Dt(o,t){let n=L(t,"files",15);var f=Ut(),r=s(f),i=s(r),b=s(i);H(b,{src:"../sticker-circle.svg",class:"size-4 bg-white group-hover:bg-secondary"}),a(i),G(2),a(r);var g=u(r,2);a(f),wt(g,n),c(o,f)}var Bt=m('<li class="flex items-center gap-3"><!> </li>'),Lt=m('<div class="font-light pb-2 text-secondary"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Ot=m('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Rt=m(`<div class="select-none"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div> <div><div><!></div> <!></div></div>`);function Et(o,t){qe(t,!0);const[n,f]=Ue(),r=()=>we(ue,"$filesStore",n);let i=L(t,"proceed",15);Te(()=>{var d;i((((d=r())==null?void 0:d.length)??0)>0)});var b=Rt(),g=u(s(b),6),p=s(g),l=s(p);Dt(l,{get files(){return We(),r()},set files(d){Pe(ue,I(d))}}),a(p);var K=u(p,2);{var A=d=>{var w=Lt();const V=x(()=>Array.from(r()??[]).map(k=>k.name));var W=N(w),X=s(W);a(W);var v=u(W,2);ke(v,21,()=>e(V),Se,(k,C)=>{var P=Bt(),Q=s(P);H(Q,{src:"../checkmark-circle.svg",class:"opacity-50 size-2.5 bg-primary"});var $=u(Q);a(P),F(()=>q($,` ${e(C)??""}`)),c(k,P)}),a(v),F(()=>{var k;return q(X,`Selected files (${((k=r())==null?void 0:k.length)??0??""}):`)}),c(d,w)},j=d=>{var w=Ot();c(d,w)};z(K,d=>{var w;(((w=r())==null?void 0:w.length)??0)>0?d(A):d(j,!1)})}a(g),a(b),c(o,b),ze(),f()}function Jt(o,t,n){t(0),n(void 0)}var Ht=m('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-secondary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Kt(o,t){let n=L(t,"step",15),f=L(t,"files",15);var r=Ht(),i=s(r),b=u(s(i),6);b.__click=[Jt,n,f];var g=s(b);H(g,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),G(3),a(b),a(i),a(r),c(o,r)}De(["click"]);var Vt=m('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Wt=m("<div><li><div><!> </div></li></div>"),Xt=m('<div><div><!> <div class="z-10 absolute top-0 left-0 bg-gray-50 rounded p-5 border shadow shadow-secondary border-secondary group-hover:block right-0 hidden cursor-pointer"> </div></div> <!></div>'),Yt=m('<div><div class="text-center"><div class="font-bold"> </div> <div><span class="text-accent"> </span> | <span class="opacity-30"> </span></div></div> <!></div>'),Zt=(o,t)=>t(!1),Gt=m('<button class="py-1 px-3 rounded bg-primary text-white opacity-70 hover:opacity-100">Back</button>'),Qt=(o,t)=>t(!0),er=m('<button class="py-1 px-3 rounded bg-primary text-white opacity-70 hover:opacity-100 disabled:bg-gray-400">Next</button>'),tr=m('<span class="text-secondary font-nunito flex items-center gap-2"><!> Required</span>'),rr=m('<div class="grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none bg-dark-background border p-3 rounded-lg"><p class="text-xs opacity-40 uppercase pb-2"> </p> <ul class="p-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="bg-dark-background border rounded-lg p-5 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),ar=m('<p class="text-accent text-center">Contribution is not supported on mobile devices due to poor user experience.</p>');function mr(o,t){qe(t,!0);const[n,f]=Ue(),r=()=>we(Ye,"$questionsStore",n),i=()=>we(ue,"$filesStore",n);kt(async()=>{await qt()});let b=de(0),g=de(!1),p=x(()=>{var v;return 1+r().length*(((v=i())==null?void 0:v.length)??1)}),l=de(0),K=x(()=>Array.from(i()??[]).flatMap(v=>{const k=r().map(C=>({question_id:C.id,selection:[]}));return{file:v.name,answers:k}})),A=x(()=>e(K)[Math.floor((e(l)-1)/r().length)]),j=x(()=>{var v;return(v=e(A))==null?void 0:v.answers[(e(l)-1)%r().length]});function d(v){i()&&(D(l,I(Math.min(Math.max(e(l)+(v?1:-1),0),1+r().length*i().length))),D(g,!1))}Te(()=>{if(e(l)===e(p)){const v=i();v&&v.length>0&&zt(v,e(K)),setTimeout(()=>{Pe(ue,void 0),D(l,0)},15e3)}});var w=B(),V=N(w);{var W=v=>{var k=rr(),C=s(k),P=s(C),Q=s(P);a(P);var $=u(P,2),M=s($),te=s(M),Ae=x(()=>`../${(e(l)>=1?"checkmark.svg":"circle.svg")??""}`);H(te,{get src(){return e(Ae)},class:"size-2.5 bg-secondary"}),G(),a(M);var fe=u(M,2);{var O=_=>{var y=Vt();c(_,y)};z(fe,_=>{var y;(((y=i())==null?void 0:y.length)??0)>0&&_(O)})}var re=u(fe,2);ke(re,1,()=>Array.from(i()??[]),Se,(_,y,T)=>{var R=Xt();const Y=x(()=>e(l)>=T*r().length+1&&e(l)<(T+1)*r().length+1),h=x(()=>e(l)>=(T+1)*r().length+1),S=x(()=>e(h)?"bg-lime-400":"bg-secondary");var E=s(R),_e=s(E),se=x(()=>`../${(e(Y)?"chevron-down.svg":e(h)?"checkmark.svg":"circle.svg")??""}`),me=x(()=>`${(e(h)||e(Y)?"size-3":"size-2")??""} ${e(S)??""}`);H(_e,{get src(){return e(se)},get class(){return e(me)}});var be=u(_e);F(()=>q(be,` ... ${e(y).name.slice(-15)??""} `));var he=u(be),oe=s(he,!0);a(he),a(E);var U=u(E,2);ke(U,1,r,Se,(ie,Me,ne)=>{var ee=B();const le=x(()=>e(l)==1+ne+T*r().length),ce=x(()=>e(l)>1+ne+T*r().length);var Ne=N(ee);{var Ie=J=>{var ve=Wt(),Fe=s(ve),je=s(Fe),He=s(je),at=x(()=>`../${(e(ce)?"checkmark.svg":e(le)?"chevron-right.svg":"circle.svg")??""}`);H(He,{get src(){return e(at)},class:"w-3 h-3 bg-secondary"});var st=u(He);a(je),a(Fe),a(ve),F(()=>{Z(Fe,`pl-5 ${(e(ce)||e(le)?"":"opacity-30")??""}`),Z(je,`flex gap-3 items-center ${(e(le)?"font-bold":"")??""}`),q(st,` ${e(Me).title??""}`)}),Ce(1,ve,()=>Ve),Ce(2,ve,()=>Ve),c(J,ve)};z(Ne,J=>{e(Y)&&J(Ie)})}c(ie,ee)}),a(R),F(()=>{Z(R,`group relative px-3 py-1 shadow-sm bg-secondary/5 border rounded-lg ${(e(h)?"border-lime-400 bg-lime-400/10":"border-secondary/30")??""}`),Z(E,`flex items-center gap-2 ${(e(h)?"text-lime-500":"")??""} `),q(oe,e(y).name)}),c(_,R)});var ae=u(re,2),ge=s(ae),$e=x(()=>`../${(e(l)===e(p)?"checkmark.svg":"circle.svg")??""}`);H(ge,{get src(){return e($e)},class:"size-2.5 bg-secondary"}),G(),a(ae),a($),a(C);var pe=u(C,2),Oe=s(pe);{var Ge=_=>{Et(_,{get proceed(){return e(g)},set proceed(y){D(g,I(y))}})},Qe=_=>{var y=B(),T=N(y);{var R=h=>{Kt(h,{get step(){return e(l)},set step(S){D(l,I(S))},get files(){return We(),i()},set files(S){Pe(ue,I(S))}})},Y=h=>{var S=B(),E=N(S);{var _e=se=>{var me=B();const be=x(()=>r().filter(oe=>{var U;return oe.id===((U=e(j))==null?void 0:U.question_id)})[0]);var he=N(me);St(he,()=>e(l),oe=>{var U=Yt(),ye=s(U),ie=s(ye),Me=s(ie,!0);a(ie);var ne=u(ie,2),ee=s(ne),le=s(ee,!0);a(ee);var ce=u(ee,2),Ne=s(ce,!0);a(ce),a(ne),a(ye);var Ie=u(ye,2);Tt(Ie,{get question(){return e(be)},get answer(){return e(j)},get proceed(){return e(g)},set proceed(J){D(g,I(J))}}),a(U),F(()=>{var J;q(Me,(J=e(A))==null?void 0:J.file),q(le,(e(l)-1)%r().length+1),q(Ne,r().length)}),Ce(1,U,()=>bt),c(oe,U)}),c(se,me)};z(E,se=>{e(j)&&se(_e)},!0)}c(h,S)};z(T,h=>{e(l)===e(p)?h(R):h(Y,!1)},!0)}c(_,y)};z(Oe,_=>{e(l)===0?_(Ge):_(Qe,!1)})}var Re=u(Oe,2),Ee=s(Re);{var et=_=>{var y=Gt();y.__click=[Zt,d],c(_,y)};z(Ee,_=>{e(l)>=1&&e(l)!==e(p)&&_(et)})}var Je=u(Ee,2);$t(Je);var tt=u(Je,2);{var rt=_=>{var y=B(),T=N(y);{var R=h=>{var S=er();S.__click=[Qt,d],c(h,S)},Y=h=>{var S=tr(),E=s(S);H(E,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),G(),a(S),c(h,S)};z(T,h=>{e(g)?h(R):h(Y,!1)})}c(_,y)};z(tt,_=>{e(l)<e(p)&&_(rt)})}a(Re),a(pe),a(k),F(()=>{q(Q,`Step ${e(l)??""} / ${e(p)??""}`),Z(M,`flex items-center gap-3 ${(e(l)===0?"font-semibold":"")??""}`),Z(ae,`flex items-center gap-3 ${(e(l)===e(p)?"font-bold":"opacity-45")??""}`)}),c(v,k)},X=v=>{var k=ar();c(v,k)};z(V,v=>{e(b)>640?v(W):v(X,!1)})}ht("innerWidth",v=>D(b,I(v))),c(o,w),ze(),f()}De(["click"]);export{mr as component};

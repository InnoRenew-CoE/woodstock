import{a as n,t as m,c as Y,e as Ye}from"../chunks/disclose-version.B8FhMCHa.js";import{l as Ze,o as nt,Y as ct,aK as vt,ah as dt,k as ut,A as ft,z as gt,x as pt,ao as _t,p as Ae,c as i,s as f,r as a,t as U,g as e,a as Te,d as y,b as te,a1 as Ke,ap as B,e as I,n as Se}from"../chunks/runtime.Twxei6D9.js";import{s as F,i as M}from"../chunks/if.D8Ga6OrE.js";import{e as qe,i as ze}from"../chunks/each.D4Yknd68.js";import{d as Pe,p as k,r as mt}from"../chunks/events.cLB7s__O.js";import{r as Qe,a as ie,b as et,M as K}from"../chunks/MaskedIcon.Bv3Qvdar.js";import{t as Je,s as Ge,a as ht}from"../chunks/index.DWwqrxLx.js";import{b as xt}from"../chunks/window.DDrw6ikS.js";import{p as V,s as Le,a as De,m as tt,b as Ve}from"../chunks/props.DW8d2wJc.js";import"../chunks/legacy.CuZUSs6W.js";import{P as at}from"../chunks/public.CD978DOo.js";import{w as We}from"../chunks/index.tARBV8wy.js";import{p as bt}from"../chunks/notifications.CpKWVnYM.js";import{b as yt,c as wt}from"../chunks/input.zAG3t_j5.js";import{S as kt}from"../chunks/SuggestiveInput.Bm1zWyn5.js";import{o as st}from"../chunks/index-client.W6R2iQDr.js";function St(o,t,v){Ze&&nt();var h=o,r=_t,s,u=ct()?vt:dt;ut(()=>{u(r,r=t())&&(s&&ft(s),s=gt(()=>v(h)))}),Ze&&(h=pt)}var ge=(o=>(o[o.Text=0]="Text",o[o.Select=1]="Select",o[o.MultiSelect=2]="MultiSelect",o[o.Tags=3]="Tags",o[o.MultiText=4]="MultiText",o))(ge||{});const Me=We(),rt=We([]),it=We([]);async function qt(){const o=await fetch(`${at}/api/questions`),{questions:t,available_tags:v}=await o.json();rt.set(t.toSorted((h,r)=>h.id-r.id)),it.set(v)}async function zt(o,t){for(let v of Array.from(o)){const h=t.find(u=>u.file===v.name);if(!h){console.error(`Unable to find answers for file ${v.name}`);continue}const r=new FormData;r.append("answers",JSON.stringify(h.answers)),r.append("file",v,v.name);const s=new XMLHttpRequest;s.open("POST",`${at}/api/answers`),s.upload.onprogress=u=>{if(u.lengthComputable){const d=u.loaded/u.total*100;console.log(`Uploaded: ${d.toFixed(2)}%`)}},s.onload=()=>console.log("Done!"),s.send(r)}bt({title:"Success",body:"Submission successful."})}var Mt=m('<div class="flex-1"></div>');function At(o){var t=Mt();n(o,t)}var Tt=(o,t)=>t(o),Nt=m('<label><input class="hidden" type="checkbox"> </label>');function jt(o,t){Ae(t,!0);let v=V(t,"group",31,()=>k([]));V(t,"class",3,"");let h=V(t,"multiple",3,!0);const r=()=>typeof t.value=="number"?+t.value:t.value;let s=y(()=>v().includes(r()));function u(p){const A=r();e(s)?v(v().filter(O=>O!==A)):v().includes(A)||(h()?v([...v(),A]):v([A]))}var d=Nt(),g=i(d);Qe(g),g.__change=[Tt,u];var l=f(g);a(d),U(()=>{ie(d,`transition-all select-none glass px-5 py-3 ${(e(s)?"bg-secondary/10 text-secondary border-secondary hover:bg-red-100 hover:text-red-400 hover:border-red-400 ":"hover:bg-secondary/10 hover:border-secondary hover:text-accent")??""}`),et(g,t.value),F(l,` ${t.label??""}`)}),n(o,d),Te()}Pe(["change"]);var Ft=m('<textarea placeholder="Answer here..." class="glass p-5 min-h-[100px] resize-none w-full"></textarea>'),It=m('<div class="flex items-center gap-3"><input placeholder="Type here..." class="glass p-5 py-2 resize-none w-full"> <div class="glass p-2 hover:bg-red-50 cursor-pointer"><!></div></div>'),Ct=m('<div class="grid w-full gap-3 py-5"></div>'),Ut=m('<div class="grid sm:flex gap-3 w-full items-stretch flex-wrap"></div>'),Dt=m('<div><div class="glass p-8"><div class="text-lg font-semibold"> </div> <div> </div></div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Pt(o,t){Ae(t,!0);const[v,h]=Le(),r=()=>De(it,"$tagsStore",v);let s=V(t,"answer",15),u=V(t,"proceed",15,!1),d=te(k(s().selection)),g=te(k(s().text)),l=te(k(s().tags)),p=te(k([""]));Ke(()=>{var b;if(s(s().selection=e(d),!0),s(s().text=e(g),!0),s(s().tags=e(l),!0),t.question.question_type===ge.MultiText){const T=e(p).filter(D=>D.trim().length!==0);T.length>0&&s(s().text=JSON.stringify(T),!0)}u(s().selection.length>0||(((b=s().text)==null?void 0:b.length)??0)>0||s().tags.length>0)});var A=Y(),O=B(A);{var oe=b=>{var T=Dt(),D=i(T),c=i(D),C=i(c,!0);a(c);var q=f(c,2),le=i(q,!0);a(q),a(D);var P=f(D,2),ne=i(P);{var pe=W=>{var $=Ft();mt($),yt($,()=>e(g),je=>I(g,je)),n(W,$)},Ne=W=>{var $=Y(),je=B($);{var _e=X=>{var E=Ct();qe(E,21,()=>e(p),ze,(ce,Fe,ae)=>{var N=It(),j=i(N);Qe(j),j.__keyup=me=>{const ve=me.currentTarget.value??"";e(p)[ae]=ve,ve.trim().length>0&&e(p).find(_=>_.length===0)===void 0&&I(p,k([...e(p),""]))};var se=f(j,2);se.__click=()=>{I(p,k(e(p).toSpliced(ae,1))),I(p,k([...e(p)]))};var re=i(se);K(re,{src:"/x-close.svg",class:"size-4 bg-red-600"}),a(se),a(N),U(()=>et(j,e(p)[ae])),n(ce,N)}),a(E),n(X,E)},Re=X=>{var E=Y(),ce=B(E);{var Fe=N=>{kt(N,{get options(){return r()},get selected(){return e(l)},set selected(j){I(l,k(j))}})},ae=N=>{var j=Ut();qe(j,21,()=>t.question.possible_answers.toSorted(),ze,(se,re)=>{var me=y(()=>t.question.question_type===ge.MultiSelect);jt(se,{get label(){return e(re).value},get value(){return e(re).id},get multiple(){return e(me)},get group(){return e(d)},set group(ve){I(d,k(ve))}})}),a(j),n(N,j)};M(ce,N=>{t.question.question_type===ge.Tags?N(Fe):N(ae,!1)},!0)}n(X,E)};M(je,X=>{t.question.question_type===ge.MultiText?X(_e):X(Re,!1)},!0)}n(W,$)};M(ne,W=>{t.question.question_type===ge.Text?W(pe):W(Ne,!1)})}a(P),a(T),U(()=>{F(C,t.question.title),F(le,t.question.text)}),n(b,T)},S=b=>{var T=Ye();U(()=>F(T,u(!0))),n(b,T)};M(O,b=>{s()?b(oe):b(S,!1)})}n(o,A),Te(),h()}Pe(["keyup","click"]);var Lt=m('<div class="flex items-center justify-center p-5"><label for="file-upload" class="text-secondary glass bg-secondary/10 border-secondary/50 flex gap-3 p-2 py-1 items-center justify-center hover:brightness-[99%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/70"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Rt(o,t){let v=V(t,"files",15);var h=Lt(),r=i(h),s=i(r),u=i(s);K(u,{src:"../sticker-circle.svg",class:"size-4 bg-secondary"}),a(s),Se(2),a(r);var d=f(r,2);a(h),wt(d,v),n(o,h)}var Bt=m('<li class="flex items-center gap-3"><!> </li>'),Ot=m('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),$t=m('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Et=m(`<div class="select-none flex flex-col gap-5"><div class="glass p-10"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div></div> <div class="glass p-5"><div><!></div> <div class="glass p-10"><!></div></div></div>`);function Ht(o,t){Ae(t,!0);const[v,h]=Le(),r=()=>De(Me,"$filesStore",v);let s=V(t,"proceed",15);Ke(()=>{var S;s((((S=r())==null?void 0:S.length)??0)>0)});var u=Et(),d=f(i(u),2),g=i(d),l=i(g);Rt(l,{get files(){return tt(),r()},set files(S){Ve(Me,k(S))}}),a(g);var p=f(g,2),A=i(p);{var O=S=>{var b=Ot();const T=y(()=>Array.from(r()??[]).map(q=>q.name));var D=B(b),c=i(D);a(D);var C=f(D,2);qe(C,21,()=>e(T),ze,(q,le)=>{var P=Bt(),ne=i(P);K(ne,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var pe=f(ne);a(P),U(()=>F(pe,` ${e(le)??""}`)),n(q,P)}),a(C),U(()=>{var q;return F(c,`Selected files (${((q=r())==null?void 0:q.length)??0??""}):`)}),n(S,b)},oe=S=>{var b=$t();n(S,b)};M(A,S=>{var b;(((b=r())==null?void 0:b.length)??0)>0?S(O):S(oe,!1)})}a(p),a(d),a(u),n(o,u),Te(),h()}var Jt=m('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-primary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Yt(o,t){Ae(t,!0);const[v,h]=Le();let r=V(t,"step",15),s=V(t,"files",15),u=te(0);function d(){r(0),s(void 0),clearTimeout(e(u))}st(()=>{I(u,k(setTimeout(()=>{Ve(Me,void 0),r(0),d()},15e3)))});var g=Jt(),l=i(g),p=f(i(l),6);p.__click=d;var A=i(p);K(A,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),Se(3),a(p),a(l),a(g),n(o,g),Te(),h()}Pe(["click"]);var Kt=m('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Vt=m("<div><li><div><!> </div></li></div>"),Wt=m('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),Xt=m('<div class="flex flex-col gap-4"><div class="flex gap-5 m-auto text-center whitespace-nowrap"><div class="glass w-min p-5 py-2 rounded-full"> </div> <div class="glass w-min p-5 py-2 rounded-full"><span class="text-secondary"> </span> | <span class="opacity-30"> </span></div></div> <div class="flex-1"><!></div></div>'),Zt=(o,t)=>t(!1),Gt=m('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),Qt=(o,t)=>t(!0),ea=m('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),ta=m('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),aa=m('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="px-2 py-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),sa=m('<div class="flex items-center justify-center h-full"><div class="glass text-primary p-10 shadow-lg w-[90%] max-w-[500px]">Contribution is not supported on mobile devices due to poor user experience.</div></div>');function ba(o,t){Ae(t,!0);const[v,h]=Le(),r=()=>De(rt,"$questionsStore",v),s=()=>De(Me,"$filesStore",v);st(async()=>{await qt()});let u=te(0),d=te(!1),g=y(()=>{var c;return 1+r().length*(((c=s())==null?void 0:c.length)??1)}),l=te(0),p=y(()=>Array.from(s()??[]).flatMap(c=>{const C=r().map(q=>({question_id:q.id,tags:[],selection:[]}));return{file:c.name,answers:C}})),A=y(()=>e(p)[Math.floor((e(l)-1)/r().length)]),O=y(()=>{var c;return(c=e(A))==null?void 0:c.answers[(e(l)-1)%r().length]});function oe(c){s()&&(I(l,k(Math.min(Math.max(e(l)+(c?1:-1),0),1+r().length*s().length))),I(d,!1))}Ke(()=>{if(e(l)===e(g)){const c=s();c&&c.length>0&&zt(c,e(p))}});var S=Y(),b=B(S);{var T=c=>{var C=aa(),q=i(C),le=i(q),P=i(le),ne=i(P),pe=y(()=>`../${(e(l)>=1?"checkmark.svg":"circle.svg")??""}`);K(ne,{get src(){return e(pe)},class:"size-3 bg-secondary"}),Se(),a(P);var Ne=f(P,2);{var W=_=>{var x=Kt();n(_,x)};M(Ne,_=>{var x;(((x=s())==null?void 0:x.length)??0)>0&&_(W)})}var $=f(Ne,2);qe($,1,()=>Array.from(s()??[]),ze,(_,x,H)=>{var Z=Wt();const de=y(()=>e(l)>=H*r().length+1&&e(l)<(H+1)*r().length+1),w=y(()=>e(l)>=(H+1)*r().length+1),z=y(()=>e(w)?"bg-lime-400":"bg-primary");var G=i(Z),he=i(G),xe=i(he,!0);a(he);var be=f(he,2),Be=y(()=>`../${(e(de)?"chevron-down.svg":e(w)?"checkmark.svg":"circle.svg")??""}`);K(be,{get src(){return e(Be)},get class(){return`size-3 ${e(z)??""}`}});var Oe=f(be,2);{var ye=L=>{var R=Ye();const Q=y(()=>e(x).name.slice(0,3)??""),ue=y(()=>e(x).name.slice(-5)??"");U(()=>F(R,`${e(Q)} ... ${e(ue)}`)),n(L,R)},J=L=>{var R=Ye();U(()=>F(R,e(x).name)),n(L,R)};M(Oe,L=>{e(x).name.length>10?L(ye):L(J,!1)})}a(G);var we=f(G,2);qe(we,1,r,ze,(L,R,Q)=>{var ue=Y();const fe=y(()=>e(l)==1+Q+H*r().length),Ce=y(()=>e(l)>1+Q+H*r().length);var Ue=B(ue);{var $e=ee=>{var ke=Vt(),Ee=i(ke),He=i(Ee),Xe=i(He),ot=y(()=>`../${(e(Ce)?"checkmark.svg":e(fe)?"chevron-right.svg":"circle.svg")??""}`);K(Xe,{get src(){return e(ot)},class:"w-3 h-3 bg-secondary"});var lt=f(Xe);a(He),a(Ee),a(ke),U(()=>{ie(Ee,`pt-2 pl-5 ${(e(Ce)||e(fe)?"":"opacity-30")??""}`),ie(He,`flex gap-3 items-center ${(e(fe)?"text-secondary":"")??""}`),F(lt,` ${e(R).title??""}`)}),Je(1,ke,()=>Ge),Je(2,ke,()=>Ge),n(ee,ke)};M(Ue,ee=>{e(de)&&ee($e)})}n(L,ue)}),a(Z),U(()=>{ie(Z,`glass group relative px-3 py-1 shadow-sm border ${(e(w)?"border-lime-400 bg-lime-400/10":"")??""}`),ie(G,`flex items-center gap-2 ${(e(w)?"text-lime-500":"")??""} `),F(xe,e(x).name)}),n(_,Z)});var _e=f($,2),Re=i(_e),X=y(()=>`../${(e(l)===e(g)?"checkmark.svg":"circle.svg")??""}`);K(Re,{get src(){return e(X)},class:"z-0 size-3 bg-secondary"}),Se(),a(_e),a(le),a(q);var E=f(q,2),ce=i(E);{var Fe=_=>{Ht(_,{get proceed(){return e(d)},set proceed(x){I(d,k(x))}})},ae=_=>{var x=Y(),H=B(x);{var Z=w=>{Yt(w,{get step(){return e(l)},set step(z){I(l,k(z))},get files(){return tt(),s()},set files(z){Ve(Me,k(z))}})},de=w=>{var z=Y(),G=B(z);{var he=xe=>{var be=Y();const Be=y(()=>r().filter(ye=>{var J;return ye.id===((J=e(O))==null?void 0:J.question_id)})[0]);var Oe=B(be);St(Oe,()=>e(l),ye=>{var J=Xt(),we=i(J),Ie=i(we),L=i(Ie,!0);a(Ie);var R=f(Ie,2),Q=i(R),ue=i(Q,!0);a(Q);var fe=f(Q,2),Ce=i(fe,!0);a(fe),a(R),a(we);var Ue=f(we,2),$e=i(Ue);Pt($e,{get question(){return e(Be)},get answer(){return e(O)},get proceed(){return e(d)},set proceed(ee){I(d,k(ee))}}),a(Ue),a(J),U(()=>{var ee;F(L,(ee=e(A))==null?void 0:ee.file),F(ue,(e(l)-1)%r().length+1),F(Ce,r().length)}),Je(1,J,()=>ht),n(ye,J)}),n(xe,be)};M(G,xe=>{e(O)&&xe(he)},!0)}n(w,z)};M(H,w=>{e(l)===e(g)?w(Z):w(de,!1)},!0)}n(_,x)};M(ce,_=>{e(l)===0?_(Fe):_(ae,!1)})}var N=f(ce,2),j=i(N);{var se=_=>{var x=Gt();x.__click=[Zt,oe],n(_,x)};M(j,_=>{e(l)>=1&&e(l)!==e(g)&&_(se)})}var re=f(j,2);At(re);var me=f(re,2);{var ve=_=>{var x=Y(),H=B(x);{var Z=w=>{var z=ea();z.__click=[Qt,oe],n(w,z)},de=w=>{var z=ta(),G=i(z);K(G,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),Se(),a(z),n(w,z)};M(H,w=>{e(d)?w(Z):w(de,!1)})}n(_,x)};M(me,_=>{e(l)<e(g)&&_(ve)})}a(N),a(E),a(C),U(()=>{ie(P,`glass px-3 py-2 flex items-center gap-3 ${(e(l)===0?"bg-secondary/5 shadow-secondary/30 border-secondary text-secondary":"")??""}`),ie(_e,`glass px-3 py-2 flex items-center gap-3 ${(e(l)===e(g)?"font-bold":"")??""}`)}),n(c,C)},D=c=>{var C=sa();n(c,C)};M(b,c=>{e(u)>1e3?c(T):c(D,!1)})}xt("innerWidth",c=>I(u,k(c))),n(o,S),Te(),h()}Pe(["click"]);export{ba as component};

import{a as n,t as g,c as V,e as Ke}from"../chunks/disclose-version.p1-EQT2n.js";import{k as Xe,m as nt,j as lt,aK as ct,ap as vt,l as dt,z as ut,y as ft,A as gt,U as pt,p as Ce,c as i,b as d,r as a,t as C,g as e,a as De,d as x,s as ie,a2 as We,av as L,e as N,n as Se}from"../chunks/runtime.yYShR0qK.js";import{s as j}from"../chunks/render.D7NAawfb.js";import{i as M}from"../chunks/if.fU1DF3jv.js";import{e as ze,i as Me}from"../chunks/each.E8PDSrZO.js";import{d as Pe}from"../chunks/events.DWC1hrwU.js";import{r as Qe,s as se,b as et,M as W}from"../chunks/MaskedIcon.BG_6uEh-.js";import{t as He,s as $e,a as _t}from"../chunks/index.C2RBZahc.js";import{p as k,r as mt}from"../chunks/misc.DRzOhjZg.js";import{b as ht}from"../chunks/window.Bt0aB1gW.js";import{p as Y,s as Ye,a as Ue,m as tt,b as Ve}from"../chunks/props.zw5KJNyQ.js";import"../chunks/legacy.DBQUpH3Y.js";import{P as at}from"../chunks/public.CD978DOo.js";import{w as Ze}from"../chunks/index.squxxUV3.js";import{p as bt}from"../chunks/notifications.BsUI6TfI.js";import{b as xt,c as yt}from"../chunks/input.DOSR8VhX.js";import{S as wt}from"../chunks/SuggestiveInput.Czn-5vfn.js";import{o as kt}from"../chunks/index-client.Cwl53X-q.js";function St(o,t,c){Xe&&nt();var p=o,r=pt,s,m=lt()?ct:vt;dt(()=>{m(r,r=t())&&(s&&ut(s),s=ft(()=>c(p)))}),Xe&&(p=gt)}var ge=(o=>(o[o.Text=0]="Text",o[o.Select=1]="Select",o[o.MultiSelect=2]="MultiSelect",o[o.Tags=3]="Tags",o[o.MultiText=4]="MultiText",o))(ge||{});const qe=Ze(),rt=Ze([]),st=Ze([]);async function qt(){const o=await fetch(`${at}/api/questions`),{questions:t,available_tags:c}=await o.json();rt.set(t.toSorted((p,r)=>p.id-r.id)),st.set(c)}async function zt(o,t){for(let c of Array.from(o)){const p=t.find(s=>s.file===c.name);if(!p){console.error(`Unable to find answers for file ${c.name}`);continue}const r=new FormData;r.append("answers",JSON.stringify(p.answers)),r.append("file",c,c.name),await fetch(`${at}/api/answers`,{method:"POST",body:r})}bt({title:"Success",body:"Submission successful."})}var Mt=g('<div class="flex-1"></div>');function At(o){var t=Mt();n(o,t)}var Tt=(o,t)=>t(o),Nt=g('<label><input class="hidden" type="checkbox"> </label>');function jt(o,t){Ce(t,!0);let c=Y(t,"group",31,()=>k([]));Y(t,"class",3,"");let p=Y(t,"multiple",3,!0);const r=()=>typeof t.value=="number"?+t.value:t.value;let s=x(()=>c().includes(r()));function m(y){const I=r();e(s)?c(c().filter(O=>O!==I)):c().includes(I)||(p()?c([...c(),I]):c([I]))}var u=Nt(),h=i(u);Qe(h),h.__change=[Tt,m];var l=d(h);a(u),C(()=>{se(u,`transition-all select-none glass px-5 py-3 ${(e(s)?"bg-secondary/10 text-secondary border-secondary hover:bg-red-100 hover:text-red-400 hover:border-red-400 ":"hover:bg-secondary/10 hover:border-secondary hover:text-accent")??""}`),et(h,t.value),j(l,` ${t.label??""}`)}),n(o,u),De()}Pe(["change"]);var It=g('<textarea placeholder="Answer here..." class="glass p-5 min-h-[100px] resize-none w-full"></textarea>'),Ft=g('<div class="flex items-center gap-3"><input placeholder="Type here..." class="glass p-5 py-2 resize-none w-full"> <div class="glass p-2 hover:bg-red-50 cursor-pointer"><!></div></div>'),Ut=g('<div class="grid w-full gap-3 py-5"></div>'),Ct=g('<div class="grid sm:flex gap-3 w-full items-stretch flex-wrap"></div>'),Dt=g('<div><div class="glass p-8"><div class="text-lg font-semibold"> </div> <div> </div></div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Pt(o,t){Ce(t,!0);const[c,p]=Ye(),r=()=>Ue(st,"$tagsStore",c);let s=Y(t,"answer",15),m=Y(t,"proceed",15,!1),u=ie(k(s().selection)),h=ie(k(s().text)),l=ie(k(s().tags)),y=ie(k([""]));We(()=>{var b;s(s().selection=e(u),!0),s(s().text=e(h),!0),s(s().tags=e(l),!0),t.question.question_type===ge.MultiText&&s(s().text=JSON.stringify(e(y).filter(F=>F.trim().length!==0)),!0),m(s().selection.length>0||(((b=s().text)==null?void 0:b.length)??0)>0||s().tags.length>0)});var I=V(),O=L(I);{var oe=b=>{var F=Dt(),R=i(F),v=i(R),U=i(v,!0);a(v);var q=d(v,2),ne=i(q,!0);a(q),a(R);var D=d(R,2),le=i(D);{var pe=Z=>{var E=It();mt(E),xt(E,()=>e(h),Te=>N(h,Te)),n(Z,E)},Ae=Z=>{var E=V(),Te=L(E);{var _e=G=>{var J=Ut();ze(J,21,()=>e(y),Me,(ce,Ne,te)=>{var A=Ft(),T=i(A);Qe(T),T.__keyup=me=>{const ve=me.currentTarget.value??"";e(y)[te]=ve,ve.trim().length>0&&e(y).find(f=>f.length===0)===void 0&&N(y,k([...e(y),""]))};var ae=d(T,2);ae.__click=()=>{N(y,k(e(y).toSpliced(te,1))),N(y,k([...e(y)]))};var re=i(ae);W(re,{src:"/x-close.svg",class:"size-4 bg-red-600"}),a(ae),a(A),C(()=>et(T,e(y)[te])),n(ce,A)}),a(J),n(G,J)},Be=G=>{var J=V(),ce=L(J);{var Ne=A=>{wt(A,{get options(){return r()},get selected(){return e(l)},set selected(T){N(l,k(T))}})},te=A=>{var T=Ct();ze(T,21,()=>t.question.possible_answers.toSorted(),Me,(ae,re)=>{var me=x(()=>t.question.question_type===ge.MultiSelect);jt(ae,{get label(){return e(re).value},get value(){return e(re).id},get multiple(){return e(me)},get group(){return e(u)},set group(ve){N(u,k(ve))}})}),a(T),n(A,T)};M(ce,A=>{t.question.question_type===ge.Tags?A(Ne):A(te,!1)},!0)}n(G,J)};M(Te,G=>{t.question.question_type===ge.MultiText?G(_e):G(Be,!1)},!0)}n(Z,E)};M(le,Z=>{t.question.question_type===ge.Text?Z(pe):Z(Ae,!1)})}a(D),a(F),C(()=>{j(U,t.question.title),j(ne,t.question.text)}),n(b,F)},S=b=>{var F=Ke();C(()=>j(F,m(!0))),n(b,F)};M(O,b=>{s()?b(oe):b(S,!1)})}n(o,I),De(),p()}Pe(["keyup","click"]);var Bt=g('<div class="flex items-center justify-center p-5"><label for="file-upload" class="text-secondary glass bg-secondary/10 border-secondary/50 flex gap-3 p-2 py-1 items-center justify-center hover:brightness-[99%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/70"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Lt(o,t){let c=Y(t,"files",15);var p=Bt(),r=i(p),s=i(r),m=i(s);W(m,{src:"../sticker-circle.svg",class:"size-4 bg-secondary"}),a(s),Se(2),a(r);var u=d(r,2);a(p),yt(u,c),n(o,p)}var Ot=g('<li class="flex items-center gap-3"><!> </li>'),Rt=g('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Et=g('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Jt=g(`<div class="select-none flex flex-col gap-5"><div class="glass p-10"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div></div> <div class="glass p-5"><div><!></div> <div class="glass p-10"><!></div></div></div>`);function Ht(o,t){Ce(t,!0);const[c,p]=Ye(),r=()=>Ue(qe,"$filesStore",c);let s=Y(t,"proceed",15);We(()=>{var S;s((((S=r())==null?void 0:S.length)??0)>0)});var m=Jt(),u=d(i(m),2),h=i(u),l=i(h);Lt(l,{get files(){return tt(),r()},set files(S){Ve(qe,k(S))}}),a(h);var y=d(h,2),I=i(y);{var O=S=>{var b=Rt();const F=x(()=>Array.from(r()??[]).map(q=>q.name));var R=L(b),v=i(R);a(R);var U=d(R,2);ze(U,21,()=>e(F),Me,(q,ne)=>{var D=Ot(),le=i(D);W(le,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var pe=d(le);a(D),C(()=>j(pe,` ${e(ne)??""}`)),n(q,D)}),a(U),C(()=>{var q;return j(v,`Selected files (${((q=r())==null?void 0:q.length)??0??""}):`)}),n(S,b)},oe=S=>{var b=Et();n(S,b)};M(I,S=>{var b;(((b=r())==null?void 0:b.length)??0)>0?S(O):S(oe,!1)})}a(y),a(u),a(m),n(o,m),De(),p()}function Kt(o,t,c){t(0),c(void 0)}var Vt=g('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-primary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Wt(o,t){let c=Y(t,"step",15),p=Y(t,"files",15);var r=Vt(),s=i(r),m=d(i(s),6);m.__click=[Kt,c,p];var u=i(m);W(u,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),Se(3),a(m),a(s),a(r),n(o,r)}Pe(["click"]);var Yt=g('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Zt=g("<div><li><div><!> </div></li></div>"),Gt=g('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),Xt=g('<div class="flex flex-col gap-4"><div class="flex gap-5 m-auto text-center whitespace-nowrap"><div class="glass w-min p-5 py-2 rounded-full"> </div> <div class="glass w-min p-5 py-2 rounded-full"><span class="text-secondary"> </span> | <span class="opacity-30"> </span></div></div> <div class="flex-1"><!></div></div>'),$t=(o,t)=>t(!1),Qt=g('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),ea=(o,t)=>t(!0),ta=g('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),aa=g('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),ra=g('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="p-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),sa=g('<p class="text-accent text-center">Contribution is not supported on mobile devices due to poor user experience.</p>');function ka(o,t){Ce(t,!0);const[c,p]=Ye(),r=()=>Ue(rt,"$questionsStore",c),s=()=>Ue(qe,"$filesStore",c);kt(async()=>{await qt()});let m=ie(0),u=ie(!1),h=x(()=>{var v;return 1+r().length*(((v=s())==null?void 0:v.length)??1)}),l=ie(0),y=x(()=>Array.from(s()??[]).flatMap(v=>{const U=r().map(q=>({question_id:q.id,tags:[],selection:[]}));return{file:v.name,answers:U}})),I=x(()=>e(y)[Math.floor((e(l)-1)/r().length)]),O=x(()=>{var v;return(v=e(I))==null?void 0:v.answers[(e(l)-1)%r().length]});function oe(v){s()&&(N(l,k(Math.min(Math.max(e(l)+(v?1:-1),0),1+r().length*s().length))),N(u,!1))}We(()=>{if(e(l)===e(h)){const v=s();v&&v.length>0&&zt(v,e(y)),setTimeout(()=>{Ve(qe,void 0),N(l,0)},15e3)}});var S=V(),b=L(S);{var F=v=>{var U=ra(),q=i(U),ne=i(q),D=i(ne),le=i(D),pe=x(()=>`../${(e(l)>=1?"checkmark.svg":"circle.svg")??""}`);W(le,{get src(){return e(pe)},class:"size-3 bg-secondary"}),Se(),a(D);var Ae=d(D,2);{var Z=f=>{var _=Yt();n(f,_)};M(Ae,f=>{var _;(((_=s())==null?void 0:_.length)??0)>0&&f(Z)})}var E=d(Ae,2);ze(E,1,()=>Array.from(s()??[]),Me,(f,_,H)=>{var X=Gt();const de=x(()=>e(l)>=H*r().length+1&&e(l)<(H+1)*r().length+1),w=x(()=>e(l)>=(H+1)*r().length+1),z=x(()=>e(w)?"bg-lime-400":"bg-primary");var $=i(X),he=i($),be=i(he,!0);a(he);var xe=d(he,2),Le=x(()=>`../${(e(de)?"chevron-down.svg":e(w)?"checkmark.svg":"circle.svg")??""}`);W(xe,{get src(){return e(Le)},get class(){return`size-3 ${e(z)??""}`}});var Oe=d(xe,2);{var ye=P=>{var B=Ke();const Q=x(()=>e(_).name.slice(0,3)??""),ue=x(()=>e(_).name.slice(-5)??"");C(()=>j(B,`${e(Q)} ... ${e(ue)}`)),n(P,B)},K=P=>{var B=Ke();C(()=>j(B,e(_).name)),n(P,B)};M(Oe,P=>{e(_).name.length>10?P(ye):P(K,!1)})}a($);var we=d($,2);ze(we,1,r,Me,(P,B,Q)=>{var ue=V();const fe=x(()=>e(l)==1+Q+H*r().length),Ie=x(()=>e(l)>1+Q+H*r().length);var Fe=L(ue);{var Re=ee=>{var ke=Zt(),Ee=i(ke),Je=i(Ee),Ge=i(Je),it=x(()=>`../${(e(Ie)?"checkmark.svg":e(fe)?"chevron-right.svg":"circle.svg")??""}`);W(Ge,{get src(){return e(it)},class:"w-3 h-3 bg-secondary"});var ot=d(Ge);a(Je),a(Ee),a(ke),C(()=>{se(Ee,`pt-2 pl-5 ${(e(Ie)||e(fe)?"":"opacity-30")??""}`),se(Je,`flex gap-3 items-center ${(e(fe)?"text-secondary":"")??""}`),j(ot,` ${e(B).title??""}`)}),He(1,ke,()=>$e),He(2,ke,()=>$e),n(ee,ke)};M(Fe,ee=>{e(de)&&ee(Re)})}n(P,ue)}),a(X),C(()=>{se(X,`glass group relative px-3 py-1 shadow-sm border ${(e(w)?"border-lime-400 bg-lime-400/10":"")??""}`),se($,`flex items-center gap-2 ${(e(w)?"text-lime-500":"")??""} `),j(be,e(_).name)}),n(f,X)});var _e=d(E,2),Be=i(_e),G=x(()=>`../${(e(l)===e(h)?"checkmark.svg":"circle.svg")??""}`);W(Be,{get src(){return e(G)},class:"z-0 size-3 bg-secondary"}),Se(),a(_e),a(ne),a(q);var J=d(q,2),ce=i(J);{var Ne=f=>{Ht(f,{get proceed(){return e(u)},set proceed(_){N(u,k(_))}})},te=f=>{var _=V(),H=L(_);{var X=w=>{Wt(w,{get step(){return e(l)},set step(z){N(l,k(z))},get files(){return tt(),s()},set files(z){Ve(qe,k(z))}})},de=w=>{var z=V(),$=L(z);{var he=be=>{var xe=V();const Le=x(()=>r().filter(ye=>{var K;return ye.id===((K=e(O))==null?void 0:K.question_id)})[0]);var Oe=L(xe);St(Oe,()=>e(l),ye=>{var K=Xt(),we=i(K),je=i(we),P=i(je,!0);a(je);var B=d(je,2),Q=i(B),ue=i(Q,!0);a(Q);var fe=d(Q,2),Ie=i(fe,!0);a(fe),a(B),a(we);var Fe=d(we,2),Re=i(Fe);Pt(Re,{get question(){return e(Le)},get answer(){return e(O)},get proceed(){return e(u)},set proceed(ee){N(u,k(ee))}}),a(Fe),a(K),C(()=>{var ee;j(P,(ee=e(I))==null?void 0:ee.file),j(ue,(e(l)-1)%r().length+1),j(Ie,r().length)}),He(1,K,()=>_t),n(ye,K)}),n(be,xe)};M($,be=>{e(O)&&be(he)},!0)}n(w,z)};M(H,w=>{e(l)===e(h)?w(X):w(de,!1)},!0)}n(f,_)};M(ce,f=>{e(l)===0?f(Ne):f(te,!1)})}var A=d(ce,2),T=i(A);{var ae=f=>{var _=Qt();_.__click=[$t,oe],n(f,_)};M(T,f=>{e(l)>=1&&e(l)!==e(h)&&f(ae)})}var re=d(T,2);At(re);var me=d(re,2);{var ve=f=>{var _=V(),H=L(_);{var X=w=>{var z=ta();z.__click=[ea,oe],n(w,z)},de=w=>{var z=aa(),$=i(z);W($,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),Se(),a(z),n(w,z)};M(H,w=>{e(u)?w(X):w(de,!1)})}n(f,_)};M(me,f=>{e(l)<e(h)&&f(ve)})}a(A),a(J),a(U),C(()=>{se(D,`glass p-3 flex items-center gap-3 ${(e(l)===0?"bg-secondary/5 shadow-secondary/30 border-secondary text-secondary":"")??""}`),se(_e,`glass p-3 flex items-center gap-3 ${(e(l)===e(h)?"font-bold":"")??""}`)}),n(v,U)},R=v=>{var U=sa();n(v,U)};M(b,v=>{e(m)>640?v(F):v(R,!1)})}ht("innerWidth",v=>N(m,k(v))),n(o,S),De(),p()}Pe(["click"]);export{ka as component};

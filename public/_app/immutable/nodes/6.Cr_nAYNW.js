import{a as n,t as g,c as V,e as Ke}from"../chunks/disclose-version.B30PygmH.js";import{k as Xe,l as nt,_ as lt,aK as ct,ao as vt,j as dt,y as ut,x as ft,z as gt,U as pt,p as Ce,c as i,s as d,r as a,t as C,g as e,a as De,d as b,b as ie,a2 as We,ap as O,e as j,n as Se}from"../chunks/runtime.CRowtBbc.js";import{s as I}from"../chunks/render.BHNpU5Bx.js";import{i as M}from"../chunks/if.C2cCH_Za.js";import{e as ze,i as Me}from"../chunks/each.Csjyd5Lk.js";import{d as Pe,p as k,r as _t}from"../chunks/events.BqHwmKXL.js";import{r as Qe,s as se,b as et,M as W}from"../chunks/MaskedIcon.DfNimCu0.js";import{t as He,s as $e,a as mt}from"../chunks/index.DCPZGT8F.js";import{b as ht}from"../chunks/window.nNcBm8Oy.js";import{p as Y,s as Ye,a as Ue,m as tt,b as Ve}from"../chunks/props.C08js9P0.js";import"../chunks/legacy.GzLnPQkk.js";import{P as at}from"../chunks/public.CD978DOo.js";import{w as Ze}from"../chunks/index.RIEEZAD_.js";import{p as xt}from"../chunks/notifications.D2JqBFx3.js";import{b as bt,c as yt}from"../chunks/input.iYUWG3yA.js";import{S as wt}from"../chunks/SuggestiveInput.YMnaPHx3.js";import{o as kt}from"../chunks/index-client.CjYSU9sf.js";function St(o,t,c){Xe&&nt();var p=o,r=pt,s,m=lt()?ct:vt;dt(()=>{m(r,r=t())&&(s&&ut(s),s=ft(()=>c(p)))}),Xe&&(p=gt)}var ge=(o=>(o[o.Text=0]="Text",o[o.Select=1]="Select",o[o.MultiSelect=2]="MultiSelect",o[o.Tags=3]="Tags",o[o.MultiText=4]="MultiText",o))(ge||{});const qe=Ze(),rt=Ze([]),st=Ze([]);async function qt(){const o=await fetch(`${at}/api/questions`),{questions:t,available_tags:c}=await o.json();rt.set(t.toSorted((p,r)=>p.id-r.id)),st.set(c)}async function zt(o,t){for(let c of Array.from(o)){const p=t.find(s=>s.file===c.name);if(!p){console.error(`Unable to find answers for file ${c.name}`);continue}const r=new FormData;r.append("answers",JSON.stringify(p.answers)),r.append("file",c,c.name),await fetch(`${at}/api/answers`,{method:"POST",body:r})}xt({title:"Success",body:"Submission successful."})}var Mt=g('<div class="flex-1"></div>');function At(o){var t=Mt();n(o,t)}var Tt=(o,t)=>t(o),Nt=g('<label><input class="hidden" type="checkbox"> </label>');function jt(o,t){Ce(t,!0);let c=Y(t,"group",31,()=>k([]));Y(t,"class",3,"");let p=Y(t,"multiple",3,!0);const r=()=>typeof t.value=="number"?+t.value:t.value;let s=b(()=>c().includes(r()));function m(y){const F=r();e(s)?c(c().filter(R=>R!==F)):c().includes(F)||(p()?c([...c(),F]):c([F]))}var u=Nt(),h=i(u);Qe(h),h.__change=[Tt,m];var l=d(h);a(u),C(()=>{se(u,`transition-all select-none glass px-5 py-3 ${(e(s)?"bg-secondary/10 text-secondary border-secondary hover:bg-red-100 hover:text-red-400 hover:border-red-400 ":"hover:bg-secondary/10 hover:border-secondary hover:text-accent")??""}`),et(h,t.value),I(l,` ${t.label??""}`)}),n(o,u),De()}Pe(["change"]);var It=g('<textarea placeholder="Answer here..." class="glass p-5 min-h-[100px] resize-none w-full"></textarea>'),Ft=g('<div class="flex items-center gap-3"><input placeholder="Type here..." class="glass p-5 py-2 resize-none w-full"> <div class="glass p-2 hover:bg-red-50 cursor-pointer"><!></div></div>'),Ut=g('<div class="grid w-full gap-3 py-5"></div>'),Ct=g('<div class="grid sm:flex gap-3 w-full items-stretch flex-wrap"></div>'),Dt=g('<div><div class="glass p-8"><div class="text-lg font-semibold"> </div> <div> </div></div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Pt(o,t){Ce(t,!0);const[c,p]=Ye(),r=()=>Ue(st,"$tagsStore",c);let s=Y(t,"answer",15),m=Y(t,"proceed",15,!1),u=ie(k(s().selection)),h=ie(k(s().text)),l=ie(k(s().tags)),y=ie(k([""]));We(()=>{var x;if(s(s().selection=e(u),!0),s(s().text=e(h),!0),s(s().tags=e(l),!0),t.question.question_type===ge.MultiText){const A=e(y).filter(D=>D.trim().length!==0);A.length>0&&s(s().text=JSON.stringify(A),!0)}m(s().selection.length>0||(((x=s().text)==null?void 0:x.length)??0)>0||s().tags.length>0)});var F=V(),R=O(F);{var oe=x=>{var A=Dt(),D=i(A),v=i(D),U=i(v,!0);a(v);var q=d(v,2),ne=i(q,!0);a(q),a(D);var P=d(D,2),le=i(P);{var pe=Z=>{var E=It();_t(E),bt(E,()=>e(h),Te=>j(h,Te)),n(Z,E)},Ae=Z=>{var E=V(),Te=O(E);{var _e=G=>{var J=Ut();ze(J,21,()=>e(y),Me,(ce,Ne,te)=>{var T=Ft(),N=i(T);Qe(N),N.__keyup=me=>{const ve=me.currentTarget.value??"";e(y)[te]=ve,ve.trim().length>0&&e(y).find(f=>f.length===0)===void 0&&j(y,k([...e(y),""]))};var ae=d(N,2);ae.__click=()=>{j(y,k(e(y).toSpliced(te,1))),j(y,k([...e(y)]))};var re=i(ae);W(re,{src:"/x-close.svg",class:"size-4 bg-red-600"}),a(ae),a(T),C(()=>et(N,e(y)[te])),n(ce,T)}),a(J),n(G,J)},Be=G=>{var J=V(),ce=O(J);{var Ne=T=>{wt(T,{get options(){return r()},get selected(){return e(l)},set selected(N){j(l,k(N))}})},te=T=>{var N=Ct();ze(N,21,()=>t.question.possible_answers.toSorted(),Me,(ae,re)=>{var me=b(()=>t.question.question_type===ge.MultiSelect);jt(ae,{get label(){return e(re).value},get value(){return e(re).id},get multiple(){return e(me)},get group(){return e(u)},set group(ve){j(u,k(ve))}})}),a(N),n(T,N)};M(ce,T=>{t.question.question_type===ge.Tags?T(Ne):T(te,!1)},!0)}n(G,J)};M(Te,G=>{t.question.question_type===ge.MultiText?G(_e):G(Be,!1)},!0)}n(Z,E)};M(le,Z=>{t.question.question_type===ge.Text?Z(pe):Z(Ae,!1)})}a(P),a(A),C(()=>{I(U,t.question.title),I(ne,t.question.text)}),n(x,A)},S=x=>{var A=Ke();C(()=>I(A,m(!0))),n(x,A)};M(R,x=>{s()?x(oe):x(S,!1)})}n(o,F),De(),p()}Pe(["keyup","click"]);var Bt=g('<div class="flex items-center justify-center p-5"><label for="file-upload" class="text-secondary glass bg-secondary/10 border-secondary/50 flex gap-3 p-2 py-1 items-center justify-center hover:brightness-[99%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/70"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Lt(o,t){let c=Y(t,"files",15);var p=Bt(),r=i(p),s=i(r),m=i(s);W(m,{src:"../sticker-circle.svg",class:"size-4 bg-secondary"}),a(s),Se(2),a(r);var u=d(r,2);a(p),yt(u,c),n(o,p)}var Ot=g('<li class="flex items-center gap-3"><!> </li>'),Rt=g('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Et=g('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Jt=g(`<div class="select-none flex flex-col gap-5"><div class="glass p-10"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div></div> <div class="glass p-5"><div><!></div> <div class="glass p-10"><!></div></div></div>`);function Ht(o,t){Ce(t,!0);const[c,p]=Ye(),r=()=>Ue(qe,"$filesStore",c);let s=Y(t,"proceed",15);We(()=>{var S;s((((S=r())==null?void 0:S.length)??0)>0)});var m=Jt(),u=d(i(m),2),h=i(u),l=i(h);Lt(l,{get files(){return tt(),r()},set files(S){Ve(qe,k(S))}}),a(h);var y=d(h,2),F=i(y);{var R=S=>{var x=Rt();const A=b(()=>Array.from(r()??[]).map(q=>q.name));var D=O(x),v=i(D);a(D);var U=d(D,2);ze(U,21,()=>e(A),Me,(q,ne)=>{var P=Ot(),le=i(P);W(le,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var pe=d(le);a(P),C(()=>I(pe,` ${e(ne)??""}`)),n(q,P)}),a(U),C(()=>{var q;return I(v,`Selected files (${((q=r())==null?void 0:q.length)??0??""}):`)}),n(S,x)},oe=S=>{var x=Et();n(S,x)};M(F,S=>{var x;(((x=r())==null?void 0:x.length)??0)>0?S(R):S(oe,!1)})}a(y),a(u),a(m),n(o,m),De(),p()}function Kt(o,t,c){t(0),c(void 0)}var Vt=g('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-primary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Wt(o,t){let c=Y(t,"step",15),p=Y(t,"files",15);var r=Vt(),s=i(r),m=d(i(s),6);m.__click=[Kt,c,p];var u=i(m);W(u,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),Se(3),a(m),a(s),a(r),n(o,r)}Pe(["click"]);var Yt=g('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Zt=g("<div><li><div><!> </div></li></div>"),Gt=g('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),Xt=g('<div class="flex flex-col gap-4"><div class="flex gap-5 m-auto text-center whitespace-nowrap"><div class="glass w-min p-5 py-2 rounded-full"> </div> <div class="glass w-min p-5 py-2 rounded-full"><span class="text-secondary"> </span> | <span class="opacity-30"> </span></div></div> <div class="flex-1"><!></div></div>'),$t=(o,t)=>t(!1),Qt=g('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),ea=(o,t)=>t(!0),ta=g('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),aa=g('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),ra=g('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="px-2 py-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),sa=g('<p class="text-accent text-center">Contribution is not supported on mobile devices due to poor user experience.</p>');function wa(o,t){Ce(t,!0);const[c,p]=Ye(),r=()=>Ue(rt,"$questionsStore",c),s=()=>Ue(qe,"$filesStore",c);kt(async()=>{await qt()});let m=ie(0),u=ie(!1),h=b(()=>{var v;return 1+r().length*(((v=s())==null?void 0:v.length)??1)}),l=ie(0),y=b(()=>Array.from(s()??[]).flatMap(v=>{const U=r().map(q=>({question_id:q.id,tags:[],selection:[]}));return{file:v.name,answers:U}})),F=b(()=>e(y)[Math.floor((e(l)-1)/r().length)]),R=b(()=>{var v;return(v=e(F))==null?void 0:v.answers[(e(l)-1)%r().length]});function oe(v){s()&&(j(l,k(Math.min(Math.max(e(l)+(v?1:-1),0),1+r().length*s().length))),j(u,!1))}We(()=>{if(e(l)===e(h)){const v=s();v&&v.length>0&&zt(v,e(y)),setTimeout(()=>{Ve(qe,void 0),j(l,0)},15e3)}});var S=V(),x=O(S);{var A=v=>{var U=ra(),q=i(U),ne=i(q),P=i(ne),le=i(P),pe=b(()=>`../${(e(l)>=1?"checkmark.svg":"circle.svg")??""}`);W(le,{get src(){return e(pe)},class:"size-3 bg-secondary"}),Se(),a(P);var Ae=d(P,2);{var Z=f=>{var _=Yt();n(f,_)};M(Ae,f=>{var _;(((_=s())==null?void 0:_.length)??0)>0&&f(Z)})}var E=d(Ae,2);ze(E,1,()=>Array.from(s()??[]),Me,(f,_,H)=>{var X=Gt();const de=b(()=>e(l)>=H*r().length+1&&e(l)<(H+1)*r().length+1),w=b(()=>e(l)>=(H+1)*r().length+1),z=b(()=>e(w)?"bg-lime-400":"bg-primary");var $=i(X),he=i($),xe=i(he,!0);a(he);var be=d(he,2),Le=b(()=>`../${(e(de)?"chevron-down.svg":e(w)?"checkmark.svg":"circle.svg")??""}`);W(be,{get src(){return e(Le)},get class(){return`size-3 ${e(z)??""}`}});var Oe=d(be,2);{var ye=B=>{var L=Ke();const Q=b(()=>e(_).name.slice(0,3)??""),ue=b(()=>e(_).name.slice(-5)??"");C(()=>I(L,`${e(Q)} ... ${e(ue)}`)),n(B,L)},K=B=>{var L=Ke();C(()=>I(L,e(_).name)),n(B,L)};M(Oe,B=>{e(_).name.length>10?B(ye):B(K,!1)})}a($);var we=d($,2);ze(we,1,r,Me,(B,L,Q)=>{var ue=V();const fe=b(()=>e(l)==1+Q+H*r().length),Ie=b(()=>e(l)>1+Q+H*r().length);var Fe=O(ue);{var Re=ee=>{var ke=Zt(),Ee=i(ke),Je=i(Ee),Ge=i(Je),it=b(()=>`../${(e(Ie)?"checkmark.svg":e(fe)?"chevron-right.svg":"circle.svg")??""}`);W(Ge,{get src(){return e(it)},class:"w-3 h-3 bg-secondary"});var ot=d(Ge);a(Je),a(Ee),a(ke),C(()=>{se(Ee,`pt-2 pl-5 ${(e(Ie)||e(fe)?"":"opacity-30")??""}`),se(Je,`flex gap-3 items-center ${(e(fe)?"text-secondary":"")??""}`),I(ot,` ${e(L).title??""}`)}),He(1,ke,()=>$e),He(2,ke,()=>$e),n(ee,ke)};M(Fe,ee=>{e(de)&&ee(Re)})}n(B,ue)}),a(X),C(()=>{se(X,`glass group relative px-3 py-1 shadow-sm border ${(e(w)?"border-lime-400 bg-lime-400/10":"")??""}`),se($,`flex items-center gap-2 ${(e(w)?"text-lime-500":"")??""} `),I(xe,e(_).name)}),n(f,X)});var _e=d(E,2),Be=i(_e),G=b(()=>`../${(e(l)===e(h)?"checkmark.svg":"circle.svg")??""}`);W(Be,{get src(){return e(G)},class:"z-0 size-3 bg-secondary"}),Se(),a(_e),a(ne),a(q);var J=d(q,2),ce=i(J);{var Ne=f=>{Ht(f,{get proceed(){return e(u)},set proceed(_){j(u,k(_))}})},te=f=>{var _=V(),H=O(_);{var X=w=>{Wt(w,{get step(){return e(l)},set step(z){j(l,k(z))},get files(){return tt(),s()},set files(z){Ve(qe,k(z))}})},de=w=>{var z=V(),$=O(z);{var he=xe=>{var be=V();const Le=b(()=>r().filter(ye=>{var K;return ye.id===((K=e(R))==null?void 0:K.question_id)})[0]);var Oe=O(be);St(Oe,()=>e(l),ye=>{var K=Xt(),we=i(K),je=i(we),B=i(je,!0);a(je);var L=d(je,2),Q=i(L),ue=i(Q,!0);a(Q);var fe=d(Q,2),Ie=i(fe,!0);a(fe),a(L),a(we);var Fe=d(we,2),Re=i(Fe);Pt(Re,{get question(){return e(Le)},get answer(){return e(R)},get proceed(){return e(u)},set proceed(ee){j(u,k(ee))}}),a(Fe),a(K),C(()=>{var ee;I(B,(ee=e(F))==null?void 0:ee.file),I(ue,(e(l)-1)%r().length+1),I(Ie,r().length)}),He(1,K,()=>mt),n(ye,K)}),n(xe,be)};M($,xe=>{e(R)&&xe(he)},!0)}n(w,z)};M(H,w=>{e(l)===e(h)?w(X):w(de,!1)},!0)}n(f,_)};M(ce,f=>{e(l)===0?f(Ne):f(te,!1)})}var T=d(ce,2),N=i(T);{var ae=f=>{var _=Qt();_.__click=[$t,oe],n(f,_)};M(N,f=>{e(l)>=1&&e(l)!==e(h)&&f(ae)})}var re=d(N,2);At(re);var me=d(re,2);{var ve=f=>{var _=V(),H=O(_);{var X=w=>{var z=ta();z.__click=[ea,oe],n(w,z)},de=w=>{var z=aa(),$=i(z);W($,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),Se(),a(z),n(w,z)};M(H,w=>{e(u)?w(X):w(de,!1)})}n(f,_)};M(me,f=>{e(l)<e(h)&&f(ve)})}a(T),a(J),a(U),C(()=>{se(P,`glass px-3 py-2 flex items-center gap-3 ${(e(l)===0?"bg-secondary/5 shadow-secondary/30 border-secondary text-secondary":"")??""}`),se(_e,`glass px-3 py-2 flex items-center gap-3 ${(e(l)===e(h)?"font-bold":"")??""}`)}),n(v,U)},D=v=>{var U=sa();n(v,U)};M(x,v=>{e(m)>640?v(A):v(D,!1)})}ht("innerWidth",v=>j(m,k(v))),n(o,S),De(),p()}Pe(["click"]);export{wa as component};

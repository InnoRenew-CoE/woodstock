import{a as n,t as p,c as te,e as Ke}from"../chunks/disclose-version.B8FhMCHa.js";import{l as Qe,o as ct,Y as ut,aK as gt,ah as ft,k as pt,A as _t,z as mt,x as xt,ao as bt,p as Te,c as a,s as d,r as t,t as N,g as e,a as Ie,d as S,b as ue,a1 as Ze,ap as X,e as O,n as Ce}from"../chunks/runtime.Twxei6D9.js";import{s as j,i as A}from"../chunks/if.D8Ga6OrE.js";import{e as he,i as ye}from"../chunks/each.D4Yknd68.js";import{d as Be,p as z,r as ht}from"../chunks/events.cLB7s__O.js";import{r as rt,a as ce,b as st,M as ae,s as yt}from"../chunks/MaskedIcon.Bv3Qvdar.js";import{t as De,a as it,s as et}from"../chunks/index.DWwqrxLx.js";import{b as wt}from"../chunks/window.DDrw6ikS.js";import{p as E,s as Oe,a as we,m as Ve,b as We}from"../chunks/props.DW8d2wJc.js";import"../chunks/legacy.CuZUSs6W.js";import{P as ot}from"../chunks/public.CD978DOo.js";import{w as Ne}from"../chunks/index.tARBV8wy.js";import{b as kt,c as St}from"../chunks/input.zAG3t_j5.js";import{S as qt}from"../chunks/SuggestiveInput.Bm1zWyn5.js";import{o as zt}from"../chunks/index-client.W6R2iQDr.js";function Mt(l,r,v){Qe&&ct();var w=l,o=bt,s,_=ut()?gt:ft;pt(()=>{_(o,o=r())&&(s&&_t(s),s=mt(()=>v(w)))}),Qe&&(w=xt)}var be=(l=>(l[l.Text=0]="Text",l[l.Select=1]="Select",l[l.MultiSelect=2]="MultiSelect",l[l.Tags=3]="Tags",l[l.MultiText=4]="MultiText",l))(be||{});const Xe=Ne([]),Le=Ne(),tt=Ne(),lt=Ne([]),nt=Ne([]);async function At(){const l=await fetch(`${ot}/api/questions`),{questions:r,available_tags:v}=await l.json();lt.set(r.toSorted((w,o)=>w.id-o.id)),nt.set(v)}async function Ft(l,r){Xe.set(Array.from(l).map(v=>({file:v.name,progress:0})));for(let v of Array.from(l)){const w=r.find(_=>_.file===v.name);if(!w){console.error(`Unable to find answers for file ${v.name}`);continue}const o=new FormData;o.append("answers",JSON.stringify(w.answers)),o.append("file",v,v.name);const s=new XMLHttpRequest;s.open("POST",`${ot}/api/answers`),s.upload.onprogress=_=>{if(_.lengthComputable){const c=_.loaded/_.total*100,f=c.toFixed(2);console.log(`Uploaded: ${f}%`),Xe.update(i=>{const g=i.find(h=>h.file===v.name);return g&&(g.progress=c),i})}},s.send(o)}}var jt=p('<div class="flex-1"></div>');function Tt(l){var r=jt();n(l,r)}var It=(l,r)=>r(l),Nt=p('<label><input class="hidden" type="checkbox"> </label>');function Pt(l,r){Te(r,!0);let v=E(r,"group",31,()=>z([]));E(r,"class",3,"");let w=E(r,"multiple",3,!0);const o=()=>typeof r.value=="number"?+r.value:r.value;let s=S(()=>v().includes(o()));function _(g){const h=o();e(s)?v(v().filter(R=>R!==h)):v().includes(h)||(w()?v([...v(),h]):v([h]))}var c=Nt(),f=a(c);rt(f),f.__change=[It,_];var i=d(f);t(c),N(()=>{ce(c,`transition-all select-none glass px-5 py-3 ${(e(s)?"bg-secondary/10 text-secondary border-secondary hover:bg-red-100 hover:text-red-400 hover:border-red-400 ":"hover:bg-secondary/10 hover:border-secondary hover:text-accent")??""}`),st(f,r.value),j(i,` ${r.label??""}`)}),n(l,c),Ie()}Be(["change"]);var Ut=p('<textarea placeholder="Answer here..." class="glass p-5 min-h-[100px] resize-none w-full"></textarea>'),$t=p('<div class="flex items-center gap-3"><input placeholder="Type here..." class="glass p-5 py-2 resize-none w-full"> <div class="glass p-2 hover:bg-red-50 cursor-pointer"><!></div></div>'),Ct=p('<div class="grid w-full gap-3 py-5"></div>'),Dt=p('<div class="grid sm:flex gap-3 w-full items-stretch flex-wrap"></div>'),Lt=p('<div><div class="glass p-8"><div class="text-lg font-semibold"> </div> <div> </div></div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Bt(l,r){Te(r,!0);const[v,w]=Oe(),o=()=>we(nt,"$tagsStore",v);let s=E(r,"answer",15),_=E(r,"proceed",15,!1),c=ue(z(s().selection)),f=ue(z(s().text)),i=ue(z(s().tags)),g=ue(z([""]));Ze(()=>{var y;if(s(s().selection=e(c),!0),s(s().text=e(f),!0),s(s().tags=e(i),!0),r.question.question_type===be.MultiText){const F=e(g).filter(P=>P.trim().length!==0);F.length>0&&s(s().text=JSON.stringify(F),!0)}_(s().selection.length>0||(((y=s().text)==null?void 0:y.length)??0)>0||s().tags.length>0)});var h=te(),R=X(h);{var U=y=>{var F=Lt(),P=a(F),u=a(P),T=a(u,!0);t(u);var $=d(u,2),Z=a($,!0);t($),t(P);var Y=d(P,2),ke=a(Y);{var x=H=>{var C=Ut();ht(C),kt(C,()=>e(f),ge=>O(f,ge)),n(H,C)},M=H=>{var C=te(),ge=X(C);{var re=K=>{var D=Ct();he(D,21,()=>e(g),ye,(G,fe,ne)=>{var L=$t(),B=a(L);rt(B),B.__keyup=Se=>{const pe=Se.currentTarget.value??"";e(g)[ne]=pe,pe.trim().length>0&&e(g).find(m=>m.length===0)===void 0&&O(g,z([...e(g),""]))};var de=d(B,2);de.__click=()=>{O(g,z(e(g).toSpliced(ne,1))),O(g,z([...e(g)]))};var ve=a(de);ae(ve,{src:"/x-close.svg",class:"size-4 bg-red-600"}),t(de),t(L),N(()=>st(B,e(g)[ne])),n(G,L)}),t(D),n(K,D)},J=K=>{var D=te(),G=X(D);{var fe=L=>{qt(L,{get options(){return o()},get selected(){return e(i)},set selected(B){O(i,z(B))}})},ne=L=>{var B=Dt();he(B,21,()=>r.question.possible_answers.toSorted(),ye,(de,ve)=>{var Se=S(()=>r.question.question_type===be.MultiSelect);Pt(de,{get label(){return e(ve).value},get value(){return e(ve).id},get multiple(){return e(Se)},get group(){return e(c)},set group(pe){O(c,z(pe))}})}),t(B),n(L,B)};A(G,L=>{r.question.question_type===be.Tags?L(fe):L(ne,!1)},!0)}n(K,D)};A(ge,K=>{r.question.question_type===be.MultiText?K(re):K(J,!1)},!0)}n(H,C)};A(ke,H=>{r.question.question_type===be.Text?H(x):H(M,!1)})}t(Y),t(F),N(()=>{j(T,r.question.title),j(Z,r.question.text)}),n(y,F)},k=y=>{var F=Ke();N(()=>j(F,_(!0))),n(y,F)};A(R,y=>{s()?y(U):y(k,!1)})}n(l,h),Ie(),w()}Be(["keyup","click"]);var Ot=p('<div class="w-min text-nowrap"><label for="file-upload" class="text-secondary/80 glass bg-secondary/10 border-secondary/50 flex gap-3 p-2 py-1 items-center justify-center hover:brightness-[90%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/70"><!></div> <div class="text-center px-5"> </div></label> <input id="file-upload" class="hidden" type="file"></div>');function at(l,r){let v=E(r,"text",3,"Select files"),w=E(r,"files",15),o=E(r,"multiple",3,!0);var s=Ot(),_=a(s),c=a(_),f=a(c);ae(f,{src:"../download.svg",class:"size-4 bg-secondary rotate-180"}),t(c);var i=d(c,2),g=a(i,!0);t(i),t(_);var h=d(_,2);t(s),N(()=>{j(g,v()),h.multiple=o()}),St(h,w),n(l,s)}var Rt=p('<button class="bg-primary p-3 rounded-sm text-white">Submit</button>'),Yt=p('<li class="flex items-center gap-3"><!> </li>'),Et=p('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Ht=p('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Jt=p(`<div class="select-none flex flex-col gap-5"><div class="glass p-10"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div></div> <div class="grid glass p-5 gap-3"><div class="p-3 glass grid text-center grid-cols-[1fr_50px_1fr] gap-10 items-center justify-center"><div class="grid gap-3"><div class="text-primary/50">Upload files individually.</div> <div class="flex items-center justify-center"><!></div></div> <div class="uppercase opacity-60 rounded border-y bg-secondary/20 border-secondary/60 h-full w-0.5 m-auto"></div> <div class="grid gap-3 items-center m-auto"><div class="text-primary/50">Fill out an excel file and upload it for us to process it later.</div> <a target="_blank" href="../template.xlsm" class="w-min text-nowrap glass px-2 py-1 text-green-600/80 glass bg-green-600/10 border-green-600/50 flex gap-3 items-center justify-center hover:brightness-[90%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/80 border-green-600/30"><!></div> <div class="text-center px-5">Download excel template</div></a> <!> <!></div></div> <div class="glass p-10"><!></div></div></div>`);function Kt(l,r){Te(r,!0);const[v,w]=Oe(),o=()=>we(Le,"$filesStore",v),s=()=>we(tt,"$templateStore",v);let _=E(r,"proceed",15);Ze(()=>{var x;_((((x=o())==null?void 0:x.length)??0)>0)});var c=Jt(),f=d(a(c),2),i=a(f),g=a(i),h=d(a(g),2),R=a(h);at(R,{text:"Select files",multiple:!0,get files(){return Ve(),o()},set files(x){We(Le,z(x))}}),t(h),t(g);var U=d(g,4),k=d(a(U),2),y=a(k),F=a(y);ae(F,{src:"../download.svg",class:"size-4 bg-green-600"}),t(y),Ce(2),t(k);var P=d(k,2);at(P,{text:"Select excel file",multiple:!1,get files(){return Ve(),s()},set files(x){We(tt,z(x))}});var u=d(P,2);{var T=x=>{var M=Rt();n(x,M)};A(u,x=>{var M;(((M=s())==null?void 0:M.length)??0)>0&&x(T)})}t(U),t(i);var $=d(i,2),Z=a($);{var Y=x=>{var M=Et();const H=S(()=>Array.from(o()??[]).map(J=>J.name));var C=X(M),ge=a(C);t(C);var re=d(C,2);he(re,21,()=>e(H),ye,(J,K)=>{var D=Yt(),G=a(D);ae(G,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var fe=d(G);t(D),N(()=>j(fe,` ${e(K)??""}`)),n(J,D)}),t(re),N(()=>{var J;return j(ge,`Selected files (${((J=o())==null?void 0:J.length)??0??""}):`)}),n(x,M)},ke=x=>{var M=Ht();n(x,M)};A(Z,x=>{var M;(((M=o())==null?void 0:M.length)??0)>0?x(Y):x(ke,!1)})}t($),t(f),t(c),n(l,c),Ie(),w()}function Vt(l,r,v){r(0),v(void 0)}var Wt=p('<li><div class="flex gap-3"><div class="truncate w-[200px]"> </div> <div class="w-full bg-gray-50 border border-primary/10 glass overflow-hidden rounded-sm"><div class="bg-secondary/80 w-[0%] h-full transition-all glass rounded-sm"></div></div> <div class="w-[20%] text-right font-light"> </div></div></li>'),Xt=p('<div><div class="w-full border-b border-accent/10 mb-5"></div> <span class="font-nunito">You can safely close the tab or continue to upload more files.</span> <button class="px-3 py-2 rounded my-3 flex items-center gap-2 justify-center bg-secondary text-white">Upload more</button></div>'),Zt=p('<div class="flex justify-center p-5"><div class="w-full"><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div class="font-light">Thank you for answering our questions. Your files and answers are being uploaded and safely stored.</div> <div class="font-light text-red-400">Note: Indexing and processing happen in the background and may take some time before results are available.</div> <div class="glass p-5 my-5"><span class="font-mono text-xs uppercase">Progress</span> <ul class="space-y-2"></ul></div> <!></div></div>');function Gt(l,r){Te(r,!0);const[v,w]=Oe(),o=()=>we(Xe,"$uploadProgressStore",v);let s=E(r,"step",15),_=E(r,"files",15);var c=Zt(),f=a(c),i=d(a(f),8),g=d(a(i),2);he(g,5,o,ye,(U,k)=>{var y=Wt(),F=a(y),P=a(F),u=a(P,!0);t(P);var T=d(P,2),$=a(T);t(T);var Z=d(T,2),Y=a(Z);N(()=>j(Y,`${e(k).progress.toFixed(0)??""}%`)),t(Z),t(F),t(y),N(()=>{j(u,e(k).file),yt($,"style",`width: ${e(k).progress??""}%`)}),n(U,y)}),t(g),t(i);var h=d(i,2);{var R=U=>{var k=Xt(),y=d(a(k),4);y.__click=[Vt,s,_],t(k),De(1,k,()=>it),n(U,k)};A(h,U=>{o().every(k=>k.progress>=100)&&U(R)})}t(f),t(c),n(l,c),Ie(),w()}Be(["click"]);var Qt=p('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),ea=p("<div><li><div><!> </div></li></div>"),ta=p('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),aa=p('<div class="flex flex-col gap-4"><div class="flex gap-5 m-auto text-center whitespace-nowrap"><div class="glass w-min p-5 py-2 rounded-full"> </div> <div class="glass w-min p-5 py-2 rounded-full"><span class="text-secondary"> </span> | <span class="opacity-30"> </span></div></div> <div class="flex-1"><!></div></div>'),ra=(l,r)=>r(!1),sa=p('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),ia=(l,r)=>r(!0),oa=p('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),la=p('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),na=p('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="px-2 py-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),da=p('<div class="flex items-center justify-center h-full"><div class="glass text-primary p-10 shadow-lg w-[90%] max-w-[500px]">Contribution is not supported on mobile devices due to poor user experience.</div></div>');function qa(l,r){Te(r,!0);const[v,w]=Oe(),o=()=>we(lt,"$questionsStore",v),s=()=>we(Le,"$filesStore",v);zt(async()=>{await At()});let _=ue(0),c=ue(!1),f=S(()=>{var u;return 1+o().length*(((u=s())==null?void 0:u.length)??1)}),i=ue(0),g=S(()=>Array.from(s()??[]).flatMap(u=>{const T=o().map($=>({question_id:$.id,tags:[],selection:[]}));return{file:u.name,answers:T}})),h=S(()=>e(g)[Math.floor((e(i)-1)/o().length)]),R=S(()=>{var u;return(u=e(h))==null?void 0:u.answers[(e(i)-1)%o().length]});function U(u){s()&&(O(i,z(Math.min(Math.max(e(i)+(u?1:-1),0),1+o().length*s().length))),O(c,!1))}Ze(()=>{if(e(i)===e(f)){const u=s();u&&u.length>0&&Ft(u,e(g))}});var k=te(),y=X(k);{var F=u=>{var T=na(),$=a(T),Z=a($),Y=a(Z),ke=a(Y),x=S(()=>`../${(e(i)>=1?"checkmark.svg":"circle.svg")??""}`);ae(ke,{get src(){return e(x)},class:"size-3 bg-secondary"}),Ce(),t(Y);var M=d(Y,2);{var H=m=>{var b=Qt();n(m,b)};A(M,m=>{var b;(((b=s())==null?void 0:b.length)??0)>0&&m(H)})}var C=d(M,2);he(C,1,()=>Array.from(s()??[]),ye,(m,b,Q)=>{var se=ta();const _e=S(()=>e(i)>=Q*o().length+1&&e(i)<(Q+1)*o().length+1),q=S(()=>e(i)>=(Q+1)*o().length+1),I=S(()=>e(q)?"bg-lime-400":"bg-primary");var ie=a(se),qe=a(ie),ze=a(qe,!0);t(qe);var Me=d(qe,2),Re=S(()=>`../${(e(_e)?"chevron-down.svg":e(q)?"checkmark.svg":"circle.svg")??""}`);ae(Me,{get src(){return e(Re)},get class(){return`size-3 ${e(I)??""}`}});var Ye=d(Me,2);{var Ae=V=>{var W=Ke();const oe=S(()=>e(b).name.slice(0,3)??""),me=S(()=>e(b).name.slice(-5)??"");N(()=>j(W,`${e(oe)} ... ${e(me)}`)),n(V,W)},ee=V=>{var W=Ke();N(()=>j(W,e(b).name)),n(V,W)};A(Ye,V=>{e(b).name.length>10?V(Ae):V(ee,!1)})}t(ie);var Fe=d(ie,2);he(Fe,1,o,ye,(V,W,oe)=>{var me=te();const xe=S(()=>e(i)==1+oe+Q*o().length),Ue=S(()=>e(i)>1+oe+Q*o().length);var $e=X(me);{var Ee=le=>{var je=ea(),He=a(je),Je=a(He),Ge=a(Je),dt=S(()=>`../${(e(Ue)?"checkmark.svg":e(xe)?"chevron-right.svg":"circle.svg")??""}`);ae(Ge,{get src(){return e(dt)},class:"w-3 h-3 bg-secondary"});var vt=d(Ge);t(Je),t(He),t(je),N(()=>{ce(He,`pt-2 pl-5 ${(e(Ue)||e(xe)?"":"opacity-30")??""}`),ce(Je,`flex gap-3 items-center ${(e(xe)?"text-secondary":"")??""}`),j(vt,` ${e(W).title??""}`)}),De(1,je,()=>et),De(2,je,()=>et),n(le,je)};A($e,le=>{e(_e)&&le(Ee)})}n(V,me)}),t(se),N(()=>{ce(se,`glass group relative px-3 py-1 shadow-sm border ${(e(q)?"border-lime-400 bg-lime-400/10":"")??""}`),ce(ie,`flex items-center gap-2 ${(e(q)?"text-lime-500":"")??""} `),j(ze,e(b).name)}),n(m,se)});var re=d(C,2),J=a(re),K=S(()=>`../${(e(i)===e(f)?"checkmark.svg":"circle.svg")??""}`);ae(J,{get src(){return e(K)},class:"z-0 size-3 bg-secondary"}),Ce(),t(re),t(Z),t($);var D=d($,2),G=a(D);{var fe=m=>{Kt(m,{get proceed(){return e(c)},set proceed(b){O(c,z(b))}})},ne=m=>{var b=te(),Q=X(b);{var se=q=>{Gt(q,{get step(){return e(i)},set step(I){O(i,z(I))},get files(){return Ve(),s()},set files(I){We(Le,z(I))}})},_e=q=>{var I=te(),ie=X(I);{var qe=ze=>{var Me=te();const Re=S(()=>o().filter(Ae=>{var ee;return Ae.id===((ee=e(R))==null?void 0:ee.question_id)})[0]);var Ye=X(Me);Mt(Ye,()=>e(i),Ae=>{var ee=aa(),Fe=a(ee),Pe=a(Fe),V=a(Pe,!0);t(Pe);var W=d(Pe,2),oe=a(W),me=a(oe,!0);t(oe);var xe=d(oe,2),Ue=a(xe,!0);t(xe),t(W),t(Fe);var $e=d(Fe,2),Ee=a($e);Bt(Ee,{get question(){return e(Re)},get answer(){return e(R)},get proceed(){return e(c)},set proceed(le){O(c,z(le))}}),t($e),t(ee),N(()=>{var le;j(V,(le=e(h))==null?void 0:le.file),j(me,(e(i)-1)%o().length+1),j(Ue,o().length)}),De(1,ee,()=>it),n(Ae,ee)}),n(ze,Me)};A(ie,ze=>{e(R)&&ze(qe)},!0)}n(q,I)};A(Q,q=>{e(i)===e(f)?q(se):q(_e,!1)},!0)}n(m,b)};A(G,m=>{e(i)===0?m(fe):m(ne,!1)})}var L=d(G,2),B=a(L);{var de=m=>{var b=sa();b.__click=[ra,U],n(m,b)};A(B,m=>{e(i)>=1&&e(i)!==e(f)&&m(de)})}var ve=d(B,2);Tt(ve);var Se=d(ve,2);{var pe=m=>{var b=te(),Q=X(b);{var se=q=>{var I=oa();I.__click=[ia,U],n(q,I)},_e=q=>{var I=la(),ie=a(I);ae(ie,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),Ce(),t(I),n(q,I)};A(Q,q=>{e(c)?q(se):q(_e,!1)})}n(m,b)};A(Se,m=>{e(i)<e(f)&&m(pe)})}t(L),t(D),t(T),N(()=>{ce(Y,`glass px-3 py-2 flex items-center gap-3 ${(e(i)===0?"bg-secondary/5 shadow-secondary/30 border-secondary text-secondary":"")??""}`),ce(re,`glass px-3 py-2 flex items-center gap-3 ${(e(i)===e(f)?"font-bold":"")??""}`)}),n(u,T)},P=u=>{var T=da();n(u,T)};A(y,u=>{e(_)>1e3?u(F):u(P,!1)})}wt("innerWidth",u=>O(_,z(u))),n(l,k),Ie(),w()}Be(["click"]);export{qa as component};

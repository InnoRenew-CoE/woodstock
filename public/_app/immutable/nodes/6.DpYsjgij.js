import{a as d,t as h,c as R,e as ot}from"../chunks/disclose-version.c5RT6EqX.js";import{l as Je,ac as it,k as nt,aK as lt,Y as ct,m as dt,am as vt,o as ut,x as ft,a1 as gt,p as Ae,c as s,s as v,r as a,t as C,g as e,a as Me,d as x,b as ee,A as Pe,f as j,e as F,n as ue}from"../chunks/runtime.DYzcDKcF.js";import{s as z,i as q}from"../chunks/if.Ba5utbC_.js";import{e as Se,i as qe,t as Ue,s as Ke,a as pt}from"../chunks/index.B3UbB_ia.js";import{d as Be}from"../chunks/events.CeP5UziP.js";import{r as _t,s as Z,b as mt,M as V}from"../chunks/MaskedIcon.CgIIQlzR.js";import{p as A,r as bt}from"../chunks/misc.zxKZcHum.js";import{b as ht}from"../chunks/window.UegVglPn.js";import{p as E,s as Le,a as ze,m as Ve,b as De}from"../chunks/props.Dq7OeSMe.js";import"../chunks/legacy.GvCdE96b.js";import{P as We}from"../chunks/public.CD978DOo.js";import{w as Re}from"../chunks/index.B2dr9N-b.js";import{p as yt}from"../chunks/notifications.Q_goho1Y.js";import{b as xt,c as wt}from"../chunks/input.B4lCoamq.js";import{S as kt}from"../chunks/SuggestiveInput.zsVi4K-w.js";import{o as St}from"../chunks/index-client.CqnO2eDw.js";function qt(i,t,l){Je&&it();var f=i,r=gt,o,m=nt()?lt:ct;dt(()=>{m(r,r=t())&&(o&&vt(o),o=ut(()=>l(f)))}),Je&&(f=ft)}var ke=(i=>(i[i.Text=0]="Text",i[i.Select=1]="Select",i[i.MultiSelect=2]="MultiSelect",i[i.Tags=3]="Tags",i))(ke||{});const fe=Re(),Ze=Re([]),Ge=Re([]);async function zt(){const i=await fetch(`${We}/api/questions`),{questions:t,available_tags:l}=await i.json();Ze.set(t.toSorted((f,r)=>f.id-r.id)),Ge.set(l)}async function At(i,t){for(let l of Array.from(i)){const f=t.find(o=>o.file===l.name);if(!f){console.error(`Unable to find answers for file ${l.name}`);continue}const r=new FormData;r.append("answers",JSON.stringify(f.answers)),r.append("file",l,l.name),await fetch(`${We}/api/answers`,{method:"POST",body:r})}yt({title:"Success",body:"Submission successful."})}var Mt=h('<div class="flex-1"></div>');function $t(i){var t=Mt();d(i,t)}var It=(i,t)=>t(i),Nt=h('<label><input class="hidden" type="checkbox"> </label>');function Ft(i,t){Ae(t,!0);let l=E(t,"group",31,()=>A([]));E(t,"class",3,"");let f=E(t,"multiple",3,!0);const r=()=>typeof t.value=="number"?+t.value:t.value;let o=x(()=>l().includes(r()));function m(O){const M=r();e(o)?l(l().filter(T=>T!==M)):l().includes(M)||(f()?l([...l(),M]):l([M]))}var u=Nt(),g=s(u);_t(g),g.__change=[It,m];var n=v(g);a(u),C(()=>{Z(u,`transition-all font-nunito select-none cursor-pointer px-4 py-2 rounded border ${(e(o)?"bg-accent/70 border-accent text-white":"border-gray-200 bg-gray-100 opacity-70 hover:opacity-100")??""} `),mt(g,t.value),z(n,` ${t.label??""}`)}),d(i,u),Me()}Be(["change"]);var jt=h('<textarea placeholder="Answer here..." class="p-5 min-h-[100px] resize-none w-full rounded border border-secondary shadow-xs shadow-secondary"></textarea>'),Ct=h('<div><div class="text-lg font-semibold"> </div> <div> </div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Tt(i,t){Ae(t,!0);const[l,f]=Le(),r=()=>ze(Ge,"$tagsStore",l);let o=E(t,"answer",15),m=E(t,"proceed",15,!1),u=ee(A(o().selection)),g=ee(A(o().text)),n=ee(A(o().tags));Pe(()=>{var p;o(o().selection=e(u),!0),o(o().text=e(g),!0),o(o().tags=e(n),!0),m(e(u).length>0||(((p=e(g))==null?void 0:p.length)??0)>0||e(n).length>0)});var O=R(),M=j(O);{var T=p=>{var I=Ct(),U=s(I),te=s(U,!0);a(U);var c=v(U,2),k=s(c,!0);a(c);var N=v(c,2),D=s(N);{var G=$=>{var Y=jt();bt(Y),xt(Y,()=>e(g),re=>F(g,re)),d($,Y)},X=$=>{var Y=R(),re=j(Y);{var ge=P=>{kt(P,{get options(){return r()},get selected(){return e(n)},set selected(ae){F(n,A(ae))}})},$e=P=>{var ae=R(),se=j(ae);Se(se,17,()=>t.question.possible_answers.toSorted(),qe,(Ie,pe)=>{var _e=x(()=>t.question.question_type===ke.MultiSelect);Ft(Ie,{get label(){return e(pe).value},get value(){return e(pe).id},get multiple(){return e(_e)},get group(){return e(u)},set group(me){F(u,A(me))}})}),d(P,ae)};q(re,P=>{t.question.question_type===ke.Tags?P(ge):P($e,!1)},!0)}d($,Y)};q(D,$=>{t.question.question_type===ke.Text?$(G):$(X,!1)})}a(N),a(I),C(()=>{z(te,t.question.title),z(k,t.question.text)}),d(p,I)},w=p=>{var I=ot();C(()=>z(I,m(!0))),d(p,I)};q(M,p=>{o()?p(T):p(w,!1)})}d(i,O),Me(),f()}var Ut=h('<div class="flex items-center justify-center p-5"><label for="file-upload" class="flex items-center rounded border border-secondary overflow-hidden group bg-secondary/10 hover:bg-secondary cursor-pointer hover:text-white"><div class="bg-secondary p-2 group-hover:bg-white"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Dt(i,t){let l=E(t,"files",15);var f=Ut(),r=s(f),o=s(r),m=s(o);V(m,{src:"../sticker-circle.svg",class:"size-4 bg-white group-hover:bg-secondary"}),a(o),ue(2),a(r);var u=v(r,2);a(f),wt(u,l),d(i,f)}var Pt=h('<li class="flex items-center gap-3"><!> </li>'),Bt=h('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Lt=h('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Rt=h(`<div class="select-none"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div> <div><div><!></div> <!></div></div>`);function Et(i,t){Ae(t,!0);const[l,f]=Le(),r=()=>ze(fe,"$filesStore",l);let o=E(t,"proceed",15);Pe(()=>{var w;o((((w=r())==null?void 0:w.length)??0)>0)});var m=Rt(),u=v(s(m),6),g=s(u),n=s(g);Dt(n,{get files(){return Ve(),r()},set files(w){De(fe,A(w))}}),a(g);var O=v(g,2);{var M=w=>{var p=Bt();const I=x(()=>Array.from(r()??[]).map(k=>k.name));var U=j(p),te=s(U);a(U);var c=v(U,2);Se(c,21,()=>e(I),qe,(k,N)=>{var D=Pt(),G=s(D);V(G,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var X=v(G);a(D),C(()=>z(X,` ${e(N)??""}`)),d(k,D)}),a(c),C(()=>{var k;return z(te,`Selected files (${((k=r())==null?void 0:k.length)??0??""}):`)}),d(w,p)},T=w=>{var p=Lt();d(w,p)};q(O,w=>{var p;(((p=r())==null?void 0:p.length)??0)>0?w(M):w(T,!1)})}a(u),a(m),d(i,m),Me(),f()}function Ot(i,t,l){t(0),l(void 0)}var Yt=h('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-primary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Ht(i,t){let l=E(t,"step",15),f=E(t,"files",15);var r=Yt(),o=s(r),m=v(s(o),6);m.__click=[Ot,l,f];var u=s(m);V(u,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),ue(3),a(m),a(o),a(r),d(i,r)}Be(["click"]);var Jt=h('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Kt=h("<div><li><div><!> </div></li></div>"),Vt=h('<div><div><!> <div class="z-10 absolute top-0 left-0 bg-gray-50 rounded p-5 border shadow shadow-secondary border-secondary group-hover:block right-0 hidden cursor-pointer"> </div></div> <!></div>'),Wt=h('<div><div class="text-center"><div class="font-bold"> </div> <div><span class="text-accent"> </span> | <span class="opacity-30"> </span></div></div> <!></div>'),Zt=(i,t)=>t(!1),Gt=h('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),Xt=(i,t)=>t(!0),Qt=h('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),er=h('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),tr=h('<div class="grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none bg-dark-background border border-secondary/50 p-3 rounded-lg"><p class="text-xs opacity-40 uppercase pb-2"> </p> <ul class="p-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="bg-dark-background border border-secondary/50 rounded-lg p-5 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),rr=h('<p class="text-accent text-center">Contribution is not supported on mobile devices due to poor user experience.</p>');function hr(i,t){Ae(t,!0);const[l,f]=Le(),r=()=>ze(Ze,"$questionsStore",l),o=()=>ze(fe,"$filesStore",l);St(async()=>{await zt()});let m=ee(0),u=ee(!1),g=x(()=>{var c;return 1+r().length*(((c=o())==null?void 0:c.length)??1)}),n=ee(0),O=x(()=>Array.from(o()??[]).flatMap(c=>{const k=r().map(N=>({question_id:N.id,tags:[],selection:[]}));return{file:c.name,answers:k}})),M=x(()=>e(O)[Math.floor((e(n)-1)/r().length)]),T=x(()=>{var c;return(c=e(M))==null?void 0:c.answers[(e(n)-1)%r().length]});function w(c){o()&&(F(n,A(Math.min(Math.max(e(n)+(c?1:-1),0),1+r().length*o().length))),F(u,!1))}Pe(()=>{if(e(n)===e(g)){const c=o();c&&c.length>0&&At(c,e(O)),setTimeout(()=>{De(fe,void 0),F(n,0)},15e3)}});var p=R(),I=j(p);{var U=c=>{var k=tr(),N=s(k),D=s(N),G=s(D);a(D);var X=v(D,2),$=s(X),Y=s($),re=x(()=>`../${(e(n)>=1?"checkmark.svg":"circle.svg")??""}`);V(Y,{get src(){return e(re)},class:"size-3 bg-primary"}),ue(),a($);var ge=v($,2);{var $e=_=>{var y=Jt();d(_,y)};q(ge,_=>{var y;(((y=o())==null?void 0:y.length)??0)>0&&_($e)})}var P=v(ge,2);Se(P,1,()=>Array.from(o()??[]),qe,(_,y,B)=>{var H=Vt();const W=x(()=>e(n)>=B*r().length+1&&e(n)<(B+1)*r().length+1),b=x(()=>e(n)>=(B+1)*r().length+1),S=x(()=>e(b)?"bg-lime-400":"bg-primary");var J=s(H),be=s(J),oe=x(()=>`../${(e(W)?"chevron-down.svg":e(b)?"checkmark.svg":"circle.svg")??""}`),he=x(()=>`${e(b)||e(W),"size-3"} ${e(S)??""}`);V(be,{get src(){return e(oe)},get class(){return e(he)}});var ye=v(be);C(()=>z(ye,` ... ${e(y).name.slice(-15)??""} `));var xe=v(ye),ie=s(xe,!0);a(xe),a(J);var L=v(J,2);Se(L,1,r,qe,(ne,Ne,le)=>{var Q=R();const ce=x(()=>e(n)==1+le+B*r().length),de=x(()=>e(n)>1+le+B*r().length);var Fe=j(Q);{var je=K=>{var ve=Kt(),Ce=s(ve),Te=s(Ce),He=s(Te),at=x(()=>`../${(e(de)?"checkmark.svg":e(ce)?"chevron-right.svg":"circle.svg")??""}`);V(He,{get src(){return e(at)},class:"w-3 h-3 bg-secondary"});var st=v(He);a(Te),a(Ce),a(ve),C(()=>{Z(Ce,`pt-2 pl-5 ${(e(de)||e(ce)?"":"opacity-30")??""}`),Z(Te,`flex gap-3 items-center ${(e(ce)?"font-bold text-secondary":"")??""}`),z(st,` ${e(Ne).title??""}`)}),Ue(1,ve,()=>Ke),Ue(2,ve,()=>Ke),d(K,ve)};q(Fe,K=>{e(W)&&K(je)})}d(ne,Q)}),a(H),C(()=>{Z(H,`group relative px-3 py-1 shadow-sm bg-secondary/10 border rounded-lg ${(e(b)?"border-lime-400 bg-lime-400/10":"border-secondary")??""}`),Z(J,`flex items-center gap-2 ${(e(b)?"text-lime-500":"")??""} `),z(ie,e(y).name)}),d(_,H)});var se=v(P,2),Ie=s(se),pe=x(()=>`../${(e(n)===e(g)?"checkmark.svg":"circle.svg")??""}`);V(Ie,{get src(){return e(pe)},class:"size-3 bg-secondary"}),ue(),a(se),a(X),a(N);var _e=v(N,2),me=s(_e);{var Xe=_=>{Et(_,{get proceed(){return e(u)},set proceed(y){F(u,A(y))}})},Qe=_=>{var y=R(),B=j(y);{var H=b=>{Ht(b,{get step(){return e(n)},set step(S){F(n,A(S))},get files(){return Ve(),o()},set files(S){De(fe,A(S))}})},W=b=>{var S=R(),J=j(S);{var be=oe=>{var he=R();const ye=x(()=>r().filter(ie=>{var L;return ie.id===((L=e(T))==null?void 0:L.question_id)})[0]);var xe=j(he);qt(xe,()=>e(n),ie=>{var L=Wt(),we=s(L),ne=s(we),Ne=s(ne,!0);a(ne);var le=v(ne,2),Q=s(le),ce=s(Q,!0);a(Q);var de=v(Q,2),Fe=s(de,!0);a(de),a(le),a(we);var je=v(we,2);Tt(je,{get question(){return e(ye)},get answer(){return e(T)},get proceed(){return e(u)},set proceed(K){F(u,A(K))}}),a(L),C(()=>{var K;z(Ne,(K=e(M))==null?void 0:K.file),z(ce,(e(n)-1)%r().length+1),z(Fe,r().length)}),Ue(1,L,()=>pt),d(ie,L)}),d(oe,he)};q(J,oe=>{e(T)&&oe(be)},!0)}d(b,S)};q(B,b=>{e(n)===e(g)?b(H):b(W,!1)},!0)}d(_,y)};q(me,_=>{e(n)===0?_(Xe):_(Qe,!1)})}var Ee=v(me,2),Oe=s(Ee);{var et=_=>{var y=Gt();y.__click=[Zt,w],d(_,y)};q(Oe,_=>{e(n)>=1&&e(n)!==e(g)&&_(et)})}var Ye=v(Oe,2);$t(Ye);var tt=v(Ye,2);{var rt=_=>{var y=R(),B=j(y);{var H=b=>{var S=Qt();S.__click=[Xt,w],d(b,S)},W=b=>{var S=er(),J=s(S);V(J,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),ue(),a(S),d(b,S)};q(B,b=>{e(u)?b(H):b(W,!1)})}d(_,y)};q(tt,_=>{e(n)<e(g)&&_(rt)})}a(Ee),a(_e),a(k),C(()=>{z(G,`Step ${e(n)??""} / ${e(g)??""}`),Z($,`flex items-center gap-3 ${(e(n)===0?"font-semibold":"")??""}`),Z(se,`flex items-center gap-3 ${(e(n)===e(g)?"font-bold":"opacity-45")??""}`)}),d(c,k)},te=c=>{var k=rr();d(c,k)};q(I,c=>{e(m)>640?c(U):c(te,!1)})}ht("innerWidth",c=>F(m,A(c))),d(i,p),Me(),f()}Be(["click"]);export{hr as component};

import{a as n,t as g,e as He,c as te}from"../chunks/disclose-version.63K3lu0i.js";import{k as Ze,ab as nt,j as lt,aK as ct,X as vt,l as dt,al as ut,m as ft,w as gt,a0 as pt,p as Fe,c as i,b as u,r as a,t as F,g as e,a as Ce,d as x,s as ne,z as Ve,n as ge,am as L,e as I}from"../chunks/runtime.C8AwBc5t.js";import{s as T,i as q}from"../chunks/if.C11h_86w.js";import{e as qe,i as ze,t as Ee,s as Ge,a as _t}from"../chunks/index.DODHKGVX.js";import{d as Ue}from"../chunks/events.YhuPyEO-.js";import{r as Qe,s as oe,b as et,M as V}from"../chunks/MaskedIcon.LE04YoFn.js";import{p as w,r as mt}from"../chunks/misc.y5E7LmGA.js";import{b as ht}from"../chunks/window.87UzKs2f.js";import{p as W,s as We,a as Ie,m as tt,b as Ke}from"../chunks/props.Dh3Lg4Sc.js";import"../chunks/legacy.rnUX894J.js";import{P as at}from"../chunks/public.CD978DOo.js";import{w as Xe}from"../chunks/index.BlsGO1ZL.js";import{p as bt}from"../chunks/notifications.C1upLsv_.js";import{b as xt,c as yt}from"../chunks/input.Y_bnVb-A.js";import{S as wt}from"../chunks/SuggestiveInput.BN9AMOrf.js";import{o as kt}from"../chunks/index-client.Bj5aEFiZ.js";function St(o,t,c){Ze&&nt();var _=o,r=pt,s,m=lt()?ct:vt;dt(()=>{m(r,r=t())&&(s&&ut(s),s=ft(()=>c(_)))}),Ze&&(_=gt)}var fe=(o=>(o[o.Text=0]="Text",o[o.Select=1]="Select",o[o.MultiSelect=2]="MultiSelect",o[o.Tags=3]="Tags",o[o.MultiText=4]="MultiText",o))(fe||{});const Se=Xe(),rt=Xe([]),st=Xe([]);async function qt(){const o=await fetch(`${at}/api/questions`),{questions:t,available_tags:c}=await o.json();rt.set(t.toSorted((_,r)=>_.id-r.id)),st.set(c)}async function zt(o,t){for(let c of Array.from(o)){const _=t.find(s=>s.file===c.name);if(!_){console.error(`Unable to find answers for file ${c.name}`);continue}const r=new FormData;r.append("answers",JSON.stringify(_.answers)),r.append("file",c,c.name),await fetch(`${at}/api/answers`,{method:"POST",body:r})}bt({title:"Success",body:"Submission successful."})}var Mt=g('<div class="flex-1"></div>');function At(o){var t=Mt();n(o,t)}var Tt=(o,t)=>t(o),Nt=g('<label><input class="hidden" type="checkbox"> </label>');function jt(o,t){Fe(t,!0);let c=W(t,"group",31,()=>w([]));W(t,"class",3,"");let _=W(t,"multiple",3,!0);const r=()=>typeof t.value=="number"?+t.value:t.value;let s=x(()=>c().includes(r()));function m(b){const C=r();e(s)?c(c().filter(P=>P!==C)):c().includes(C)||(_()?c([...c(),C]):c([C]))}var p=Nt(),h=i(p);Qe(h),h.__change=[Tt,m];var l=u(h);a(p),F(()=>{oe(p,`transition-all select-none glass px-5 py-3 ${(e(s)?"bg-secondary/10 text-secondary border-secondary hover:bg-red-100 hover:text-red-400 hover:border-red-400 ":"hover:bg-secondary/10 hover:border-secondary hover:text-accent")??""}`),et(h,t.value),T(l,` ${t.label??""}`)}),n(o,p),Ce()}Ue(["change"]);var It=g('<textarea placeholder="Answer here..." class="glass p-5 min-h-[100px] resize-none w-full"></textarea>'),Ft=g('<div class="flex items-center gap-3"><input placeholder="Type here..." class="glass p-5 py-2 resize-none w-full"> <div class="glass p-2 hover:bg-red-50 cursor-pointer"><!></div></div>'),Ct=g('<div class="grid w-full gap-3 py-5"></div>'),Ut=g('<div class="grid sm:flex gap-3 w-full items-stretch flex-wrap"></div>'),Dt=g('<div><div class="glass p-8"><div class="text-lg font-semibold"> </div> <div> </div></div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>'),Pt=g(" <!>",1);function Ot(o,t){Fe(t,!0);const[c,_]=We(),r=()=>Ie(st,"$tagsStore",c);let s=W(t,"answer",15),m=W(t,"proceed",15,!1),p=ne(w(s().selection)),h=ne(w(s().text)),l=ne(w(s().tags)),b=ne(w([""]));Ve(()=>{var N;s(s().selection=e(p),!0),s(s().text=e(h),!0),s(s().tags=e(l),!0),t.question.question_type===fe.MultiText&&s(s().text=JSON.stringify(e(b).filter(z=>z.trim().length!==0)),!0),m(s().selection.length>0||(((N=s().text)==null?void 0:N.length)??0)>0||s().tags.length>0)}),ge();var C=Pt(),P=L(C);F(()=>T(P,`${JSON.stringify(e(b))??""} `));var le=u(P);{var k=N=>{var z=Dt(),v=i(z),M=i(v),A=i(M,!0);a(M);var ae=u(M,2),O=i(ae,!0);a(ae),a(v);var re=u(v,2),pe=i(re);{var Me=R=>{var se=It();mt(se),xt(se,()=>e(h),ie=>I(h,ie)),n(R,se)},De=R=>{var se=te(),ie=L(se);{var Pe=$=>{var E=Ct();qe(E,21,()=>e(b),ze,(_e,Ae,X)=>{var j=Ft(),U=i(j);Qe(U),U.__keyup=me=>{const d=me.currentTarget.value??"";e(b)[X]=d,d.trim().length>0&&e(b).find(f=>f.length===0)===void 0&&I(b,w([...e(b),""]))};var Y=u(U,2);Y.__click=()=>{I(b,w(e(b).toSpliced(X,1))),I(b,w([...e(b)]))};var ce=i(Y);V(ce,{src:"/x-close.svg",class:"size-4 bg-red-600"}),a(Y),a(j),F(()=>et(U,e(b)[X])),n(_e,j)}),a(E),n($,E)},Oe=$=>{var E=te(),_e=L(E);{var Ae=j=>{wt(j,{get options(){return r()},get selected(){return e(l)},set selected(U){I(l,w(U))}})},X=j=>{var U=Ut();qe(U,21,()=>t.question.possible_answers.toSorted(),ze,(Y,ce)=>{var me=x(()=>t.question.question_type===fe.MultiSelect);jt(Y,{get label(){return e(ce).value},get value(){return e(ce).id},get multiple(){return e(me)},get group(){return e(p)},set group(d){I(p,w(d))}})}),a(U),n(j,U)};q(_e,j=>{t.question.question_type===fe.Tags?j(Ae):j(X,!1)},!0)}n($,E)};q(ie,$=>{t.question.question_type===fe.MultiText?$(Pe):$(Oe,!1)},!0)}n(R,se)};q(pe,R=>{t.question.question_type===fe.Text?R(Me):R(De,!1)})}a(re),a(z),F(()=>{T(A,t.question.title),T(O,t.question.text)}),n(N,z)},D=N=>{var z=He();F(()=>T(z,m(!0))),n(N,z)};q(le,N=>{s()?N(k):N(D,!1)})}n(o,C),Ce(),_()}Ue(["keyup","click"]);var Bt=g('<div class="flex items-center justify-center p-5"><label for="file-upload" class="text-secondary glass bg-secondary/10 border-secondary/50 flex gap-3 p-2 py-1 items-center justify-center hover:brightness-[99%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/70"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Jt(o,t){let c=W(t,"files",15);var _=Bt(),r=i(_),s=i(r),m=i(s);V(m,{src:"../sticker-circle.svg",class:"size-4 bg-secondary"}),a(s),ge(2),a(r);var p=u(r,2);a(_),yt(p,c),n(o,_)}var Lt=g('<li class="flex items-center gap-3"><!> </li>'),Rt=g('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),$t=g('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Et=g(`<div class="select-none flex flex-col gap-5"><div class="glass p-10"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div></div> <div class="glass p-5"><div><!></div> <div class="glass p-10"><!></div></div></div>`);function Ht(o,t){Fe(t,!0);const[c,_]=We(),r=()=>Ie(Se,"$filesStore",c);let s=W(t,"proceed",15);Ve(()=>{var k;s((((k=r())==null?void 0:k.length)??0)>0)});var m=Et(),p=u(i(m),2),h=i(p),l=i(h);Jt(l,{get files(){return tt(),r()},set files(k){Ke(Se,w(k))}}),a(h);var b=u(h,2),C=i(b);{var P=k=>{var D=Rt();const N=x(()=>Array.from(r()??[]).map(A=>A.name));var z=L(D),v=i(z);a(z);var M=u(z,2);qe(M,21,()=>e(N),ze,(A,ae)=>{var O=Lt(),re=i(O);V(re,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var pe=u(re);a(O),F(()=>T(pe,` ${e(ae)??""}`)),n(A,O)}),a(M),F(()=>{var A;return T(v,`Selected files (${((A=r())==null?void 0:A.length)??0??""}):`)}),n(k,D)},le=k=>{var D=$t();n(k,D)};q(C,k=>{var D;(((D=r())==null?void 0:D.length)??0)>0?k(P):k(le,!1)})}a(b),a(p),a(m),n(o,m),Ce(),_()}function Kt(o,t,c){t(0),c(void 0)}var Vt=g('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-primary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Wt(o,t){let c=W(t,"step",15),_=W(t,"files",15);var r=Vt(),s=i(r),m=u(i(s),6);m.__click=[Kt,c,_];var p=i(m);V(p,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),ge(3),a(m),a(s),a(r),n(o,r)}Ue(["click"]);var Xt=g('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Yt=g("<div><li><div><!> </div></li></div>"),Zt=g('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),Gt=g('<div class="flex flex-col gap-4"><div class="flex gap-5 m-auto text-center whitespace-nowrap"><div class="glass w-min p-5 py-2 rounded-full"> </div> <div class="glass w-min p-5 py-2 rounded-full"><span class="text-secondary"> </span> | <span class="opacity-30"> </span></div></div> <div class="flex-1"><!></div></div>'),Qt=(o,t)=>t(!1),ea=g('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),ta=(o,t)=>t(!0),aa=g('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),ra=g('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),sa=g('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="p-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),ia=g('<p class="text-accent text-center">Contribution is not supported on mobile devices due to poor user experience.</p>');function wa(o,t){Fe(t,!0);const[c,_]=We(),r=()=>Ie(rt,"$questionsStore",c),s=()=>Ie(Se,"$filesStore",c);kt(async()=>{await qt()});let m=ne(0),p=ne(!1),h=x(()=>{var v;return 1+r().length*(((v=s())==null?void 0:v.length)??1)}),l=ne(0),b=x(()=>Array.from(s()??[]).flatMap(v=>{const M=r().map(A=>({question_id:A.id,tags:[],selection:[]}));return{file:v.name,answers:M}})),C=x(()=>e(b)[Math.floor((e(l)-1)/r().length)]),P=x(()=>{var v;return(v=e(C))==null?void 0:v.answers[(e(l)-1)%r().length]});function le(v){s()&&(I(l,w(Math.min(Math.max(e(l)+(v?1:-1),0),1+r().length*s().length))),I(p,!1))}Ve(()=>{if(e(l)===e(h)){const v=s();v&&v.length>0&&zt(v,e(b)),setTimeout(()=>{Ke(Se,void 0),I(l,0)},15e3)}}),w([""]);var k=te(),D=L(k);{var N=v=>{var M=sa(),A=i(M),ae=i(A),O=i(ae),re=i(O),pe=x(()=>`../${(e(l)>=1?"checkmark.svg":"circle.svg")??""}`);V(re,{get src(){return e(pe)},class:"size-3 bg-secondary"}),ge(),a(O);var Me=u(O,2);{var De=d=>{var f=Xt();n(d,f)};q(Me,d=>{var f;(((f=s())==null?void 0:f.length)??0)>0&&d(De)})}var R=u(Me,2);qe(R,1,()=>Array.from(s()??[]),ze,(d,f,H)=>{var Z=Zt();const ve=x(()=>e(l)>=H*r().length+1&&e(l)<(H+1)*r().length+1),y=x(()=>e(l)>=(H+1)*r().length+1),S=x(()=>e(y)?"bg-lime-400":"bg-primary");var G=i(Z),he=i(G),be=i(he,!0);a(he);var xe=u(he,2),Be=x(()=>`../${(e(ve)?"chevron-down.svg":e(y)?"checkmark.svg":"circle.svg")??""}`);V(xe,{get src(){return e(Be)},get class(){return`size-3 ${e(S)??""}`}});var Je=u(xe,2);{var ye=B=>{var J=He();const Q=x(()=>e(f).name.slice(0,3)??""),de=x(()=>e(f).name.slice(-5)??"");F(()=>T(J,`${e(Q)} ... ${e(de)}`)),n(B,J)},K=B=>{var J=He();F(()=>T(J,e(f).name)),n(B,J)};q(Je,B=>{e(f).name.length>10?B(ye):B(K,!1)})}a(G);var we=u(G,2);qe(we,1,r,ze,(B,J,Q)=>{var de=te();const ue=x(()=>e(l)==1+Q+H*r().length),Ne=x(()=>e(l)>1+Q+H*r().length);var je=L(de);{var Le=ee=>{var ke=Yt(),Re=i(ke),$e=i(Re),Ye=i($e),it=x(()=>`../${(e(Ne)?"checkmark.svg":e(ue)?"chevron-right.svg":"circle.svg")??""}`);V(Ye,{get src(){return e(it)},class:"w-3 h-3 bg-secondary"});var ot=u(Ye);a($e),a(Re),a(ke),F(()=>{oe(Re,`pt-2 pl-5 ${(e(Ne)||e(ue)?"":"opacity-30")??""}`),oe($e,`flex gap-3 items-center ${(e(ue)?"text-secondary":"")??""}`),T(ot,` ${e(J).title??""}`)}),Ee(1,ke,()=>Ge),Ee(2,ke,()=>Ge),n(ee,ke)};q(je,ee=>{e(ve)&&ee(Le)})}n(B,de)}),a(Z),F(()=>{oe(Z,`glass group relative px-3 py-1 shadow-sm border ${(e(y)?"border-lime-400 bg-lime-400/10":"")??""}`),oe(G,`flex items-center gap-2 ${(e(y)?"text-lime-500":"")??""} `),T(be,e(f).name)}),n(d,Z)});var ie=u(R,2),Pe=i(ie),Oe=x(()=>`../${(e(l)===e(h)?"checkmark.svg":"circle.svg")??""}`);V(Pe,{get src(){return e(Oe)},class:"z-0 size-3 bg-secondary"}),ge(),a(ie),a(ae),a(A);var $=u(A,2),E=i($);{var _e=d=>{Ht(d,{get proceed(){return e(p)},set proceed(f){I(p,w(f))}})},Ae=d=>{var f=te(),H=L(f);{var Z=y=>{Wt(y,{get step(){return e(l)},set step(S){I(l,w(S))},get files(){return tt(),s()},set files(S){Ke(Se,w(S))}})},ve=y=>{var S=te(),G=L(S);{var he=be=>{var xe=te();const Be=x(()=>r().filter(ye=>{var K;return ye.id===((K=e(P))==null?void 0:K.question_id)})[0]);var Je=L(xe);St(Je,()=>e(l),ye=>{var K=Gt(),we=i(K),Te=i(we),B=i(Te,!0);a(Te);var J=u(Te,2),Q=i(J),de=i(Q,!0);a(Q);var ue=u(Q,2),Ne=i(ue,!0);a(ue),a(J),a(we);var je=u(we,2),Le=i(je);Ot(Le,{get question(){return e(Be)},get answer(){return e(P)},get proceed(){return e(p)},set proceed(ee){I(p,w(ee))}}),a(je),a(K),F(()=>{var ee;T(B,(ee=e(C))==null?void 0:ee.file),T(de,(e(l)-1)%r().length+1),T(Ne,r().length)}),Ee(1,K,()=>_t),n(ye,K)}),n(be,xe)};q(G,be=>{e(P)&&be(he)},!0)}n(y,S)};q(H,y=>{e(l)===e(h)?y(Z):y(ve,!1)},!0)}n(d,f)};q(E,d=>{e(l)===0?d(_e):d(Ae,!1)})}var X=u(E,2),j=i(X);{var U=d=>{var f=ea();f.__click=[Qt,le],n(d,f)};q(j,d=>{e(l)>=1&&e(l)!==e(h)&&d(U)})}var Y=u(j,2);At(Y);var ce=u(Y,2);{var me=d=>{var f=te(),H=L(f);{var Z=y=>{var S=aa();S.__click=[ta,le],n(y,S)},ve=y=>{var S=ra(),G=i(S);V(G,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),ge(),a(S),n(y,S)};q(H,y=>{e(p)?y(Z):y(ve,!1)})}n(d,f)};q(ce,d=>{e(l)<e(h)&&d(me)})}a(X),a($),a(M),F(()=>{oe(O,`glass p-3 flex items-center gap-3 ${(e(l)===0?"bg-secondary/5 shadow-secondary/30 border-secondary text-secondary":"")??""}`),oe(ie,`glass p-3 flex items-center gap-3 ${(e(l)===e(h)?"font-bold":"")??""}`)}),n(v,M)},z=v=>{var M=ia();n(v,M)};q(D,v=>{e(m)>640?v(N):v(z,!1)})}ht("innerWidth",v=>I(m,w(v))),n(o,k),Ce(),_()}Ue(["click"]);export{wa as component};

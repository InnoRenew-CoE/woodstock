import{a as l,t as m,d as Z,e as De}from"../chunks/disclose-version.fXNaj69r.js";import{k as Ke,ab as rt,j as st,aK as it,X as ot,l as nt,al as lt,m as ct,w as vt,a0 as dt,p as ze,c as i,b as u,r,t as I,g as e,a as Ae,d as y,s as se,z as $e,am as R,e as T,n as we}from"../chunks/runtime.C8AwBc5t.js";import{s as z,i as q}from"../chunks/if.DmhFAkFQ.js";import{e as ke,i as Se,t as Ue,s as Ve,a as ut}from"../chunks/index.CL-6Ky9l.js";import{d as Be}from"../chunks/events.YhuPyEO-.js";import{r as ft,s as G,b as gt,M as Q}from"../chunks/MaskedIcon.Uo_VWxHB.js";import{p as A,r as pt}from"../chunks/misc.y5E7LmGA.js";import{b as _t}from"../chunks/window.87UzKs2f.js";import{p as E,s as Le,a as qe,m as We,b as Pe}from"../chunks/props.Dh3Lg4Sc.js";import"../chunks/legacy.rnUX894J.js";import{P as Xe}from"../chunks/public.VJoidTgG.js";import{w as Re}from"../chunks/index.BlsGO1ZL.js";import{p as mt}from"../chunks/notifications.C1upLsv_.js";import{b as bt,c as ht}from"../chunks/input.Y_bnVb-A.js";import{S as xt}from"../chunks/SuggestiveInput.DlZMK5yc.js";import{o as yt}from"../chunks/index-client.Bj5aEFiZ.js";function wt(o,t,c){Ke&&rt();var f=o,a=dt,s,b=st()?it:ot;nt(()=>{b(a,a=t())&&(s&&lt(s),s=ct(()=>c(f)))}),Ke&&(f=vt)}var ye=(o=>(o[o.Text=0]="Text",o[o.Select=1]="Select",o[o.MultiSelect=2]="MultiSelect",o[o.Tags=3]="Tags",o))(ye||{});const ge=Re(),Ye=Re([]),Ze=Re([]);async function kt(){const o=await fetch(`${Xe}/api/questions`),{questions:t,available_tags:c}=await o.json();Ye.set(t.toSorted((f,a)=>f.id-a.id)),Ze.set(c)}async function St(o,t){for(let c of Array.from(o)){const f=t.find(s=>s.file===c.name);if(!f){console.error(`Unable to find answers for file ${c.name}`);continue}const a=new FormData;a.append("answers",JSON.stringify(f.answers)),a.append("file",c,c.name),await fetch(`${Xe}/api/answers`,{method:"POST",body:a})}mt({title:"Success",body:"Submission successful."})}var qt=m('<div class="flex-1"></div>');function zt(o){var t=qt();l(o,t)}var At=(o,t)=>t(o),Mt=m('<label><input class="hidden" type="checkbox"> </label>');function It(o,t){ze(t,!0);let c=E(t,"group",31,()=>A([]));E(t,"class",3,"");let f=E(t,"multiple",3,!0);const a=()=>typeof t.value=="number"?+t.value:t.value;let s=y(()=>c().includes(a()));function b(O){const M=a();e(s)?c(c().filter(U=>U!==M)):c().includes(M)||(f()?c([...c(),M]):c([M]))}var d=Mt(),h=i(d);ft(h),h.__change=[At,b];var n=u(h);r(d),I(()=>{G(d,`transition-all select-none glass px-5 py-2 ${(e(s)?"bg-secondary backdrop-blur-none text-white border-white":"")??""}`),gt(h,t.value),z(n,` ${t.label??""}`)}),l(o,d),Ae()}Be(["change"]);var Nt=m('<textarea placeholder="Answer here..." class="p-5 min-h-[100px] resize-none w-full rounded border border-secondary shadow-xs shadow-secondary"></textarea>'),jt=m('<div class="grid lg:grid-cols-3 gap-3 w-full items-stretch flex-wrap"></div>'),Ft=m('<div><div class="text-lg font-semibold"> </div> <div> </div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Ct(o,t){ze(t,!0);const[c,f]=Le(),a=()=>qe(Ze,"$tagsStore",c);let s=E(t,"answer",15),b=E(t,"proceed",15,!1),d=se(A(s().selection)),h=se(A(s().text)),n=se(A(s().tags));$e(()=>{var p;s(s().selection=e(d),!0),s(s().text=e(h),!0),s(s().tags=e(n),!0),b(e(d).length>0||(((p=e(h))==null?void 0:p.length)??0)>0||e(n).length>0)});var O=Z(),M=R(O);{var U=p=>{var N=Ft(),D=i(N),ie=i(D,!0);r(D);var v=u(D,2),k=i(v,!0);r(v);var j=u(v,2),H=i(j);{var P=J=>{var $=Nt();pt($),bt($,()=>e(h),ne=>T(h,ne)),l(J,$)},oe=J=>{var $=Z(),ne=R($);{var pe=K=>{xt(K,{get options(){return a()},get selected(){return e(n)},set selected(V){T(n,A(V))}})},Ee=K=>{var V=jt();ke(V,21,()=>t.question.possible_answers.toSorted(),Se,(_e,me)=>{var Me=y(()=>t.question.question_type===ye.MultiSelect);It(_e,{get label(){return e(me).value},get value(){return e(me).id},get multiple(){return e(Me)},get group(){return e(d)},set group(be){T(d,A(be))}})}),r(V),l(K,V)};q(ne,K=>{t.question.question_type===ye.Tags?K(pe):K(Ee,!1)},!0)}l(J,$)};q(H,J=>{t.question.question_type===ye.Text?J(P):J(oe,!1)})}r(j),r(N),I(()=>{z(ie,t.question.title),z(k,t.question.text)}),l(p,N)},w=p=>{var N=De();I(()=>z(N,b(!0))),l(p,N)};q(M,p=>{s()?p(U):p(w,!1)})}l(o,O),Ae(),f()}var Tt=m('<div class="flex items-center justify-center p-5"><label for="file-upload" class="flex items-center rounded border border-secondary overflow-hidden group bg-secondary/10 hover:bg-secondary cursor-pointer hover:text-white"><div class="bg-secondary p-2 group-hover:bg-white"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Ut(o,t){let c=E(t,"files",15);var f=Tt(),a=i(f),s=i(a),b=i(s);Q(b,{src:"../sticker-circle.svg",class:"size-4 bg-white group-hover:bg-secondary"}),r(s),we(2),r(a);var d=u(a,2);r(f),ht(d,c),l(o,f)}var Dt=m('<li class="flex items-center gap-3"><!> </li>'),Pt=m('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),$t=m('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Bt=m(`<div class="select-none"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div> <div><div><!></div> <!></div></div>`);function Lt(o,t){ze(t,!0);const[c,f]=Le(),a=()=>qe(ge,"$filesStore",c);let s=E(t,"proceed",15);$e(()=>{var w;s((((w=a())==null?void 0:w.length)??0)>0)});var b=Bt(),d=u(i(b),6),h=i(d),n=i(h);Ut(n,{get files(){return We(),a()},set files(w){Pe(ge,A(w))}}),r(h);var O=u(h,2);{var M=w=>{var p=Pt();const N=y(()=>Array.from(a()??[]).map(k=>k.name));var D=R(p),ie=i(D);r(D);var v=u(D,2);ke(v,21,()=>e(N),Se,(k,j)=>{var H=Dt(),P=i(H);Q(P,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var oe=u(P);r(H),I(()=>z(oe,` ${e(j)??""}`)),l(k,H)}),r(v),I(()=>{var k;return z(ie,`Selected files (${((k=a())==null?void 0:k.length)??0??""}):`)}),l(w,p)},U=w=>{var p=$t();l(w,p)};q(O,w=>{var p;(((p=a())==null?void 0:p.length)??0)>0?w(M):w(U,!1)})}r(d),r(b),l(o,b),Ae(),f()}function Rt(o,t,c){t(0),c(void 0)}var Et=m('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-primary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Ot(o,t){let c=E(t,"step",15),f=E(t,"files",15);var a=Et(),s=i(a),b=u(i(s),6);b.__click=[Rt,c,f];var d=i(b);Q(d,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),we(3),r(b),r(s),r(a),l(o,a)}Be(["click"]);var Ht=m('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Jt=m("<div><li><div><!> </div></li></div>"),Kt=m('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),Vt=m('<div><div class="text-center"><div class="font-bold"> </div> <div><span class="text-accent"> </span> | <span class="opacity-30"> </span></div></div> <!></div>'),Wt=(o,t)=>t(!1),Xt=m('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),Yt=(o,t)=>t(!0),Zt=m('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),Gt=m('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),Qt=m('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="p-5 space-y-3"><li><!> File Selection</li> <!> <!> <li>Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),ea=m('<p class="text-accent text-center">Contribution is not supported on mobile devices due to poor user experience.</p>');function ma(o,t){ze(t,!0);const[c,f]=Le(),a=()=>qe(Ye,"$questionsStore",c),s=()=>qe(ge,"$filesStore",c);yt(async()=>{await kt()});let b=se(0),d=se(!1),h=y(()=>{var v;return 1+a().length*(((v=s())==null?void 0:v.length)??1)}),n=se(0),O=y(()=>Array.from(s()??[]).flatMap(v=>{const k=a().map(j=>({question_id:j.id,tags:[],selection:[]}));return{file:v.name,answers:k}})),M=y(()=>e(O)[Math.floor((e(n)-1)/a().length)]),U=y(()=>{var v;return(v=e(M))==null?void 0:v.answers[(e(n)-1)%a().length]});function w(v){s()&&(T(n,A(Math.min(Math.max(e(n)+(v?1:-1),0),1+a().length*s().length))),T(d,!1))}$e(()=>{if(e(n)===e(h)){const v=s();v&&v.length>0&&St(v,e(O)),setTimeout(()=>{Pe(ge,void 0),T(n,0)},15e3)}});var p=Z(),N=R(p);{var D=v=>{var k=Qt(),j=i(k),H=i(j),P=i(H),oe=i(P),J=y(()=>`../${(e(n)>=1?"checkmark.svg":"circle.svg")??""}`);Q(oe,{get src(){return e(J)},class:"size-3 bg-primary"}),we(),r(P);var $=u(P,2);{var ne=_=>{var g=Ht();l(_,g)};q($,_=>{var g;(((g=s())==null?void 0:g.length)??0)>0&&_(ne)})}var pe=u($,2);ke(pe,1,()=>Array.from(s()??[]),Se,(_,g,B)=>{var W=Kt();const ee=y(()=>e(n)>=B*a().length+1&&e(n)<(B+1)*a().length+1),x=y(()=>e(n)>=(B+1)*a().length+1),S=y(()=>e(x)?"bg-lime-400":"bg-primary");var X=i(W),le=i(X),ce=i(le,!0);r(le);var ve=u(le,2),Ie=y(()=>`../${(e(ee)?"chevron-down.svg":e(x)?"checkmark.svg":"circle.svg")??""}`);Q(ve,{get src(){return e(Ie)},get class(){return`size-3 ${e(S)??""}`}});var Ne=u(ve,2);{var de=F=>{var C=De();const Y=y(()=>e(g).name.slice(0,3)??""),te=y(()=>e(g).name.slice(-5)??"");I(()=>z(C,`${e(Y)} ... ${e(te)}`)),l(F,C)},L=F=>{var C=De();I(()=>z(C,e(g).name)),l(F,C)};q(Ne,F=>{e(g).name.length>10?F(de):F(L,!1)})}r(X);var ue=u(X,2);ke(ue,1,a,Se,(F,C,Y)=>{var te=Z();const ae=y(()=>e(n)==1+Y+B*a().length),xe=y(()=>e(n)>1+Y+B*a().length);var je=R(te);{var re=Fe=>{var fe=Jt(),Ce=i(fe),Te=i(Ce),Je=i(Te),tt=y(()=>`../${(e(xe)?"checkmark.svg":e(ae)?"chevron-right.svg":"circle.svg")??""}`);Q(Je,{get src(){return e(tt)},class:"w-3 h-3 bg-secondary"});var at=u(Je);r(Te),r(Ce),r(fe),I(()=>{G(Ce,`pt-2 pl-5 ${(e(xe)||e(ae)?"":"opacity-30")??""}`),G(Te,`flex gap-3 items-center ${(e(ae)?"text-secondary":"")??""}`),z(at,` ${e(C).title??""}`)}),Ue(1,fe,()=>Ve),Ue(2,fe,()=>Ve),l(Fe,fe)};q(je,Fe=>{e(ee)&&Fe(re)})}l(F,te)}),r(W),I(()=>{G(W,`glass group relative px-3 py-1 shadow-sm border ${(e(x)?"border-lime-400 bg-lime-400/10":"")??""}`),G(X,`flex items-center gap-2 ${(e(x)?"text-lime-500":"")??""} `),z(ce,e(g).name)}),l(_,W)});var K=u(pe,2);r(H),r(j);var V=u(j,2),_e=i(V);{var me=_=>{Lt(_,{get proceed(){return e(d)},set proceed(g){T(d,A(g))}})},Me=_=>{var g=Z(),B=R(g);{var W=x=>{Ot(x,{get step(){return e(n)},set step(S){T(n,A(S))},get files(){return We(),s()},set files(S){Pe(ge,A(S))}})},ee=x=>{var S=Z(),X=R(S);{var le=ce=>{var ve=Z();const Ie=y(()=>a().filter(de=>{var L;return de.id===((L=e(U))==null?void 0:L.question_id)})[0]);var Ne=R(ve);wt(Ne,()=>e(n),de=>{var L=Vt(),ue=i(L),he=i(ue),F=i(he,!0);r(he);var C=u(he,2),Y=i(C),te=i(Y,!0);r(Y);var ae=u(Y,2),xe=i(ae,!0);r(ae),r(C),r(ue);var je=u(ue,2);Ct(je,{get question(){return e(Ie)},get answer(){return e(U)},get proceed(){return e(d)},set proceed(re){T(d,A(re))}}),r(L),I(()=>{var re;z(F,(re=e(M))==null?void 0:re.file),z(te,(e(n)-1)%a().length+1),z(xe,a().length)}),Ue(1,L,()=>ut),l(de,L)}),l(ce,ve)};q(X,ce=>{e(U)&&ce(le)},!0)}l(x,S)};q(B,x=>{e(n)===e(h)?x(W):x(ee,!1)},!0)}l(_,g)};q(_e,_=>{e(n)===0?_(me):_(Me,!1)})}var be=u(_e,2),Oe=i(be);{var Ge=_=>{var g=Xt();g.__click=[Wt,w],l(_,g)};q(Oe,_=>{e(n)>=1&&e(n)!==e(h)&&_(Ge)})}var He=u(Oe,2);zt(He);var Qe=u(He,2);{var et=_=>{var g=Z(),B=R(g);{var W=x=>{var S=Zt();S.__click=[Yt,w],l(x,S)},ee=x=>{var S=Gt(),X=i(S);Q(X,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),we(),r(S),l(x,S)};q(B,x=>{e(d)?x(W):x(ee,!1)})}l(_,g)};q(Qe,_=>{e(n)<e(h)&&_(et)})}r(be),r(V),r(k),I(()=>{G(P,`flex items-center gap-3 ${(e(n)===0?"font-semibold":"")??""}`),G(K,`flex items-center gap-3 ${(e(n)===e(h)?"font-bold":"")??""}`)}),l(v,k)},ie=v=>{var k=ea();l(v,k)};q(N,v=>{e(b)>640?v(D):v(ie,!1)})}_t("innerWidth",v=>T(b,A(v))),l(o,p),Ae(),f()}Be(["click"]);export{ma as component};

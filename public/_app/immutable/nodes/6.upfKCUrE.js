import{a as n,t as m,c as V,e as Ke}from"../chunks/disclose-version.B8FhMCHa.js";import{l as Ze,o as vt,Y as ct,aK as dt,ah as ut,k as ft,A as gt,z as pt,x as _t,ao as mt,p as Me,c as s,s as d,r as t,t as P,g as e,a as Ae,d as w,b as le,a1 as We,ap as R,e as D,n as je}from"../chunks/runtime.Twxei6D9.js";import{s as N,i as F}from"../chunks/if.D8Ga6OrE.js";import{e as pe,i as _e}from"../chunks/each.D4Yknd68.js";import{d as De,p as q,r as xt}from"../chunks/events.cLB7s__O.js";import{r as Qe,a as oe,b as et,M as ae,s as ht}from"../chunks/MaskedIcon.Bv3Qvdar.js";import{t as Ue,a as tt,s as Ge}from"../chunks/index.DWwqrxLx.js";import{b as bt}from"../chunks/window.DDrw6ikS.js";import{p as W,s as Le,a as ze,m as at,b as st}from"../chunks/props.DW8d2wJc.js";import"../chunks/legacy.CuZUSs6W.js";import{P as rt}from"../chunks/public.CD978DOo.js";import{w as Be}from"../chunks/index.tARBV8wy.js";import{b as yt,c as wt}from"../chunks/input.zAG3t_j5.js";import{S as kt}from"../chunks/SuggestiveInput.Bm1zWyn5.js";import{o as St}from"../chunks/index-client.W6R2iQDr.js";function qt(l,a,v){Ze&&vt();var b=l,i=mt,r,x=ct()?dt:ut;ft(()=>{x(i,i=a())&&(r&&gt(r),r=pt(()=>v(b)))}),Ze&&(b=_t)}var ge=(l=>(l[l.Text=0]="Text",l[l.Select=1]="Select",l[l.MultiSelect=2]="MultiSelect",l[l.Tags=3]="Tags",l[l.MultiText=4]="MultiText",l))(ge||{});const Ve=Be([]),Ce=Be(),it=Be([]),ot=Be([]);async function zt(){const l=await fetch(`${rt}/api/questions`),{questions:a,available_tags:v}=await l.json();it.set(a.toSorted((b,i)=>b.id-i.id)),ot.set(v)}async function Mt(l,a){Ve.set(Array.from(l).map(v=>({file:v.name,progress:0})));for(let v of Array.from(l)){const b=a.find(x=>x.file===v.name);if(!b){console.error(`Unable to find answers for file ${v.name}`);continue}const i=new FormData;i.append("answers",JSON.stringify(b.answers)),i.append("file",v,v.name);const r=new XMLHttpRequest;r.open("POST",`${rt}/api/answers`),r.upload.onprogress=x=>{if(x.lengthComputable){const u=x.loaded/x.total*100,p=u.toFixed(2);console.log(`Uploaded: ${p}%`),Ve.update(o=>{const _=o.find(z=>z.file===v.name);return _&&(_.progress=u),o})}},r.send(i)}}var At=m('<div class="flex-1"></div>');function Ft(l){var a=At();n(l,a)}var Tt=(l,a)=>a(l),It=m('<label><input class="hidden" type="checkbox"> </label>');function Nt(l,a){Me(a,!0);let v=W(a,"group",31,()=>q([]));W(a,"class",3,"");let b=W(a,"multiple",3,!0);const i=()=>typeof a.value=="number"?+a.value:a.value;let r=w(()=>v().includes(i()));function x(_){const z=i();e(r)?v(v().filter(L=>L!==z)):v().includes(z)||(b()?v([...v(),z]):v([z]))}var u=It(),p=s(u);Qe(p),p.__change=[Tt,x];var o=d(p);t(u),P(()=>{oe(u,`transition-all select-none glass px-5 py-3 ${(e(r)?"bg-secondary/10 text-secondary border-secondary hover:bg-red-100 hover:text-red-400 hover:border-red-400 ":"hover:bg-secondary/10 hover:border-secondary hover:text-accent")??""}`),et(p,a.value),N(o,` ${a.label??""}`)}),n(l,u),Ae()}De(["change"]);var Pt=m('<textarea placeholder="Answer here..." class="glass p-5 min-h-[100px] resize-none w-full"></textarea>'),$t=m('<div class="flex items-center gap-3"><input placeholder="Type here..." class="glass p-5 py-2 resize-none w-full"> <div class="glass p-2 hover:bg-red-50 cursor-pointer"><!></div></div>'),jt=m('<div class="grid w-full gap-3 py-5"></div>'),Ut=m('<div class="grid sm:flex gap-3 w-full items-stretch flex-wrap"></div>'),Ct=m('<div><div class="glass p-8"><div class="text-lg font-semibold"> </div> <div> </div></div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Dt(l,a){Me(a,!0);const[v,b]=Le(),i=()=>ze(ot,"$tagsStore",v);let r=W(a,"answer",15),x=W(a,"proceed",15,!1),u=le(q(r().selection)),p=le(q(r().text)),o=le(q(r().tags)),_=le(q([""]));We(()=>{var g;if(r(r().selection=e(u),!0),r(r().text=e(p),!0),r(r().tags=e(o),!0),a.question.question_type===ge.MultiText){const M=e(_).filter(T=>T.trim().length!==0);M.length>0&&r(r().text=JSON.stringify(M),!0)}x(r().selection.length>0||(((g=r().text)==null?void 0:g.length)??0)>0||r().tags.length>0)});var z=V(),L=R(z);{var C=g=>{var M=Ct(),T=s(M),c=s(T),A=s(c,!0);t(c);var S=d(c,2),Y=s(S,!0);t(S),t(T);var $=d(T,2),ne=s($);{var me=X=>{var E=Pt();xt(E),yt(E,()=>e(p),Te=>D(p,Te)),n(X,E)},Fe=X=>{var E=V(),Te=R(E);{var xe=Z=>{var H=jt();pe(H,21,()=>e(_),_e,(ve,Ie,se)=>{var j=$t(),U=s(j);Qe(U),U.__keyup=he=>{const ce=he.currentTarget.value??"";e(_)[se]=ce,ce.trim().length>0&&e(_).find(h=>h.length===0)===void 0&&D(_,q([...e(_),""]))};var re=d(U,2);re.__click=()=>{D(_,q(e(_).toSpliced(se,1))),D(_,q([...e(_)]))};var ie=s(re);ae(ie,{src:"/x-close.svg",class:"size-4 bg-red-600"}),t(re),t(j),P(()=>et(U,e(_)[se])),n(ve,j)}),t(H),n(Z,H)},Oe=Z=>{var H=V(),ve=R(H);{var Ie=j=>{kt(j,{get options(){return i()},get selected(){return e(o)},set selected(U){D(o,q(U))}})},se=j=>{var U=Ut();pe(U,21,()=>a.question.possible_answers.toSorted(),_e,(re,ie)=>{var he=w(()=>a.question.question_type===ge.MultiSelect);Nt(re,{get label(){return e(ie).value},get value(){return e(ie).id},get multiple(){return e(he)},get group(){return e(u)},set group(ce){D(u,q(ce))}})}),t(U),n(j,U)};F(ve,j=>{a.question.question_type===ge.Tags?j(Ie):j(se,!1)},!0)}n(Z,H)};F(Te,Z=>{a.question.question_type===ge.MultiText?Z(xe):Z(Oe,!1)},!0)}n(X,E)};F(ne,X=>{a.question.question_type===ge.Text?X(me):X(Fe,!1)})}t($),t(M),P(()=>{N(A,a.question.title),N(Y,a.question.text)}),n(g,M)},f=g=>{var M=Ke();P(()=>N(M,x(!0))),n(g,M)};F(L,g=>{r()?g(C):g(f,!1)})}n(l,z),Ae(),b()}De(["keyup","click"]);var Lt=m('<div class="flex items-center justify-center p-5"><label for="file-upload" class="text-secondary glass bg-secondary/10 border-secondary/50 flex gap-3 p-2 py-1 items-center justify-center hover:brightness-[99%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/70"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Bt(l,a){let v=W(a,"files",15);var b=Lt(),i=s(b),r=s(i),x=s(r);ae(x,{src:"../sticker-circle.svg",class:"size-4 bg-secondary"}),t(r),je(2),t(i);var u=d(i,2);t(b),wt(u,v),n(l,b)}var Ot=m('<li class="flex items-center gap-3"><!> </li>'),Rt=m('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Yt=m('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Et=m(`<div class="select-none flex flex-col gap-5"><div class="glass p-10"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div></div> <div class="glass p-5"><div><!></div> <div class="glass p-10"><!></div></div></div>`);function Ht(l,a){Me(a,!0);const[v,b]=Le(),i=()=>ze(Ce,"$filesStore",v);let r=W(a,"proceed",15);We(()=>{var f;r((((f=i())==null?void 0:f.length)??0)>0)});var x=Et(),u=d(s(x),2),p=s(u),o=s(p);Bt(o,{get files(){return at(),i()},set files(f){st(Ce,q(f))}}),t(p);var _=d(p,2),z=s(_);{var L=f=>{var g=Rt();const M=w(()=>Array.from(i()??[]).map(S=>S.name));var T=R(g),c=s(T);t(T);var A=d(T,2);pe(A,21,()=>e(M),_e,(S,Y)=>{var $=Ot(),ne=s($);ae(ne,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var me=d(ne);t($),P(()=>N(me,` ${e(Y)??""}`)),n(S,$)}),t(A),P(()=>{var S;return N(c,`Selected files (${((S=i())==null?void 0:S.length)??0??""}):`)}),n(f,g)},C=f=>{var g=Yt();n(f,g)};F(z,f=>{var g;(((g=i())==null?void 0:g.length)??0)>0?f(L):f(C,!1)})}t(_),t(u),t(x),n(l,x),Ae(),b()}function Jt(l,a,v){a(0),v(void 0)}var Kt=m('<li><div class="flex gap-3"><div class="truncate w-[200px]"> </div> <div class="w-full bg-gray-50 border border-primary/10 glass overflow-hidden rounded-sm"><div class="bg-secondary/80 w-[0%] h-full transition-all glass rounded-sm"></div></div> <div class="w-[20%] text-right font-light"> </div></div></li>'),Vt=m('<div><div class="w-full border-b border-accent/10 mb-5"></div> <span class="font-nunito">You can safely close the tab or continue to upload more files.</span> <button class="px-3 py-2 rounded my-3 flex items-center gap-2 justify-center bg-secondary text-white">Upload more</button></div>'),Wt=m('<div class="flex justify-center p-5"><div class="w-full"><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div class="font-light">Thank you for answering our questions. Your files and answers are being uploaded and safely stored.</div> <div class="font-light text-red-400">Note: Indexing and processing happen in the background and may take some time before results are available.</div> <div class="glass p-5 my-5"><span class="font-mono text-xs uppercase">Progress</span> <ul class="space-y-2"></ul></div> <!></div></div>');function Xt(l,a){Me(a,!0);const[v,b]=Le(),i=()=>ze(Ve,"$uploadProgressStore",v);let r=W(a,"step",15),x=W(a,"files",15);var u=Wt(),p=s(u),o=d(s(p),8),_=d(s(o),2);pe(_,5,i,_e,(C,f)=>{var g=Kt(),M=s(g),T=s(M),c=s(T,!0);t(T);var A=d(T,2),S=s(A);t(A);var Y=d(A,2),$=s(Y);P(()=>N($,`${e(f).progress.toFixed(2)??""}%`)),t(Y),t(M),t(g),P(()=>{N(c,e(f).file),ht(S,"style",`width: ${e(f).progress??""}%`)}),n(C,g)}),t(_),t(o);var z=d(o,2);{var L=C=>{var f=Vt(),g=d(s(f),4);g.__click=[Jt,r,x],t(f),Ue(1,f,()=>tt),n(C,f)};F(z,C=>{i().every(f=>f.progress>=100)&&C(L)})}t(p),t(u),n(l,u),Ae(),b()}De(["click"]);var Zt=m('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Gt=m("<div><li><div><!> </div></li></div>"),Qt=m('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),ea=m('<div class="flex flex-col gap-4"><div class="flex gap-5 m-auto text-center whitespace-nowrap"><div class="glass w-min p-5 py-2 rounded-full"> </div> <div class="glass w-min p-5 py-2 rounded-full"><span class="text-secondary"> </span> | <span class="opacity-30"> </span></div></div> <div class="flex-1"><!></div></div>'),ta=(l,a)=>a(!1),aa=m('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),sa=(l,a)=>a(!0),ra=m('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),ia=m('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),oa=m('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="px-2 py-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),la=m('<div class="flex items-center justify-center h-full"><div class="glass text-primary p-10 shadow-lg w-[90%] max-w-[500px]">Contribution is not supported on mobile devices due to poor user experience.</div></div>');function ka(l,a){Me(a,!0);const[v,b]=Le(),i=()=>ze(it,"$questionsStore",v),r=()=>ze(Ce,"$filesStore",v);St(async()=>{await zt()});let x=le(0),u=le(!1),p=w(()=>{var c;return 1+i().length*(((c=r())==null?void 0:c.length)??1)}),o=le(0),_=w(()=>Array.from(r()??[]).flatMap(c=>{const A=i().map(S=>({question_id:S.id,tags:[],selection:[]}));return{file:c.name,answers:A}})),z=w(()=>e(_)[Math.floor((e(o)-1)/i().length)]),L=w(()=>{var c;return(c=e(z))==null?void 0:c.answers[(e(o)-1)%i().length]});function C(c){r()&&(D(o,q(Math.min(Math.max(e(o)+(c?1:-1),0),1+i().length*r().length))),D(u,!1))}We(()=>{if(e(o)===e(p)){const c=r();c&&c.length>0&&Mt(c,e(_))}});var f=V(),g=R(f);{var M=c=>{var A=oa(),S=s(A),Y=s(S),$=s(Y),ne=s($),me=w(()=>`../${(e(o)>=1?"checkmark.svg":"circle.svg")??""}`);ae(ne,{get src(){return e(me)},class:"size-3 bg-secondary"}),je(),t($);var Fe=d($,2);{var X=h=>{var y=Zt();n(h,y)};F(Fe,h=>{var y;(((y=r())==null?void 0:y.length)??0)>0&&h(X)})}var E=d(Fe,2);pe(E,1,()=>Array.from(r()??[]),_e,(h,y,J)=>{var G=Qt();const de=w(()=>e(o)>=J*i().length+1&&e(o)<(J+1)*i().length+1),k=w(()=>e(o)>=(J+1)*i().length+1),I=w(()=>e(k)?"bg-lime-400":"bg-primary");var Q=s(G),be=s(Q),ye=s(be,!0);t(be);var we=d(be,2),Re=w(()=>`../${(e(de)?"chevron-down.svg":e(k)?"checkmark.svg":"circle.svg")??""}`);ae(we,{get src(){return e(Re)},get class(){return`size-3 ${e(I)??""}`}});var Ye=d(we,2);{var ke=B=>{var O=Ke();const ee=w(()=>e(y).name.slice(0,3)??""),ue=w(()=>e(y).name.slice(-5)??"");P(()=>N(O,`${e(ee)} ... ${e(ue)}`)),n(B,O)},K=B=>{var O=Ke();P(()=>N(O,e(y).name)),n(B,O)};F(Ye,B=>{e(y).name.length>10?B(ke):B(K,!1)})}t(Q);var Se=d(Q,2);pe(Se,1,i,_e,(B,O,ee)=>{var ue=V();const fe=w(()=>e(o)==1+ee+J*i().length),Pe=w(()=>e(o)>1+ee+J*i().length);var $e=R(ue);{var Ee=te=>{var qe=Gt(),He=s(qe),Je=s(He),Xe=s(Je),lt=w(()=>`../${(e(Pe)?"checkmark.svg":e(fe)?"chevron-right.svg":"circle.svg")??""}`);ae(Xe,{get src(){return e(lt)},class:"w-3 h-3 bg-secondary"});var nt=d(Xe);t(Je),t(He),t(qe),P(()=>{oe(He,`pt-2 pl-5 ${(e(Pe)||e(fe)?"":"opacity-30")??""}`),oe(Je,`flex gap-3 items-center ${(e(fe)?"text-secondary":"")??""}`),N(nt,` ${e(O).title??""}`)}),Ue(1,qe,()=>Ge),Ue(2,qe,()=>Ge),n(te,qe)};F($e,te=>{e(de)&&te(Ee)})}n(B,ue)}),t(G),P(()=>{oe(G,`glass group relative px-3 py-1 shadow-sm border ${(e(k)?"border-lime-400 bg-lime-400/10":"")??""}`),oe(Q,`flex items-center gap-2 ${(e(k)?"text-lime-500":"")??""} `),N(ye,e(y).name)}),n(h,G)});var xe=d(E,2),Oe=s(xe),Z=w(()=>`../${(e(o)===e(p)?"checkmark.svg":"circle.svg")??""}`);ae(Oe,{get src(){return e(Z)},class:"z-0 size-3 bg-secondary"}),je(),t(xe),t(Y),t(S);var H=d(S,2),ve=s(H);{var Ie=h=>{Ht(h,{get proceed(){return e(u)},set proceed(y){D(u,q(y))}})},se=h=>{var y=V(),J=R(y);{var G=k=>{Xt(k,{get step(){return e(o)},set step(I){D(o,q(I))},get files(){return at(),r()},set files(I){st(Ce,q(I))}})},de=k=>{var I=V(),Q=R(I);{var be=ye=>{var we=V();const Re=w(()=>i().filter(ke=>{var K;return ke.id===((K=e(L))==null?void 0:K.question_id)})[0]);var Ye=R(we);qt(Ye,()=>e(o),ke=>{var K=ea(),Se=s(K),Ne=s(Se),B=s(Ne,!0);t(Ne);var O=d(Ne,2),ee=s(O),ue=s(ee,!0);t(ee);var fe=d(ee,2),Pe=s(fe,!0);t(fe),t(O),t(Se);var $e=d(Se,2),Ee=s($e);Dt(Ee,{get question(){return e(Re)},get answer(){return e(L)},get proceed(){return e(u)},set proceed(te){D(u,q(te))}}),t($e),t(K),P(()=>{var te;N(B,(te=e(z))==null?void 0:te.file),N(ue,(e(o)-1)%i().length+1),N(Pe,i().length)}),Ue(1,K,()=>tt),n(ke,K)}),n(ye,we)};F(Q,ye=>{e(L)&&ye(be)},!0)}n(k,I)};F(J,k=>{e(o)===e(p)?k(G):k(de,!1)},!0)}n(h,y)};F(ve,h=>{e(o)===0?h(Ie):h(se,!1)})}var j=d(ve,2),U=s(j);{var re=h=>{var y=aa();y.__click=[ta,C],n(h,y)};F(U,h=>{e(o)>=1&&e(o)!==e(p)&&h(re)})}var ie=d(U,2);Ft(ie);var he=d(ie,2);{var ce=h=>{var y=V(),J=R(y);{var G=k=>{var I=ra();I.__click=[sa,C],n(k,I)},de=k=>{var I=ia(),Q=s(I);ae(Q,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),je(),t(I),n(k,I)};F(J,k=>{e(u)?k(G):k(de,!1)})}n(h,y)};F(he,h=>{e(o)<e(p)&&h(ce)})}t(j),t(H),t(A),P(()=>{oe($,`glass px-3 py-2 flex items-center gap-3 ${(e(o)===0?"bg-secondary/5 shadow-secondary/30 border-secondary text-secondary":"")??""}`),oe(xe,`glass px-3 py-2 flex items-center gap-3 ${(e(o)===e(p)?"font-bold":"")??""}`)}),n(c,A)},T=c=>{var A=la();n(c,A)};F(g,c=>{e(x)>1e3?c(M):c(T,!1)})}bt("innerWidth",c=>D(x,q(c))),n(l,f),Ae(),b()}De(["click"]);export{ka as component};

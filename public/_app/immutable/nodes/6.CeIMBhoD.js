import{a as n,t as _,c as K,e as Ke}from"../chunks/disclose-version.B30PygmH.js";import{k as Ge,l as nt,_ as ct,aK as vt,ao as dt,j as ut,y as ft,x as gt,z as pt,U as _t,p as Ae,c as s,s as d,r as a,t as C,g as e,a as Te,d as b,b as te,a2 as Ve,ap as O,e as F,n as Se}from"../chunks/runtime.CRowtBbc.js";import{s as I}from"../chunks/render.BHNpU5Bx.js";import{i as M}from"../chunks/if.C2cCH_Za.js";import{e as qe,i as ze}from"../chunks/each.Csjyd5Lk.js";import{d as Pe,p as k,r as mt}from"../chunks/events.BqHwmKXL.js";import{r as Qe,a as ie,b as et,M as V}from"../chunks/MaskedIcon.8PnPh0_h.js";import{t as He,s as Xe,a as ht}from"../chunks/index.DCPZGT8F.js";import{b as xt}from"../chunks/window.nNcBm8Oy.js";import{p as W,s as Be,a as De,m as tt,b as We}from"../chunks/props.C08js9P0.js";import"../chunks/legacy.GzLnPQkk.js";import{P as at}from"../chunks/public.CD978DOo.js";import{w as Ye}from"../chunks/index.RIEEZAD_.js";import{p as bt}from"../chunks/notifications.D2JqBFx3.js";import{b as yt,c as wt}from"../chunks/input.iYUWG3yA.js";import{S as kt}from"../chunks/SuggestiveInput.49BUEexw.js";import{o as rt}from"../chunks/index-client.CjYSU9sf.js";function St(o,t,v){Ge&&nt();var m=o,r=_t,i,y=ct()?vt:dt;ut(()=>{y(r,r=t())&&(i&&ft(i),i=gt(()=>v(m)))}),Ge&&(m=pt)}var ge=(o=>(o[o.Text=0]="Text",o[o.Select=1]="Select",o[o.MultiSelect=2]="MultiSelect",o[o.Tags=3]="Tags",o[o.MultiText=4]="MultiText",o))(ge||{});const Me=Ye(),st=Ye([]),it=Ye([]);async function qt(){const o=await fetch(`${at}/api/questions`),{questions:t,available_tags:v}=await o.json();st.set(t.toSorted((m,r)=>m.id-r.id)),it.set(v)}async function zt(o,t){for(let v of Array.from(o)){const m=t.find(i=>i.file===v.name);if(!m){console.error(`Unable to find answers for file ${v.name}`);continue}const r=new FormData;r.append("answers",JSON.stringify(m.answers)),r.append("file",v,v.name),await fetch(`${at}/api/answers`,{method:"POST",body:r})}bt({title:"Success",body:"Submission successful."})}var Mt=_('<div class="flex-1"></div>');function At(o){var t=Mt();n(o,t)}var Tt=(o,t)=>t(o),jt=_('<label><input class="hidden" type="checkbox"> </label>');function Nt(o,t){Ae(t,!0);let v=W(t,"group",31,()=>k([]));W(t,"class",3,"");let m=W(t,"multiple",3,!0);const r=()=>typeof t.value=="number"?+t.value:t.value;let i=b(()=>v().includes(r()));function y(g){const A=r();e(i)?v(v().filter(R=>R!==A)):v().includes(A)||(m()?v([...v(),A]):v([A]))}var u=jt(),f=s(u);Qe(f),f.__change=[Tt,y];var l=d(f);a(u),C(()=>{ie(u,`transition-all select-none glass px-5 py-3 ${(e(i)?"bg-secondary/10 text-secondary border-secondary hover:bg-red-100 hover:text-red-400 hover:border-red-400 ":"hover:bg-secondary/10 hover:border-secondary hover:text-accent")??""}`),et(f,t.value),I(l,` ${t.label??""}`)}),n(o,u),Te()}Pe(["change"]);var It=_('<textarea placeholder="Answer here..." class="glass p-5 min-h-[100px] resize-none w-full"></textarea>'),Ft=_('<div class="flex items-center gap-3"><input placeholder="Type here..." class="glass p-5 py-2 resize-none w-full"> <div class="glass p-2 hover:bg-red-50 cursor-pointer"><!></div></div>'),Ut=_('<div class="grid w-full gap-3 py-5"></div>'),Ct=_('<div class="grid sm:flex gap-3 w-full items-stretch flex-wrap"></div>'),Dt=_('<div><div class="glass p-8"><div class="text-lg font-semibold"> </div> <div> </div></div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Pt(o,t){Ae(t,!0);const[v,m]=Be(),r=()=>De(it,"$tagsStore",v);let i=W(t,"answer",15),y=W(t,"proceed",15,!1),u=te(k(i().selection)),f=te(k(i().text)),l=te(k(i().tags)),g=te(k([""]));Ve(()=>{var x;if(i(i().selection=e(u),!0),i(i().text=e(f),!0),i(i().tags=e(l),!0),t.question.question_type===ge.MultiText){const T=e(g).filter(D=>D.trim().length!==0);T.length>0&&i(i().text=JSON.stringify(T),!0)}y(i().selection.length>0||(((x=i().text)==null?void 0:x.length)??0)>0||i().tags.length>0)});var A=K(),R=O(A);{var oe=x=>{var T=Dt(),D=s(T),c=s(D),U=s(c,!0);a(c);var q=d(c,2),le=s(q,!0);a(q),a(D);var P=d(D,2),ne=s(P);{var pe=Y=>{var E=It();mt(E),yt(E,()=>e(f),Ne=>F(f,Ne)),n(Y,E)},je=Y=>{var E=K(),Ne=O(E);{var _e=Z=>{var J=Ut();qe(J,21,()=>e(g),ze,(ce,Ie,ae)=>{var j=Ft(),N=s(j);Qe(N),N.__keyup=me=>{const ve=me.currentTarget.value??"";e(g)[ae]=ve,ve.trim().length>0&&e(g).find(p=>p.length===0)===void 0&&F(g,k([...e(g),""]))};var re=d(N,2);re.__click=()=>{F(g,k(e(g).toSpliced(ae,1))),F(g,k([...e(g)]))};var se=s(re);V(se,{src:"/x-close.svg",class:"size-4 bg-red-600"}),a(re),a(j),C(()=>et(N,e(g)[ae])),n(ce,j)}),a(J),n(Z,J)},Le=Z=>{var J=K(),ce=O(J);{var Ie=j=>{kt(j,{get options(){return r()},get selected(){return e(l)},set selected(N){F(l,k(N))}})},ae=j=>{var N=Ct();qe(N,21,()=>t.question.possible_answers.toSorted(),ze,(re,se)=>{var me=b(()=>t.question.question_type===ge.MultiSelect);Nt(re,{get label(){return e(se).value},get value(){return e(se).id},get multiple(){return e(me)},get group(){return e(u)},set group(ve){F(u,k(ve))}})}),a(N),n(j,N)};M(ce,j=>{t.question.question_type===ge.Tags?j(Ie):j(ae,!1)},!0)}n(Z,J)};M(Ne,Z=>{t.question.question_type===ge.MultiText?Z(_e):Z(Le,!1)},!0)}n(Y,E)};M(ne,Y=>{t.question.question_type===ge.Text?Y(pe):Y(je,!1)})}a(P),a(T),C(()=>{I(U,t.question.title),I(le,t.question.text)}),n(x,T)},S=x=>{var T=Ke();C(()=>I(T,y(!0))),n(x,T)};M(R,x=>{i()?x(oe):x(S,!1)})}n(o,A),Te(),m()}Pe(["keyup","click"]);var Bt=_('<div class="flex items-center justify-center p-5"><label for="file-upload" class="text-secondary glass bg-secondary/10 border-secondary/50 flex gap-3 p-2 py-1 items-center justify-center hover:brightness-[99%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/70"><!></div> <div class="text-center px-5">Select files</div></label> <input id="file-upload" class="hidden" type="file" multiple></div>');function Lt(o,t){let v=W(t,"files",15);var m=Bt(),r=s(m),i=s(r),y=s(i);V(y,{src:"../sticker-circle.svg",class:"size-4 bg-secondary"}),a(i),Se(2),a(r);var u=d(r,2);a(m),wt(u,v),n(o,m)}var Ot=_('<li class="flex items-center gap-3"><!> </li>'),Rt=_('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Et=_('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Jt=_(`<div class="select-none flex flex-col gap-5"><div class="glass p-10"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div></div> <div class="glass p-5"><div><!></div> <div class="glass p-10"><!></div></div></div>`);function $t(o,t){Ae(t,!0);const[v,m]=Be(),r=()=>De(Me,"$filesStore",v);let i=W(t,"proceed",15);Ve(()=>{var S;i((((S=r())==null?void 0:S.length)??0)>0)});var y=Jt(),u=d(s(y),2),f=s(u),l=s(f);Lt(l,{get files(){return tt(),r()},set files(S){We(Me,k(S))}}),a(f);var g=d(f,2),A=s(g);{var R=S=>{var x=Rt();const T=b(()=>Array.from(r()??[]).map(q=>q.name));var D=O(x),c=s(D);a(D);var U=d(D,2);qe(U,21,()=>e(T),ze,(q,le)=>{var P=Ot(),ne=s(P);V(ne,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var pe=d(ne);a(P),C(()=>I(pe,` ${e(le)??""}`)),n(q,P)}),a(U),C(()=>{var q;return I(c,`Selected files (${((q=r())==null?void 0:q.length)??0??""}):`)}),n(S,x)},oe=S=>{var x=Et();n(S,x)};M(A,S=>{var x;(((x=r())==null?void 0:x.length)??0)>0?S(R):S(oe,!1)})}a(g),a(u),a(y),n(o,y),Te(),m()}var Ht=_('<div class="flex justify-center p-5"><div><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div>Thank you for answering our questions. Your files and answers have been safely stored.</div> <button class="my-3 flex items-center gap-2 justify-center w-full py-5"><!> Return to file upload <b class="text-primary">here</b> or wait 15s for auto-redirection.</button></div></div>');function Kt(o,t){Ae(t,!0);const[v,m]=Be();let r=W(t,"step",15),i=W(t,"files",15),y=te(0);function u(){r(0),i(void 0),clearTimeout(e(y))}rt(()=>{F(y,k(setTimeout(()=>{We(Me,void 0),r(0),u()},15e3)))});var f=Ht(),l=s(f),g=d(s(l),6);g.__click=u;var A=s(g);V(A,{src:"../chevron-right.svg",class:"size-3 bg-secondary"}),Se(3),a(g),a(l),a(f),n(o,f),Te(),m()}Pe(["click"]);var Vt=_('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Wt=_("<div><li><div><!> </div></li></div>"),Yt=_('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),Zt=_('<div class="flex flex-col gap-4"><div class="flex gap-5 m-auto text-center whitespace-nowrap"><div class="glass w-min p-5 py-2 rounded-full"> </div> <div class="glass w-min p-5 py-2 rounded-full"><span class="text-secondary"> </span> | <span class="opacity-30"> </span></div></div> <div class="flex-1"><!></div></div>'),Gt=(o,t)=>t(!1),Xt=_('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),Qt=(o,t)=>t(!0),ea=_('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),ta=_('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),aa=_('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="px-2 py-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),ra=_('<div class="flex items-center justify-center h-full"><div class="glass text-primary p-10 shadow-lg w-[90%] max-w-[500px]">Contribution is not supported on mobile devices due to poor user experience.</div></div>');function ya(o,t){Ae(t,!0);const[v,m]=Be(),r=()=>De(st,"$questionsStore",v),i=()=>De(Me,"$filesStore",v);rt(async()=>{await qt()});let y=te(0),u=te(!1),f=b(()=>{var c;return 1+r().length*(((c=i())==null?void 0:c.length)??1)}),l=te(0),g=b(()=>Array.from(i()??[]).flatMap(c=>{const U=r().map(q=>({question_id:q.id,tags:[],selection:[]}));return{file:c.name,answers:U}})),A=b(()=>e(g)[Math.floor((e(l)-1)/r().length)]),R=b(()=>{var c;return(c=e(A))==null?void 0:c.answers[(e(l)-1)%r().length]});function oe(c){i()&&(F(l,k(Math.min(Math.max(e(l)+(c?1:-1),0),1+r().length*i().length))),F(u,!1))}Ve(()=>{if(e(l)===e(f)){const c=i();c&&c.length>0&&zt(c,e(g))}});var S=K(),x=O(S);{var T=c=>{var U=aa(),q=s(U),le=s(q),P=s(le),ne=s(P),pe=b(()=>`../${(e(l)>=1?"checkmark.svg":"circle.svg")??""}`);V(ne,{get src(){return e(pe)},class:"size-3 bg-secondary"}),Se(),a(P);var je=d(P,2);{var Y=p=>{var h=Vt();n(p,h)};M(je,p=>{var h;(((h=i())==null?void 0:h.length)??0)>0&&p(Y)})}var E=d(je,2);qe(E,1,()=>Array.from(i()??[]),ze,(p,h,$)=>{var G=Yt();const de=b(()=>e(l)>=$*r().length+1&&e(l)<($+1)*r().length+1),w=b(()=>e(l)>=($+1)*r().length+1),z=b(()=>e(w)?"bg-lime-400":"bg-primary");var X=s(G),he=s(X),xe=s(he,!0);a(he);var be=d(he,2),Oe=b(()=>`../${(e(de)?"chevron-down.svg":e(w)?"checkmark.svg":"circle.svg")??""}`);V(be,{get src(){return e(Oe)},get class(){return`size-3 ${e(z)??""}`}});var Re=d(be,2);{var ye=B=>{var L=Ke();const Q=b(()=>e(h).name.slice(0,3)??""),ue=b(()=>e(h).name.slice(-5)??"");C(()=>I(L,`${e(Q)} ... ${e(ue)}`)),n(B,L)},H=B=>{var L=Ke();C(()=>I(L,e(h).name)),n(B,L)};M(Re,B=>{e(h).name.length>10?B(ye):B(H,!1)})}a(X);var we=d(X,2);qe(we,1,r,ze,(B,L,Q)=>{var ue=K();const fe=b(()=>e(l)==1+Q+$*r().length),Ue=b(()=>e(l)>1+Q+$*r().length);var Ce=O(ue);{var Ee=ee=>{var ke=Wt(),Je=s(ke),$e=s(Je),Ze=s($e),ot=b(()=>`../${(e(Ue)?"checkmark.svg":e(fe)?"chevron-right.svg":"circle.svg")??""}`);V(Ze,{get src(){return e(ot)},class:"w-3 h-3 bg-secondary"});var lt=d(Ze);a($e),a(Je),a(ke),C(()=>{ie(Je,`pt-2 pl-5 ${(e(Ue)||e(fe)?"":"opacity-30")??""}`),ie($e,`flex gap-3 items-center ${(e(fe)?"text-secondary":"")??""}`),I(lt,` ${e(L).title??""}`)}),He(1,ke,()=>Xe),He(2,ke,()=>Xe),n(ee,ke)};M(Ce,ee=>{e(de)&&ee(Ee)})}n(B,ue)}),a(G),C(()=>{ie(G,`glass group relative px-3 py-1 shadow-sm border ${(e(w)?"border-lime-400 bg-lime-400/10":"")??""}`),ie(X,`flex items-center gap-2 ${(e(w)?"text-lime-500":"")??""} `),I(xe,e(h).name)}),n(p,G)});var _e=d(E,2),Le=s(_e),Z=b(()=>`../${(e(l)===e(f)?"checkmark.svg":"circle.svg")??""}`);V(Le,{get src(){return e(Z)},class:"z-0 size-3 bg-secondary"}),Se(),a(_e),a(le),a(q);var J=d(q,2),ce=s(J);{var Ie=p=>{$t(p,{get proceed(){return e(u)},set proceed(h){F(u,k(h))}})},ae=p=>{var h=K(),$=O(h);{var G=w=>{Kt(w,{get step(){return e(l)},set step(z){F(l,k(z))},get files(){return tt(),i()},set files(z){We(Me,k(z))}})},de=w=>{var z=K(),X=O(z);{var he=xe=>{var be=K();const Oe=b(()=>r().filter(ye=>{var H;return ye.id===((H=e(R))==null?void 0:H.question_id)})[0]);var Re=O(be);St(Re,()=>e(l),ye=>{var H=Zt(),we=s(H),Fe=s(we),B=s(Fe,!0);a(Fe);var L=d(Fe,2),Q=s(L),ue=s(Q,!0);a(Q);var fe=d(Q,2),Ue=s(fe,!0);a(fe),a(L),a(we);var Ce=d(we,2),Ee=s(Ce);Pt(Ee,{get question(){return e(Oe)},get answer(){return e(R)},get proceed(){return e(u)},set proceed(ee){F(u,k(ee))}}),a(Ce),a(H),C(()=>{var ee;I(B,(ee=e(A))==null?void 0:ee.file),I(ue,(e(l)-1)%r().length+1),I(Ue,r().length)}),He(1,H,()=>ht),n(ye,H)}),n(xe,be)};M(X,xe=>{e(R)&&xe(he)},!0)}n(w,z)};M($,w=>{e(l)===e(f)?w(G):w(de,!1)},!0)}n(p,h)};M(ce,p=>{e(l)===0?p(Ie):p(ae,!1)})}var j=d(ce,2),N=s(j);{var re=p=>{var h=Xt();h.__click=[Gt,oe],n(p,h)};M(N,p=>{e(l)>=1&&e(l)!==e(f)&&p(re)})}var se=d(N,2);At(se);var me=d(se,2);{var ve=p=>{var h=K(),$=O(h);{var G=w=>{var z=ea();z.__click=[Qt,oe],n(w,z)},de=w=>{var z=ta(),X=s(z);V(X,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),Se(),a(z),n(w,z)};M($,w=>{e(u)?w(G):w(de,!1)})}n(p,h)};M(me,p=>{e(l)<e(f)&&p(ve)})}a(j),a(J),a(U),C(()=>{ie(P,`glass px-3 py-2 flex items-center gap-3 ${(e(l)===0?"bg-secondary/5 shadow-secondary/30 border-secondary text-secondary":"")??""}`),ie(_e,`glass px-3 py-2 flex items-center gap-3 ${(e(l)===e(f)?"font-bold":"")??""}`)}),n(c,U)},D=c=>{var U=ra();n(c,U)};M(x,c=>{e(y)>1e3?c(T):c(D,!1)})}xt("innerWidth",c=>F(y,k(c))),n(o,S),Te(),m()}Pe(["click"]);export{ya as component};

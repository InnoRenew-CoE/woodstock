import{a as n,t as _,c as G,e as Ke}from"../chunks/disclose-version.B8FhMCHa.js";import{l as Qe,o as vt,Y as ct,aK as ut,ah as gt,k as ft,A as pt,z as _t,x as mt,ao as xt,p as Te,c as a,s as d,r as t,t as P,g as e,a as Ie,d as k,b as de,a1 as Ze,ap as K,e as O,n as De}from"../chunks/runtime.Twxei6D9.js";import{s as T,i as j}from"../chunks/if.D8Ga6OrE.js";import{e as be,i as he}from"../chunks/each.D4Yknd68.js";import{d as Le,p as z,r as bt}from"../chunks/events.cLB7s__O.js";import{r as at,a as ne,b as rt,M as Q,s as ht}from"../chunks/MaskedIcon.Bv3Qvdar.js";import{t as $e,a as st,s as et}from"../chunks/index.DWwqrxLx.js";import{b as yt}from"../chunks/window.DDrw6ikS.js";import{p as Y,s as Be,a as je,m as Ve,b as We}from"../chunks/props.DW8d2wJc.js";import"../chunks/legacy.CuZUSs6W.js";import{P as it}from"../chunks/public.CD978DOo.js";import{w as Oe}from"../chunks/index.tARBV8wy.js";import{b as wt,c as kt}from"../chunks/input.zAG3t_j5.js";import{S as St}from"../chunks/SuggestiveInput.Bm1zWyn5.js";import{o as qt}from"../chunks/index-client.W6R2iQDr.js";function zt(l,r,v){Qe&&vt();var h=l,o=xt,s,p=ct()?ut:gt;ft(()=>{p(o,o=r())&&(s&&pt(s),s=_t(()=>v(h)))}),Qe&&(h=mt)}var xe=(l=>(l[l.Text=0]="Text",l[l.Select=1]="Select",l[l.MultiSelect=2]="MultiSelect",l[l.Tags=3]="Tags",l[l.MultiText=4]="MultiText",l))(xe||{});const Xe=Oe([]),Fe=Oe(),ot=Oe([]),lt=Oe([]);async function Mt(){const l=await fetch(`${it}/api/questions`),{questions:r,available_tags:v}=await l.json();ot.set(r.toSorted((h,o)=>h.id-o.id)),lt.set(v)}async function At(l,r){Xe.set(Array.from(l).map(v=>({file:v.name,progress:0})));for(let v of Array.from(l)){const h=r.find(p=>p.file===v.name);if(!h){console.error(`Unable to find answers for file ${v.name}`);continue}const o=new FormData;o.append("answers",JSON.stringify(h.answers)),o.append("file",v,v.name);const s=new XMLHttpRequest;s.open("POST",`${it}/api/answers`),s.upload.onprogress=p=>{if(p.lengthComputable){const u=p.loaded/p.total*100,g=u.toFixed(2);console.log(`Uploaded: ${g}%`),Xe.update(i=>{const f=i.find(y=>y.file===v.name);return f&&(f.progress=u),i})}},s.send(o)}}var Ft=_('<div class="flex-1"></div>');function jt(l){var r=Ft();n(l,r)}var Tt=(l,r)=>r(l),It=_('<label><input class="hidden" type="checkbox"> </label>');function Nt(l,r){Te(r,!0);let v=Y(r,"group",31,()=>z([]));Y(r,"class",3,"");let h=Y(r,"multiple",3,!0);const o=()=>typeof r.value=="number"?+r.value:r.value;let s=k(()=>v().includes(o()));function p(f){const y=o();e(s)?v(v().filter(L=>L!==y)):v().includes(y)||(h()?v([...v(),y]):v([y]))}var u=It(),g=a(u);at(g),g.__change=[Tt,p];var i=d(g);t(u),P(()=>{ne(u,`transition-all select-none glass px-5 py-3 ${(e(s)?"bg-secondary/10 text-secondary border-secondary hover:bg-red-100 hover:text-red-400 hover:border-red-400 ":"hover:bg-secondary/10 hover:border-secondary hover:text-accent")??""}`),rt(g,r.value),T(i,` ${r.label??""}`)}),n(l,u),Ie()}Le(["change"]);var Pt=_('<textarea placeholder="Answer here..." class="glass p-5 min-h-[100px] resize-none w-full"></textarea>'),Ut=_('<div class="flex items-center gap-3"><input placeholder="Type here..." class="glass p-5 py-2 resize-none w-full"> <div class="glass p-2 hover:bg-red-50 cursor-pointer"><!></div></div>'),Ct=_('<div class="grid w-full gap-3 py-5"></div>'),Dt=_('<div class="grid sm:flex gap-3 w-full items-stretch flex-wrap"></div>'),$t=_('<div><div class="glass p-8"><div class="text-lg font-semibold"> </div> <div> </div></div> <div class="mt-5 flex gap-5 items-center justify-center flex-wrap"><!></div></div>');function Lt(l,r){Te(r,!0);const[v,h]=Be(),o=()=>je(lt,"$tagsStore",v);let s=Y(r,"answer",15),p=Y(r,"proceed",15,!1),u=de(z(s().selection)),g=de(z(s().text)),i=de(z(s().tags)),f=de(z([""]));Ze(()=>{var w;if(s(s().selection=e(u),!0),s(s().text=e(g),!0),s(s().tags=e(i),!0),r.question.question_type===xe.MultiText){const A=e(f).filter(C=>C.trim().length!==0);A.length>0&&s(s().text=JSON.stringify(A),!0)}p(s().selection.length>0||(((w=s().text)==null?void 0:w.length)??0)>0||s().tags.length>0)});var y=G(),L=K(y);{var U=w=>{var A=$t(),C=a(A),c=a(C),I=a(c,!0);t(c);var B=d(c,2),x=a(B,!0);t(B),t(C);var M=d(C,2),ye=a(M);{var se=R=>{var F=Pt();bt(F),wt(F,()=>e(g),ce=>O(g,ce)),n(R,F)},ve=R=>{var F=G(),ce=K(F);{var V=E=>{var W=Ct();be(W,21,()=>e(f),he,(ge,Ne,ie)=>{var D=Ut(),$=a(D);at($),$.__keyup=we=>{const fe=we.currentTarget.value??"";e(f)[ie]=fe,fe.trim().length>0&&e(f).find(m=>m.length===0)===void 0&&O(f,z([...e(f),""]))};var oe=d($,2);oe.__click=()=>{O(f,z(e(f).toSpliced(ie,1))),O(f,z([...e(f)]))};var le=a(oe);Q(le,{src:"/x-close.svg",class:"size-4 bg-red-600"}),t(oe),t(D),P(()=>rt($,e(f)[ie])),n(ge,D)}),t(W),n(E,W)},ue=E=>{var W=G(),ge=K(W);{var Ne=D=>{St(D,{get options(){return o()},get selected(){return e(i)},set selected($){O(i,z($))}})},ie=D=>{var $=Dt();be($,21,()=>r.question.possible_answers.toSorted(),he,(oe,le)=>{var we=k(()=>r.question.question_type===xe.MultiSelect);Nt(oe,{get label(){return e(le).value},get value(){return e(le).id},get multiple(){return e(we)},get group(){return e(u)},set group(fe){O(u,z(fe))}})}),t($),n(D,$)};j(ge,D=>{r.question.question_type===xe.Tags?D(Ne):D(ie,!1)},!0)}n(E,W)};j(ce,E=>{r.question.question_type===xe.MultiText?E(V):E(ue,!1)},!0)}n(R,F)};j(ye,R=>{r.question.question_type===xe.Text?R(se):R(ve,!1)})}t(M),t(A),P(()=>{T(I,r.question.title),T(x,r.question.text)}),n(w,A)},S=w=>{var A=Ke();P(()=>T(A,p(!0))),n(w,A)};j(L,w=>{s()?w(U):w(S,!1)})}n(l,y),Ie(),h()}Le(["keyup","click"]);var Bt=_('<div class="w-min text-nowrap"><label for="file-upload" class="text-secondary/80 glass bg-secondary/10 border-secondary/50 flex gap-3 p-2 py-1 items-center justify-center hover:brightness-[90%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/70"><!></div> <div class="text-center px-5"> </div></label> <input id="file-upload" class="hidden" type="file"></div>');function tt(l,r){let v=Y(r,"text",3,"Select files"),h=Y(r,"files",15),o=Y(r,"multiple",3,!0);var s=Bt(),p=a(s),u=a(p),g=a(u);Q(g,{src:"../download.svg",class:"size-4 bg-secondary rotate-180"}),t(u);var i=d(u,2),f=a(i,!0);t(i),t(p);var y=d(p,2);t(s),P(()=>{T(f,v()),y.multiple=o()}),kt(y,h),n(l,s)}var Ot=_('<li class="flex items-center gap-3"><!> </li>'),Rt=_('<div class="font-light pb-2"> </div> <ul class="space-y-2 bg-secondary/5 border border-secondary/50 shadow shadow-secondary/10 py-3 px-5 rounded-lg"></ul>',1),Yt=_('<div class="text-center font-light opacity-80 italic">No files selected</div>'),Et=_(`<div class="select-none flex flex-col gap-5"><div class="glass p-10"><p class="text-xl font-semibold">File Upload</p> <div class="py-2 opacity-60">Thank you for choosing to contribute in our research project. Please select files that you'd like to contribute to our system.</div> <div class="py-1 opacity-80">Help us improve our search by contributing. Contribution is a few-step process where you answer some questions about your files.</div></div> <div class="grid glass p-5 gap-3"><div class="p-3 glass grid text-center grid-cols-[1fr_50px_1fr] gap-10 items-center justify-center"><div class="grid gap-3"><div class="text-primary/50">Upload files individually.</div> <div class="flex items-center justify-center"><!></div></div> <div class="uppercase opacity-60 rounded border bg-secondary/20 border-secondary/60 h-full w-1 m-auto"></div> <div class="grid gap-3 items-center m-auto"><div class="text-primary/50">Fill out an excel file and upload it for us to process it later.</div> <a target="_blank" href="../template.xlsm" class="w-min text-nowrap glass px-2 py-1 text-green-600/80 glass bg-green-600/10 border-green-600/50 flex gap-3 items-center justify-center hover:brightness-[90%] cursor-pointer"><div class="glass p-2 rounded-full bg-white/80 border-green-600/30"><!></div> <div class="text-center px-5">Download excel template</div></a> <!></div></div> <div class="glass p-10"><!></div></div></div>`);function Ht(l,r){Te(r,!0);const[v,h]=Be(),o=()=>je(Fe,"$filesStore",v);let s=Y(r,"proceed",15);Ze(()=>{var x;s((((x=o())==null?void 0:x.length)??0)>0)});var p=Et(),u=d(a(p),2),g=a(u),i=a(g),f=d(a(i),2),y=a(f);tt(y,{text:"Select files",multiple:!0,get files(){return Ve(),o()},set files(x){We(Fe,z(x))}}),t(f),t(i);var L=d(i,4),U=d(a(L),2),S=a(U),w=a(S);Q(w,{src:"../download.svg",class:"size-4 bg-green-600"}),t(S),De(2),t(U);var A=d(U,2);tt(A,{text:"Submit file",multiple:!1,get files(){return Ve(),o()},set files(x){We(Fe,z(x))}}),t(L),t(g);var C=d(g,2),c=a(C);{var I=x=>{var M=Rt();const ye=k(()=>Array.from(o()??[]).map(F=>F.name));var se=K(M),ve=a(se);t(se);var R=d(se,2);be(R,21,()=>e(ye),he,(F,ce)=>{var V=Ot(),ue=a(V);Q(ue,{src:"../checkmark-circle.svg",class:"size-3 bg-primary"});var E=d(ue);t(V),P(()=>T(E,` ${e(ce)??""}`)),n(F,V)}),t(R),P(()=>{var F;return T(ve,`Selected files (${((F=o())==null?void 0:F.length)??0??""}):`)}),n(x,M)},B=x=>{var M=Yt();n(x,M)};j(c,x=>{var M;(((M=o())==null?void 0:M.length)??0)>0?x(I):x(B,!1)})}t(C),t(u),t(p),n(l,p),Ie(),h()}function Jt(l,r,v){r(0),v(void 0)}var Kt=_('<li><div class="flex gap-3"><div class="truncate w-[200px]"> </div> <div class="w-full bg-gray-50 border border-primary/10 glass overflow-hidden rounded-sm"><div class="bg-secondary/80 w-[0%] h-full transition-all glass rounded-sm"></div></div> <div class="w-[20%] text-right font-light"> </div></div></li>'),Vt=_('<div><div class="w-full border-b border-accent/10 mb-5"></div> <span class="font-nunito">You can safely close the tab or continue to upload more files.</span> <button class="px-3 py-2 rounded my-3 flex items-center gap-2 justify-center bg-secondary text-white">Upload more</button></div>'),Wt=_('<div class="flex justify-center p-5"><div class="w-full"><img src="../tree_of_knowledge.svg" alt="Tree of knowledge" class="size-36 my-5 mx-auto rounded-full bg-secondary/5 p-5 shadow-lg shadow-secondary/30 border border-secondary"> <div class="text-lg font-bold">Submission</div> <div class="font-light">Thank you for answering our questions. Your files and answers are being uploaded and safely stored.</div> <div class="font-light text-red-400">Note: Indexing and processing happen in the background and may take some time before results are available.</div> <div class="glass p-5 my-5"><span class="font-mono text-xs uppercase">Progress</span> <ul class="space-y-2"></ul></div> <!></div></div>');function Xt(l,r){Te(r,!0);const[v,h]=Be(),o=()=>je(Xe,"$uploadProgressStore",v);let s=Y(r,"step",15),p=Y(r,"files",15);var u=Wt(),g=a(u),i=d(a(g),8),f=d(a(i),2);be(f,5,o,he,(U,S)=>{var w=Kt(),A=a(w),C=a(A),c=a(C,!0);t(C);var I=d(C,2),B=a(I);t(I);var x=d(I,2),M=a(x);P(()=>T(M,`${e(S).progress.toFixed(0)??""}%`)),t(x),t(A),t(w),P(()=>{T(c,e(S).file),ht(B,"style",`width: ${e(S).progress??""}%`)}),n(U,w)}),t(f),t(i);var y=d(i,2);{var L=U=>{var S=Vt(),w=d(a(S),4);w.__click=[Jt,s,p],t(S),$e(1,S,()=>st),n(U,S)};j(y,U=>{o().every(S=>S.progress>=100)&&U(L)})}t(g),t(u),n(l,u),Ie(),h()}Le(["click"]);var Zt=_('<div class="font-nunito opacity-30 pt-2 text-xs uppercase">Files</div>'),Gt=_("<div><li><div><!> </div></li></div>"),Qt=_('<div><div><div class="text-white glass bg-secondary z-20 absolute top-0 left-0 pr-30 text-nowrap py-1 px-5 cursor-pointer hidden group-hover:block"> </div> <!> <!></div> <!></div>'),ea=_('<div class="flex flex-col gap-4"><div class="flex gap-5 m-auto text-center whitespace-nowrap"><div class="glass w-min p-5 py-2 rounded-full"> </div> <div class="glass w-min p-5 py-2 rounded-full"><span class="text-secondary"> </span> | <span class="opacity-30"> </span></div></div> <div class="flex-1"><!></div></div>'),ta=(l,r)=>r(!1),aa=_('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-amber-500 cursor-pointer">Back</button>'),ra=(l,r)=>r(!0),sa=_('<button class="transition-all py-1 px-3 rounded bg-black text-white hover:bg-accent cursor-pointer disabled:bg-gray-400">Next</button>'),ia=_('<span class="font-nunito flex items-center gap-2"><!> Required</span>'),oa=_('<div class="glass p-5 grid gap-5 grid-cols-[minmax(min-content,300px)_auto] h-full"><div class="select-none glass px-4 py-2"><ul class="px-2 py-5 space-y-3"><li><!> File Selection</li> <!> <!> <li><!> Submission</li></ul></div> <div class="glass p-10 grid grid-rows-[auto_min-content]"><!> <div class="flex justify-between gap-5 py-5"><!> <!> <!></div></div></div>'),la=_('<div class="flex items-center justify-center h-full"><div class="glass text-primary p-10 shadow-lg w-[90%] max-w-[500px]">Contribution is not supported on mobile devices due to poor user experience.</div></div>');function ka(l,r){Te(r,!0);const[v,h]=Be(),o=()=>je(ot,"$questionsStore",v),s=()=>je(Fe,"$filesStore",v);qt(async()=>{await Mt()});let p=de(0),u=de(!1),g=k(()=>{var c;return 1+o().length*(((c=s())==null?void 0:c.length)??1)}),i=de(0),f=k(()=>Array.from(s()??[]).flatMap(c=>{const I=o().map(B=>({question_id:B.id,tags:[],selection:[]}));return{file:c.name,answers:I}})),y=k(()=>e(f)[Math.floor((e(i)-1)/o().length)]),L=k(()=>{var c;return(c=e(y))==null?void 0:c.answers[(e(i)-1)%o().length]});function U(c){s()&&(O(i,z(Math.min(Math.max(e(i)+(c?1:-1),0),1+o().length*s().length))),O(u,!1))}Ze(()=>{if(e(i)===e(g)){const c=s();c&&c.length>0&&At(c,e(f))}});var S=G(),w=K(S);{var A=c=>{var I=oa(),B=a(I),x=a(B),M=a(x),ye=a(M),se=k(()=>`../${(e(i)>=1?"checkmark.svg":"circle.svg")??""}`);Q(ye,{get src(){return e(se)},class:"size-3 bg-secondary"}),De(),t(M);var ve=d(M,2);{var R=m=>{var b=Zt();n(m,b)};j(ve,m=>{var b;(((b=s())==null?void 0:b.length)??0)>0&&m(R)})}var F=d(ve,2);be(F,1,()=>Array.from(s()??[]),he,(m,b,X)=>{var ee=Qt();const pe=k(()=>e(i)>=X*o().length+1&&e(i)<(X+1)*o().length+1),q=k(()=>e(i)>=(X+1)*o().length+1),N=k(()=>e(q)?"bg-lime-400":"bg-primary");var te=a(ee),ke=a(te),Se=a(ke,!0);t(ke);var qe=d(ke,2),Re=k(()=>`../${(e(pe)?"chevron-down.svg":e(q)?"checkmark.svg":"circle.svg")??""}`);Q(qe,{get src(){return e(Re)},get class(){return`size-3 ${e(N)??""}`}});var Ye=d(qe,2);{var ze=H=>{var J=Ke();const ae=k(()=>e(b).name.slice(0,3)??""),_e=k(()=>e(b).name.slice(-5)??"");P(()=>T(J,`${e(ae)} ... ${e(_e)}`)),n(H,J)},Z=H=>{var J=Ke();P(()=>T(J,e(b).name)),n(H,J)};j(Ye,H=>{e(b).name.length>10?H(ze):H(Z,!1)})}t(te);var Me=d(te,2);be(Me,1,o,he,(H,J,ae)=>{var _e=G();const me=k(()=>e(i)==1+ae+X*o().length),Ue=k(()=>e(i)>1+ae+X*o().length);var Ce=K(_e);{var Ee=re=>{var Ae=Gt(),He=a(Ae),Je=a(He),Ge=a(Je),nt=k(()=>`../${(e(Ue)?"checkmark.svg":e(me)?"chevron-right.svg":"circle.svg")??""}`);Q(Ge,{get src(){return e(nt)},class:"w-3 h-3 bg-secondary"});var dt=d(Ge);t(Je),t(He),t(Ae),P(()=>{ne(He,`pt-2 pl-5 ${(e(Ue)||e(me)?"":"opacity-30")??""}`),ne(Je,`flex gap-3 items-center ${(e(me)?"text-secondary":"")??""}`),T(dt,` ${e(J).title??""}`)}),$e(1,Ae,()=>et),$e(2,Ae,()=>et),n(re,Ae)};j(Ce,re=>{e(pe)&&re(Ee)})}n(H,_e)}),t(ee),P(()=>{ne(ee,`glass group relative px-3 py-1 shadow-sm border ${(e(q)?"border-lime-400 bg-lime-400/10":"")??""}`),ne(te,`flex items-center gap-2 ${(e(q)?"text-lime-500":"")??""} `),T(Se,e(b).name)}),n(m,ee)});var V=d(F,2),ue=a(V),E=k(()=>`../${(e(i)===e(g)?"checkmark.svg":"circle.svg")??""}`);Q(ue,{get src(){return e(E)},class:"z-0 size-3 bg-secondary"}),De(),t(V),t(x),t(B);var W=d(B,2),ge=a(W);{var Ne=m=>{Ht(m,{get proceed(){return e(u)},set proceed(b){O(u,z(b))}})},ie=m=>{var b=G(),X=K(b);{var ee=q=>{Xt(q,{get step(){return e(i)},set step(N){O(i,z(N))},get files(){return Ve(),s()},set files(N){We(Fe,z(N))}})},pe=q=>{var N=G(),te=K(N);{var ke=Se=>{var qe=G();const Re=k(()=>o().filter(ze=>{var Z;return ze.id===((Z=e(L))==null?void 0:Z.question_id)})[0]);var Ye=K(qe);zt(Ye,()=>e(i),ze=>{var Z=ea(),Me=a(Z),Pe=a(Me),H=a(Pe,!0);t(Pe);var J=d(Pe,2),ae=a(J),_e=a(ae,!0);t(ae);var me=d(ae,2),Ue=a(me,!0);t(me),t(J),t(Me);var Ce=d(Me,2),Ee=a(Ce);Lt(Ee,{get question(){return e(Re)},get answer(){return e(L)},get proceed(){return e(u)},set proceed(re){O(u,z(re))}}),t(Ce),t(Z),P(()=>{var re;T(H,(re=e(y))==null?void 0:re.file),T(_e,(e(i)-1)%o().length+1),T(Ue,o().length)}),$e(1,Z,()=>st),n(ze,Z)}),n(Se,qe)};j(te,Se=>{e(L)&&Se(ke)},!0)}n(q,N)};j(X,q=>{e(i)===e(g)?q(ee):q(pe,!1)},!0)}n(m,b)};j(ge,m=>{e(i)===0?m(Ne):m(ie,!1)})}var D=d(ge,2),$=a(D);{var oe=m=>{var b=aa();b.__click=[ta,U],n(m,b)};j($,m=>{e(i)>=1&&e(i)!==e(g)&&m(oe)})}var le=d($,2);jt(le);var we=d(le,2);{var fe=m=>{var b=G(),X=K(b);{var ee=q=>{var N=sa();N.__click=[ra,U],n(q,N)},pe=q=>{var N=ia(),te=a(N);Q(te,{src:"../chevron-right.svg",class:"size-3 bg-secondary animate-pulse"}),De(),t(N),n(q,N)};j(X,q=>{e(u)?q(ee):q(pe,!1)})}n(m,b)};j(we,m=>{e(i)<e(g)&&m(fe)})}t(D),t(W),t(I),P(()=>{ne(M,`glass px-3 py-2 flex items-center gap-3 ${(e(i)===0?"bg-secondary/5 shadow-secondary/30 border-secondary text-secondary":"")??""}`),ne(V,`glass px-3 py-2 flex items-center gap-3 ${(e(i)===e(g)?"font-bold":"")??""}`)}),n(c,I)},C=c=>{var I=la();n(c,I)};j(w,c=>{e(p)>1e3?c(A):c(C,!1)})}yt("innerWidth",c=>O(p,z(c))),n(l,S),Ie(),h()}Le(["click"]);export{ka as component};
